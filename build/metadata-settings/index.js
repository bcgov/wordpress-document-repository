(()=>{"use strict";var e={20:(e,t,a)=>{var s=a(609),l=Symbol.for("react.element"),i=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),n=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,a){var s,o={},r=null,c=null;for(s in void 0!==a&&(r=""+a),void 0!==t.key&&(r=""+t.key),void 0!==t.ref&&(c=t.ref),t)i.call(t,s)&&!d.hasOwnProperty(s)&&(o[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===o[s]&&(o[s]=t[s]);return{$$typeof:l,type:e,key:r,ref:c,props:o,_owner:n.current}}},609:e=>{e.exports=window.React},848:(e,t,a)=>{e.exports=a(20)}},t={};function a(s){var l=t[s];if(void 0!==l)return l.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,a),i.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var s=a(609);const l=window.wp.element,i=window.wp.components,n=window.wp.i18n,d=({title:e,isOpen:t,onClose:a,onSave:d,isSaving:o=!1,isDisabled:r=!1,saveButtonText:c,saveButtonClassName:m="doc-repo-button save-button",children:g})=>{const u=(0,l.useCallback)(e=>{e&&(e.preventDefault(),e.stopPropagation()),a()},[a]),p=(0,l.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),d()},[d]);return t?(0,s.createElement)(i.Modal,{title:e,onRequestClose:u,className:"metadata-edit-modal",shouldCloseOnClickOutside:!0,shouldCloseOnEsc:!0},(0,s.createElement)("form",{onSubmit:p,className:"metadata-edit-form"},g,(0,s.createElement)("div",{className:"modal-actions"},(0,s.createElement)(i.Button,{onClick:u,disabled:o,className:"doc-repo-button cancel-button"},(0,n.__)("Cancel","bcgov-design-system")),(0,s.createElement)(i.Button,{type:"submit",isBusy:o,disabled:o||r,className:m},c||(0,n.__)("Save Changes","bcgov-design-system"))))):null},o=(0,l.forwardRef)(function({icon:e,size:t=24,...a},s){return(0,l.cloneElement)(e,{width:t,height:t,...a,ref:s})}),r=window.wp.primitives;var c=a(848);const m=(0,c.jsx)(r.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,c.jsx)(r.Path,{d:"M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM12.75 8V13H11.25V8H12.75ZM12.75 14.5V16H11.25V14.5H12.75Z"})}),g=({isOpen:e,onClose:t,onConfirm:a,field:l,isDeleting:d})=>e&&l?(0,s.createElement)(i.Modal,{title:(0,n.__)("Delete Metadata Field","bcgov-design-system"),onRequestClose:t,className:"metadata-field-modal"},(0,s.createElement)("div",{className:"document-delete-form"},(0,s.createElement)("div",{className:"delete-warning"},(0,s.createElement)("div",{className:"warning-icon"},(0,s.createElement)(o,{icon:m})),(0,s.createElement)("div",{className:"warning-content"},(0,s.createElement)("strong",null,(0,n.__)("This action cannot be undone","bcgov-design-system")),(0,s.createElement)("p",null,(0,n.__)("Deleting this field will permanently remove it and its values from all documents in the repository.","bcgov-design-system")))),(0,s.createElement)("div",{className:"document-info"},(0,s.createElement)("h3",null,(0,n.__)("Field Information","bcgov-design-system")),(0,s.createElement)("div",{className:"info-grid"},(0,s.createElement)("div",{className:"label"},(0,n.__)("Field ID:","bcgov-design-system")),(0,s.createElement)("div",{className:"value"},l.id),(0,s.createElement)("div",{className:"label"},(0,n.__)("Label:","bcgov-design-system")),(0,s.createElement)("div",{className:"value"},l.label),(0,s.createElement)("div",{className:"label"},(0,n.__)("Type:","bcgov-design-system")),(0,s.createElement)("div",{className:"value"},l.type))),(0,s.createElement)("div",{className:"delete-actions"},(0,s.createElement)(i.Button,{onClick:t,className:"doc-repo-button cancel-button",disabled:d},(0,n.__)("Cancel","bcgov-design-system")),(0,s.createElement)(i.Button,{onClick:a,className:"doc-repo-button delete-button",disabled:d},d?(0,n.__)("Deletingâ€¦","bcgov-design-system"):(0,n.__)("Delete Field","bcgov-design-system"))))):null,u=({children:e})=>(0,s.createElement)("div",{className:"metadata-fields-list"},e),p=({children:e})=>(0,s.createElement)("div",{className:"metadata-field-item"},(0,s.createElement)("div",{className:"metadata-field-info"},e)),b={text:(0,n.__)("Text","bcgov-design-system"),date:(0,n.__)("Date","bcgov-design-system")},v=({fields:e,onEdit:t,onDelete:a,isSaving:l})=>0===e.length?(0,s.createElement)("div",{className:"no-fields-message"},(0,s.createElement)("p",null,(0,n.__)('No custom metadata fields defined yet. Click "Add New Field" to create one.',"bcgov-design-system"))):(0,s.createElement)(u,null,e.map((e,d)=>(0,s.createElement)(p,{key:e.id},(0,s.createElement)("div",{className:"metadata-field-info"},(0,s.createElement)("h3",null,e.label),(0,s.createElement)("p",{className:"field-id"},"ID: ",e.id),(0,s.createElement)("p",{className:"field-type"},"Type: ",b[e.type])),(0,s.createElement)("div",{className:"metadata-field-actions"},(0,s.createElement)(i.Button,{className:"doc-repo-button edit-button",onClick:()=>t(e,d)},(0,n.__)("Edit","bcgov-design-system")),(0,s.createElement)(i.Button,{className:"doc-repo-button delete-button",onClick:()=>a(e),disabled:l},(0,n.__)("Delete","bcgov-design-system")))))),f={text:(0,n.__)("Text","bcgov-design-system"),date:(0,n.__)("Date","bcgov-design-system"),taxonomy:(0,n.__)("Taxonomy","bcgov-design-system")},y=({field:e,errors:t,onChange:a,onOptionsChange:l,isEdit:d=!1})=>{return(0,s.createElement)("div",{className:"metadata-field-form"},t?.submit&&(0,s.createElement)(i.Notice,{status:"error",isDismissible:!1},(0,s.createElement)("p",null,t.submit)),(0,s.createElement)(i.TextControl,{label:(0,n.__)("Field Label","bcgov-design-system"),help:(0,n.__)("Display name for the field","bcgov-design-system"),value:e.label,onChange:e=>a("label",e),required:!0,className:t?.label?"has-error":""}),t?.label&&(0,s.createElement)("div",{className:"field-error"},t.label),d?(0,s.createElement)("div",{className:"field-type-display"},(0,s.createElement)("label",{htmlFor:"edit-field-type-value"},(0,n.__)("Field Type","bcgov-design-system")),(0,s.createElement)("div",{id:"edit-field-type-value",className:"field-type-value"},f[e.type])):(0,s.createElement)(i.SelectControl,{label:(0,n.__)("Field Type","bcgov-design-system"),value:e.type,options:Object.entries(f).map(([e,t])=>({value:e,label:t})),onChange:e=>a("type",e)}),"taxonomy"===e.type&&(0,s.createElement)(i.TextareaControl,{label:(0,n.__)("Taxonomy Terms","bcgov-design-system"),value:(o=e,void 0!==o._rawOptionsText?o._rawOptionsText:Array.isArray(o.options)?o.options.join("\n"):""),onChange:l,help:(0,n.__)("Enter one taxonomy term per line. These will become the available options for this taxonomy.","bcgov-design-system")}));var o},_=window.wp.apiFetch;var E=a.n(_);const h=()=>{const{state:e,setState:t,createField:a,deleteField:o,fetchFields:r,editField:c,validateField:m,getInitialFieldState:u}=(()=>{const[e,t]=(0,l.useState)({fields:[],isLoading:!0,error:null,isSaving:!1,modals:{add:{isOpen:!1,field:{id:"",label:"",type:"text",options:[],_rawOptionsText:""},errors:{label:"",submit:""}},edit:{isOpen:!1,field:null,index:null,errors:{label:"",submit:""},originalValues:null},delete:{isOpen:!1,field:null}}}),{apiNamespace:a}=window.documentRepositorySettings,s=(0,l.useCallback)(async()=>{try{const e=await E()({path:`/${a}/metadata-fields`});return t(t=>({...t,fields:e,error:null,isLoading:!1})),{success:!0,data:e}}catch(e){return t(t=>({...t,error:e.message||(0,n.__)("Error loading metadata fields","bcgov-design-system"),isLoading:!1})),{success:!1,error:e.message||(0,n.__)("Error loading metadata fields","bcgov-design-system")}}},[a]),i=(0,l.useCallback)(async e=>{try{return await E()({path:`/${a}/metadata-fields`,method:"POST",data:e}),{success:!0}}catch(e){return{success:!1,error:e.message||(0,n.__)("Error creating metadata field","bcgov-design-system")}}},[a]),d=(0,l.useCallback)(async e=>{try{return await E()({path:`/${a}/metadata-fields/${e}`,method:"DELETE"}),{success:!0}}catch(e){return{success:!1,error:e.message||(0,n.__)("Error deleting metadata field","bcgov-design-system")}}},[a]),o=(0,l.useCallback)(async e=>{try{return await E()({path:`/${a}/metadata-fields/${e.id}`,method:"PUT",data:e}),{success:!0}}catch(e){return{success:!1,error:e.message||(0,n.__)("Error editing metadata field","bcgov-design-system")}}},[a]),r=(0,l.useCallback)((e,t=[],a=null)=>{const s={};return e.id||(s.id=(0,n.__)("Field ID is required","bcgov-design-system")),e.label||(s.label=(0,n.__)("Field label is required","bcgov-design-system")),t.some((t,s)=>s!==a&&t.label.toLowerCase()===e.label.toLowerCase())&&(s.label=(0,n.__)("A field with this label already exists","bcgov-design-system")),t.some((t,s)=>s!==a&&t.id===e.id)&&(s.id=(0,n.__)("A field with this ID already exists","bcgov-design-system")),"taxonomy"!==e.type||e.options&&0!==e.options.length||(s.options=(0,n.__)("Taxonomy fields require at least one term","bcgov-design-system")),s},[]),c=(0,l.useCallback)(()=>({id:"",label:"",type:"text",options:[],_rawOptionsText:""}),[]);return{state:e,setState:t,fetchFields:s,createField:i,deleteField:d,editField:o,validateField:r,getInitialFieldState:c}})(),[p,b]=(0,l.useState)(!1),f=(0,l.useCallback)(e=>Array.isArray(e)?e.map(e=>String(e).trim()).filter(e=>e.length>0):[],[]),_=(0,l.useCallback)(e=>void 0!==e._rawOptionsText?e._rawOptionsText:Array.isArray(e.options)?e.options.join("\n"):"",[]);(0,l.useEffect)(()=>{r()},[r]);const h=(0,l.useCallback)((e,a,s)=>{t(t=>{const l=t.modals[e].field;let i={[a]:s};if("label"===a){const e=s.toLowerCase().replace(/[^a-z0-9]+/g,"_");i={...i,id:e}}const n={...l,...i},d=t.modals[e]?.originalValues;let o=!1;return d&&(d.label!==n.label||d.type!==n.type||d._rawOptionsText!==n._rawOptionsText)&&(o=!0),b(o),{...t,modals:{...t.modals,[e]:{...t.modals[e],field:n}}}},[t])},[t]),w=(0,l.useCallback)((e,a)=>{const s=e.split("\n").map(e=>e.trim()).filter(e=>e.length>0);t(t=>{const l={...t.modals[a].field,_rawOptionsText:e,options:s},i=t.modals[a]?.originalValues;let n=!1;return i&&(i.label!==l.label||i.type!==l.type||i._rawOptionsText!==l._rawOptionsText)&&(n=!0),b(n),{...t,modals:{...t.modals,[a]:{...t.modals[a],field:l}}}},[t])},[t]),C=(0,l.useCallback)(async()=>{const{field:s}=e.modals.add,l=m(s,e.fields);if(Object.keys(l).length>0)t(e=>({...e,modals:{...e.modals,add:{...e.modals.add,errors:l}}}));else{t(e=>({...e,isSaving:!0}));try{const l={...s,order:e.fields.length},i=await a(l);i.success?t(e=>({...e,fields:[...e.fields,l],isSaving:!1,modals:{...e.modals,add:{isOpen:!1,field:u(),errors:{label:"",submit:""}}}})):t(e=>({...e,isSaving:!1,modals:{...e.modals,add:{...e.modals.add,errors:{submit:i.error||(0,n.__)("Failed to save field","bcgov-design-system")}}}}))}catch(e){t(t=>({...t,isSaving:!1,modals:{...t.modals,add:{...t.modals.add,errors:{submit:e.message||(0,n.__)("Failed to save field","bcgov-design-system")}}}}))}}},[e.fields,e.modals.add,a,m,u,t]),N=(0,l.useCallback)((e,a)=>{const s={label:e.label||"",type:e.type||"",options:f(e.options),_rawOptionsText:e._rawOptionsText||_(e),id:e.id||""};t(t=>({...t,modals:{...t.modals,edit:{isOpen:!0,field:{...e},index:a,originalValues:s,errors:{label:"",submit:""}}}})),b(!1)},[f,_,t]),O=(0,l.useCallback)(async()=>{var a;const{field:s,index:l,originalValues:i}=e.modals.edit,n=m(s,e.fields,l);if(Object.keys(n).length>0)return void t(e=>({...e,error:n}));t(e=>({...e,isSaving:!0}));const d={...s,id:null!==(a=i?.id)&&void 0!==a?a:s.id},o=await c(d);o.success?t(t=>({...t,fields:[...e.fields.slice(0,l),d,...e.fields.slice(l+1)],error:null,isSaving:!1,modals:{...t.modals,edit:{isOpen:!1,field:null,index:null,originalValues:null}}})):t(e=>({...e,error:o.error,isSaving:!1}))},[e.fields,e.modals.edit,c,m,t]),x=(0,l.useCallback)(e=>{t(t=>({...t,modals:{...t.modals,delete:{isOpen:!0,field:e}}}))},[t]),S=(0,l.useCallback)(async()=>{const a=e.modals.delete.field.id;t(e=>({...e,isSaving:!0}));try{await E()({path:`/${window.documentRepositorySettings.apiNamespace}/metadata-fields/${a}/cleanup`,method:"DELETE"});const s=await o(a);if(s.success){const s=e.fields.filter(e=>e.id!==a);t(e=>({...e,fields:s,isSaving:!1,error:null,modals:{...e.modals,delete:{isOpen:!1,field:null}}}))}else t(e=>({...e,error:s.error,isSaving:!1}))}catch(e){t(t=>({...t,error:e.message||(0,n.__)("Error deleting metadata field","bcgov-design-system"),isSaving:!1}))}},[e.fields,e.modals.delete.field,o,t]),T=(0,l.useCallback)(()=>{t(e=>({...e,modals:{...e.modals,delete:{isOpen:!1,field:null}}}))},[t]),k=(0,l.useCallback)(e=>{t(t=>({...t,modals:{...t.modals,[e]:{...t.modals[e],isOpen:!1,field:u(),errors:{label:"",submit:""},originalValues:null}}})),b(!1)},[u,t]);return e.isLoading?(0,s.createElement)("div",{className:"wordpress-document-metadata-settings"},(0,s.createElement)("div",{className:"metadata-settings-loading"},(0,s.createElement)("div",{className:"spinner-wrapper"},(0,s.createElement)("div",{className:"components-spinner"})),(0,s.createElement)("p",null,(0,n.__)("Loading metadata fieldsâ€¦","bcgov-design-system")))):(0,s.createElement)("div",{className:"wordpress-document-metadata-settings"},(0,s.createElement)("div",{className:"metadata-settings"},e.error&&(0,s.createElement)(i.Notice,{status:"error",isDismissible:!1},(0,s.createElement)("p",null,e.error)),(0,s.createElement)(i.Card,null,(0,s.createElement)(i.CardHeader,null,(0,s.createElement)("h2",null,(0,n.__)("Document Metadata Fields","bcgov-design-system")),(0,s.createElement)(i.Button,{className:"doc-repo-button save-button",onClick:()=>t(e=>({...e,modals:{...e.modals,add:{isOpen:!0,field:u(),errors:{label:"",submit:""}}}})),disabled:e.isSaving},(0,n.__)("Add New Field","bcgov-design-system"))),(0,s.createElement)(i.CardBody,null,(0,s.createElement)("div",{className:"metadata-fields-info"},(0,s.createElement)("p",null,(0,n.__)("Customize the metadata fields that will be available for documents.","bcgov-design-system"))),(0,s.createElement)(v,{fields:e.fields,onEdit:N,onDelete:x,isSaving:e.isSaving}))),(0,s.createElement)(d,{title:(0,n.__)("Edit Metadata Field","bcgov-design-system"),isOpen:e.modals.edit.isOpen,onClose:()=>k("edit"),onSave:O,isSaving:e.isSaving,isDisabled:!p||!e.modals.edit.field?.label},(0,s.createElement)(y,{field:e.modals.edit.field,errors:e.modals.edit.errors,onChange:(e,t)=>h("edit",e,t),onOptionsChange:e=>w(e,"edit"),isEdit:!0})),(0,s.createElement)(d,{title:(0,n.__)("Add New Metadata Field","bcgov-design-system"),isOpen:e.modals.add.isOpen,onClose:()=>k("add"),onSave:C,isSaving:e.isSaving,isDisabled:!e.modals.add.field.label},(0,s.createElement)(y,{field:e.modals.add.field,errors:e.modals.add.errors,onChange:(e,t)=>h("add",e,t),onOptionsChange:e=>w(e,"add"),isEdit:!1})),(0,s.createElement)(g,{isOpen:e.modals.delete.isOpen,onClose:T,onConfirm:S,field:e.modals.delete.field,isDeleting:e.isSaving})))};document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("wordpress-document-repository-metadata-app");if(e)try{(0,l.render)((0,s.createElement)(h,null),e)}catch(t){e.innerHTML='<div class="notice notice-error"><p>Error initializing metadata settings. Please check the console for details.</p></div>'}})})();