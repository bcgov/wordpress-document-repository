(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var s in a)e.o(a,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:a[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,a=window.wp.element,s=window.wp.components,n=window.wp.i18n;class o extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}renderError(){return(0,t.createElement)("div",{className:"error-boundary"},(0,t.createElement)("h2",null,(0,n.__)("Something went wrong.","bcgov-design-system")),(0,t.createElement)("p",null,(0,n.__)("Please try refreshing the page.","bcgov-design-system")),!1)}renderContent(){return this.props.children}render(){return this.state.hasError?this.renderError():this.renderContent()}}const l=o;class r extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}renderError(){return(0,t.createElement)("div",{className:"document-table-row error",role:"row"},(0,t.createElement)("div",{className:"document-table-cell",role:"cell",style:{textAlign:"center"}},(0,n.__)("Error rendering document row.","bcgov-design-system"),!1))}renderContent(){return this.props.children}render(){return this.state.hasError?this.renderError():this.renderContent()}}function c(e){return"trash"===e}function i(e){return"all"===e}function d({document:e,isSelected:a,onSelect:o,onDelete:l,onEdit:r,onRestore:i,isDeleting:d,metadataFields:m,isSpreadsheetMode:u,bulkEditedMetadata:g,onMetadataChange:p,formatFileSize:h,documentStatusFilter:v}){return(0,t.createElement)("div",{className:"document-table-row",role:"row","data-document-id":e.id},(0,t.createElement)("div",{className:"document-table-cell",role:"cell","aria-label":(0,n.__)("Select document","bcgov-design-system")},(0,t.createElement)(s.CheckboxControl,{checked:a,onChange:()=>o(e.id)})),(0,t.createElement)("div",{className:"document-table-cell",role:"cell"},e.title||e.filename),(0,t.createElement)("div",{className:"document-table-cell",role:"cell"},u?(0,t.createElement)(s.TextareaControl,{value:void 0!==g?.[e.id]?.excerpt?g[e.id].excerpt:e.excerpt||"",onChange:t=>{p(e.id,"excerpt",t),setTimeout(()=>{const t=e.querySelector(`[data-document-id="${e.id}"] textarea`);t&&(t.style.height="auto",t.style.height=t.scrollHeight+"px")},0)},placeholder:(0,n.__)("Enter excerpt…","bcgov-design-system"),rows:2,className:"excerpt-textarea"}):e.excerpt||"—"),m.map(a=>(0,t.createElement)("div",{key:a.id,className:"document-table-cell metadata-column",role:"cell","aria-label":(0,n.sprintf)(/* translators: %s: field label */ /* translators: %s: field label */
(0,n.__)("Edit %s","bcgov-design-system"),a.label)},(a=>{if(!u){const t=e.metadata&&e.metadata[a.id]?e.metadata[a.id]:"";if("taxonomy"===a.type&&t){const e=Array.isArray(t)?t:[t];return 1===e.length?e[0]:e.join(", ")}return t||"—"}const o=g[e.id]?.[a.id]||"";if("taxonomy"===a.type){const l=(a.options||[]).map(e=>"string"==typeof e?{label:e,value:e}:{label:e.label||e.name,value:e.label||e.name});return(0,t.createElement)(s.SelectControl,{value:o,options:[{label:(0,n.__)("Select…","bcgov-design-system"),value:""},...l],onChange:t=>p(e.id,a.id,t)})}return(0,t.createElement)(s.TextControl,{type:"date"===a.type?"date":"text",value:o,onChange:t=>p(e.id,a.id,t),className:"metadata-input"})})(a))),(0,t.createElement)("div",{className:"document-table-cell",role:"cell"},e.metadata&&e.metadata.document_file_size?h(e.metadata.document_file_size):"—"),(0,t.createElement)("div",{className:"document-table-cell",role:"cell"},e.metadata&&e.metadata.document_file_type?e.metadata.document_file_type:"—"),(0,t.createElement)("div",{className:"document-table-cell actions",role:"cell","aria-label":(0,n.__)("Document actions","bcgov-design-system")},!u&&(0,t.createElement)("div",{className:"action-buttons"},c(v)?(0,t.createElement)(t.Fragment,null,(0,t.createElement)(s.Button,{onClick:()=>i(e),className:"doc-repo-button icon-button table-action-button",title:(0,n.__)("Restore","bcgov-design-system"),"aria-label":(0,n.__)("Restore","bcgov-design-system"),disabled:d},(0,t.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",width:"16px",height:"16px"},(0,t.createElement)("path",{d:"M440-320h80v-166l64 62 56-56-160-160-160 160 56 56 64-62v166ZM280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Z",fill:"currentColor"}))),(0,t.createElement)(s.Button,{onClick:()=>l(e),className:"doc-repo-button icon-button table-action-button",title:(0,n.__)("Delete Permanently","bcgov-design-system"),"aria-label":(0,n.__)("Delete Permanently","bcgov-design-system"),disabled:d},(0,t.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",width:"16px",height:"16px"},(0,t.createElement)("path",{d:"m376-300 104-104 104 104 56-56-104-104 104-104-56-56-104 104-104-104-56 56 104 104-104 104 56 56Zm-96 180q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Z",fill:"currentColor"})))):(0,t.createElement)(t.Fragment,null,(0,t.createElement)(s.Button,{onClick:()=>window.open(e.metadata.document_file_url,"_blank"),className:"doc-repo-button icon-button table-action-button",title:(0,n.__)("Download","bcgov-design-system"),"aria-label":(0,n.__)("Download","bcgov-design-system")},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z",fill:"currentColor"}))),(0,t.createElement)(s.Button,{onClick:()=>r(e),className:"doc-repo-button icon-button table-action-button",title:(0,n.__)("Edit Metadata","bcgov-design-system"),"aria-label":(0,n.__)("Edit Metadata","bcgov-design-system")},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"currentColor"}))),(0,t.createElement)(s.Button,{onClick:()=>l(e),className:"doc-repo-button icon-button table-action-button",title:(0,n.__)("Trash","bcgov-design-system"),"aria-label":(0,n.__)("Trash","bcgov-design-system"),disabled:d},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z",fill:"currentColor"})))))))}function m({documents:e,selectedDocuments:a,onSelectDocument:o,onSelectAll:l,onDelete:c,onEdit:i,onRestore:m,isDeleting:u,metadataFields:g,isSpreadsheetMode:p,bulkEditedMetadata:h,onMetadataChange:v,formatFileSize:E,documentStatusFilter:y}){const b=e.length>0&&a.length===e.length;return(0,t.createElement)("div",{className:"document-table",role:"table"},(0,t.createElement)("div",{className:"document-table-header",role:"rowgroup"},(0,t.createElement)("div",{className:"document-table-row",role:"row"},(0,t.createElement)("div",{className:"document-table-cell header",role:"columnheader"},(0,t.createElement)(s.CheckboxControl,{checked:b,onChange:l})),(0,t.createElement)("div",{className:"document-table-cell header",role:"columnheader"},(0,n.__)("Title","bcgov-design-system")),(0,t.createElement)("div",{className:"document-table-cell header",role:"columnheader"},(0,n.__)("Excerpt","bcgov-design-system")),g.map(e=>(0,t.createElement)("div",{key:e.id,className:"document-table-cell header metadata-column",role:"columnheader"},e.label)),(0,t.createElement)("div",{className:"document-table-cell header",role:"columnheader"},(0,n.__)("Size","bcgov-design-system")),(0,t.createElement)("div",{className:"document-table-cell header",role:"columnheader"},(0,n.__)("Type","bcgov-design-system")),(0,t.createElement)("div",{className:"document-table-cell header",role:"columnheader"},(0,n.__)("Actions","bcgov-design-system")))),(0,t.createElement)("div",{className:"document-table-body",role:"rowgroup"},e.map(e=>(0,t.createElement)(r,{key:e.id},(0,t.createElement)(d,{document:e,isSelected:a.includes(e.id),onSelect:o,onDelete:c,onEdit:i,onRestore:m,isDeleting:u,metadataFields:g,isSpreadsheetMode:p,bulkEditedMetadata:h,onMetadataChange:v,formatFileSize:E,documentStatusFilter:y,excerpt:e.excerpt})))))}const u=({uploadingFiles:e,showUploadFeedback:s,onClose:o})=>{const l=e.filter(e=>"success"===e.status).length,r=e.filter(e=>"error"===e.status).length,c=e.filter(e=>"uploading"===e.status).length,i=e.filter(e=>"processing"===e.status).length,d=e.some(e=>e.isPlaceholder);return(0,a.useEffect)(()=>{if(s&&0===c&&0===i&&!d&&e.length>0){const e=setTimeout(()=>{o()},3e3);return()=>clearTimeout(e)}},[s,c,i,d,o,e.length]),s&&0!==e.length?(0,t.createElement)("div",{className:"upload-feedback"},(0,t.createElement)("div",{className:"upload-feedback-header"},(0,t.createElement)("div",{className:"upload-feedback-title"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z",fill:"currentColor"})),(0,n.__)("Document Upload Status","bcgov-design-system")),(0,t.createElement)("button",{className:"upload-feedback-close",onClick:()=>{0===c&&0===i&&o()}},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z",fill:"currentColor"})))),(0,t.createElement)("div",{className:"upload-feedback-items"},e.map(e=>(0,t.createElement)("div",{key:e.id,className:`upload-feedback-item ${e.status} ${e.isPlaceholder?"placeholder":""}`},(0,t.createElement)("span",{className:"upload-feedback-item-name"},e.name),"processing"===e.status&&(0,t.createElement)(t.Fragment,null,(0,n.__)("Processing…","bcgov-design-system")),"uploading"===e.status&&(0,t.createElement)(t.Fragment,null,(0,n.__)("Uploading…","bcgov-design-system")),"success"===e.status&&(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z",fill:"currentColor"})),"error"===e.status&&(0,t.createElement)(t.Fragment,null,(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z",fill:"currentColor"})),e.error&&(0,t.createElement)("span",{className:"upload-feedback-item-error"},e.error))))),(0,t.createElement)("div",{className:"upload-feedback-summary"},d?(0,t.createElement)("div",{className:"processing"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z",fill:"currentColor"})),(0,n.__)("Preparing files…","bcgov-design-system")):(0,t.createElement)(t.Fragment,null,i>0&&(0,t.createElement)("div",{className:"processing"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z",fill:"currentColor"})),(0,n.sprintf)(/* translators: %d: number of files being processed */ /* translators: %d: number of files being processed */
(0,n.__)("Processing %d files…","bcgov-design-system"),i)),c>0&&(0,t.createElement)("div",{className:"uploading"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z",fill:"currentColor"})),(0,n.sprintf)(/* translators: %d: number of files being uploaded */ /* translators: %d: number of files being uploaded */
(0,n.__)("Uploading %d files…","bcgov-design-system"),c)),l>0&&(0,t.createElement)("div",{className:"success"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z",fill:"currentColor"})),(0,n.sprintf)(/* translators: %d: number of files that were successfully uploaded */ /* translators: %d: number of files that were successfully uploaded */
(0,n.__)("%d files uploaded successfully","bcgov-design-system"),l)),r>0&&(0,t.createElement)("div",{className:"error"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z",fill:"currentColor"})),(0,n.sprintf)(/* translators: %d: number of files that failed to upload */ /* translators: %d: number of files that failed to upload */
(0,n.__)("%d files failed to upload","bcgov-design-system"),r))))):null},g=({title:e,isOpen:o,onClose:l,onSave:r,isSaving:c=!1,isDisabled:i=!1,saveButtonText:d,saveButtonClassName:m="doc-repo-button save-button",children:u})=>{const g=(0,a.useCallback)(e=>{e&&(e.preventDefault(),e.stopPropagation()),l()},[l]),p=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),r()},[r]);return o?(0,t.createElement)(s.Modal,{title:e,onRequestClose:g,className:"metadata-edit-modal",shouldCloseOnClickOutside:!0,shouldCloseOnEsc:!0},(0,t.createElement)("form",{onSubmit:p,className:"metadata-edit-form"},u,(0,t.createElement)("div",{className:"modal-actions"},(0,t.createElement)(s.Button,{onClick:g,disabled:c,className:"doc-repo-button cancel-button"},(0,n.__)("Cancel","bcgov-design-system")),(0,t.createElement)(s.Button,{type:"submit",isBusy:c,disabled:c||i,className:m},d||(0,n.__)("Save Changes","bcgov-design-system"))))):null},p=({onFilesSelected:e,acceptMimeTypes:o="application/pdf"})=>{const[l,r]=(0,a.useState)(!1),c=(0,a.useRef)(null),i=(0,a.useRef)(null);(0,a.useEffect)(()=>()=>{i.current&&clearTimeout(i.current)},[]);const d=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),r(!0)},[]),m=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),l||r(!0)},[l]),u=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),!e.currentTarget.contains(e.relatedTarget)&&(i.current=setTimeout(()=>{r(!1)},50))},[]),g=(0,a.useCallback)(t=>{t.preventDefault(),t.stopPropagation(),r(!1);const a=t.dataTransfer.files;a&&a.length>0&&e(Array.from(a))},[e]),p=(0,a.useCallback)(t=>{const a=Array.from(t.target.files);a.length>0&&e(a)},[e]),h=(0,a.useCallback)(e=>{e&&e.stopPropagation(),c.current&&c.current.click()},[c]),v=(0,a.useCallback)(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),h())},[h]);return(0,t.createElement)("div",{className:"upload-area__container "+(l?"upload-area__container--drag-active":""),onDragEnter:d,onDragOver:m,onDragLeave:u,onDrop:g,onClick:h,onKeyDown:v,tabIndex:"0",role:"button","aria-label":(0,n.__)("Click or drag files to upload","bcgov-design-system")},(0,t.createElement)("input",{type:"file",ref:c,className:"upload-area__file-input",onChange:p,multiple:!0,accept:o,"aria-hidden":"true"}),(0,t.createElement)("div",{className:"upload-area__content"},(0,t.createElement)("div",{className:"upload-area__icon"},(0,t.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"48",height:"48"},(0,t.createElement)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z",fill:"currentColor"}))),(0,t.createElement)("h3",{className:"upload-area__text"},(0,n.__)("Drag & Drop or Click to Upload","bcgov-design-system")),(0,t.createElement)("p",{className:"upload-area__help-text"},(0,n.__)("Upload PDF documents to the repository","bcgov-design-system")),(0,t.createElement)(s.Button,{className:"upload-area__button",onClick:e=>{e.stopPropagation(),h()}},(0,n.__)("Choose Files","bcgov-design-system"))))},h=({currentPage:e,totalPages:a,onPageChange:o})=>a<=1?null:(0,t.createElement)("div",{className:"pagination"},(0,t.createElement)(s.Button,{onClick:()=>o(e-1),disabled:1===e},(0,n.__)("Previous","bcgov-design-system")),(0,t.createElement)("span",{className:"page-info"},(0,n.sprintf)(/* translators: %1$d: current page number, %2$d: total number of pages */ /* translators: %1$d: current page number, %2$d: total number of pages */
(0,n.__)("Page %1$d of %2$d","bcgov-design-system"),e,a)),(0,t.createElement)(s.Button,{onClick:()=>o(e+1),disabled:e===a},(0,n.__)("Next","bcgov-design-system"))),v=({failedOperations:e,onRetryAll:a})=>0===e.length?null:(0,t.createElement)(s.Notice,{status:"warning",isDismissible:!1,className:"retry-notice"},(0,t.createElement)("p",null,(0,n.sprintf)(/* translators: %d: number of failed operations */ /* translators: %d: number of failed operations */
(0,n.__)("There are %d failed operations that can be retried.","bcgov-design-system"),e.length)),(0,t.createElement)(s.Button,{variant:"secondary",onClick:a},(0,n.__)("Retry All","bcgov-design-system"))),E=window.wp.apiFetch;var y=e.n(E);const b=(e,t)=>{switch(t.type){case"SET_EDITING_DOCUMENT":return{...e,editingMetadata:t.payload,editedValues:t.initialValues||{},errors:{}};case"CLEAR_EDITING_DOCUMENT":return{...e,editingMetadata:null,editedValues:{},errors:{}};case"UPDATE_EDITED_VALUES":return{...e,editedValues:{...e.editedValues,...t.payload}};case"SET_ERRORS":return{...e,errors:t.payload};case"SET_IS_SAVING":return{...e,isSaving:t.payload};case"ENTER_SPREADSHEET_MODE":return{...e,isSpreadsheetMode:!0,bulkEditedMetadata:t.initialBulkValues||{},hasMetadataChanges:!1};case"EXIT_SPREADSHEET_MODE":return{...e,isSpreadsheetMode:!1,bulkEditedMetadata:{},hasMetadataChanges:!1};case"UPDATE_BULK_METADATA":return{...e,bulkEditedMetadata:{...e.bulkEditedMetadata,[t.documentId]:{...e.bulkEditedMetadata[t.documentId],[t.fieldId]:t.value}},hasMetadataChanges:t.hasChanges};case"SET_IS_SAVING_BULK":return{...e,isSavingBulk:t.payload};case"CLEAR_BULK_CHANGES":return{...e,bulkEditedMetadata:{},hasMetadataChanges:!1};default:return e}},_=({documents:e=[],currentPage:o=1,totalPages:r=1,onPageChange:d,onDelete:E,onTrash:_,onRestore:f,isDeleting:S=!1,selectedDocuments:w=[],onSelectDocument:C,onSelectAll:N,onFileDrop:D,onDocumentsUpdate:k,metadataFields:M=[],statusCounts:x={},documentStatusFilter:T="all",onStatusFilterChange:F})=>{const P=(0,a.useMemo)(()=>e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},[]),R=(0,a.useMemo)(()=>{const e=window.documentRepositorySettings;return e?.apiNamespace||"wp/v2"},[]),{showNotification:B}=(()=>{const[e,t]=(0,a.useState)(null);return{notice:e,showNotification:(0,a.useCallback)((e,a,s=3e3)=>{t({status:e,message:a}),s>0&&setTimeout(()=>t(null),s)},[]),clearNotification:(0,a.useCallback)(()=>{t(null)},[])}})(),{failedOperations:A,handleOperationError:I,retryAllOperations:O}=(({onShowNotification:e})=>{const[t,s]=(0,a.useState)([]),[o,l]=(0,a.useState)({}),r=(0,a.useCallback)((t,a,o,r={})=>{const{addToRetryQueue:c=!0,showNotice:i=!0,customMessage:d=null}=r;if(c&&(s(e=>[...e,{type:t,documentId:a,error:o}]),l(e=>({...e,[a]:(e[a]||0)+1}))),i&&e){const t=d||o.message||o.data?.message||(0,n.__)("An unknown error occurred.","bcgov-design-system");e("error",a?(0,n.sprintf)(/* translators: %1$d: document ID, %2$s: error message */ /* translators: %1$d: document ID, %2$s: error message */
(0,n.__)("Operation failed for document %1$d: %2$s","bcgov-design-system"),a,t):t)}},[e]),c=(0,a.useCallback)(async(t,a)=>{if(o[t.documentId]>=3)e("error",(0,n.sprintf)(/* translators: %1$d: document ID */ /* translators: %1$d: document ID */
(0,n.__)("Maximum retry attempts reached for document %1$d","bcgov-design-system"),t.documentId));else try{const e=a[t.type];if(!e)return{error:`Unknown operation type: ${t.type}`};await e(t.documentId),s(e=>e.filter(e=>!(e.type===t.type&&e.documentId===t.documentId)))}catch(e){r(t.type,t.documentId,e)}},[o,r,e]),i=(0,a.useCallback)(e=>{t.forEach(t=>c(t,e))},[t,c]);return{failedOperations:t,handleOperationError:r,retryOperation:c,retryAllOperations:i}})({onShowNotification:B}),{deleteDocument:U,restoreDocument:$,bulkDeleteConfirmOpen:L,bulkRestoreConfirmOpen:z,isMultiDeleting:V,isMultiRestoring:j,setDeleteDocument:H,setRestoreDocument:q,handleBulkDelete:G,handleBulkRestore:K,handleSingleDelete:W,handleSingleRestore:X,openBulkDeleteConfirm:Q,closeBulkDeleteConfirm:Z,openBulkRestoreConfirm:J,closeBulkRestoreConfirm:Y}=(({onDelete:e,onTrash:t,onRestore:s,documentStatusFilter:o,onSelectAll:l,onShowNotification:r,onError:i})=>{const[d,m]=(0,a.useState)(null),[u,g]=(0,a.useState)(null),[p,h]=(0,a.useState)(!1),[v,E]=(0,a.useState)(!1),[y,b]=(0,a.useState)(!1),[_,f]=(0,a.useState)(!1),S=(0,a.useCallback)(async a=>{if(a&&0!==a.length){b(!0);try{await Promise.all(a.map(a=>c(o)?e(a):t(a))),h(!1),l(!1),r&&r("success",(0,n.__)(c(o)?"Selected documents were deleted successfully.":"Selected documents were trashed successfully.","bcgov-design-system"))}catch(e){i&&i("bulk-delete",null,e,{addToRetryQueue:!1,customMessage:(0,n.__)(c(o)?"Error deleting one or more documents.":"Error trashing one or more documents.","bcgov-design-system")})}finally{b(!1)}}},[e,t,o,l,r,i]),w=(0,a.useCallback)(async a=>{try{c(o)?await e(a):await t(a),m(null),r&&r("success",(0,n.__)(c(o)?"Document deleted successfully.":"Document trashed successfully.","bcgov-design-system"))}catch(e){i&&i("delete",a,e,{customMessage:(0,n.sprintf)(/* translators: %1$d: document ID, %2$s: error message */ /* translators: %1$d: document ID, %2$s: error message */
(0,n.__)(c(o)?"Error deleting document %1$d: %2$s":"Error trashing document %1$d: %2$s","bcgov-design-system"),a,e.message||(0,n.__)("An unknown error occurred","bcgov-design-system"))})}},[e,t,o,r,i]),C=(0,a.useCallback)(async e=>{if(e&&0!==e.length){f(!0);try{await Promise.all(e.map(s)),E(!1),l(!1),r&&r("success",(0,n.__)("Selected documents were restored successfully.","bcgov-design-system"))}catch(e){i&&i("bulk-restore",null,e,{addToRetryQueue:!1,customMessage:(0,n.__)("Error restoring one or more documents.","bcgov-design-system")})}finally{f(!1)}}},[s,l,r,i]),N=(0,a.useCallback)(async e=>{try{await s(e),g(null),r&&r("success",(0,n.__)("Document restored successfully.","bcgov-design-system"))}catch(t){i&&i("restore",e,t,{customMessage:(0,n.sprintf)(/* translators: %1$d: document ID, %2$s: error message */ /* translators: %1$d: document ID, %2$s: error message */
(0,n.__)("Error restoring document %1$d: %2$s","bcgov-design-system"),e,t.message||(0,n.__)("An unknown error occurred","bcgov-design-system"))})}},[s,r,i]),D=(0,a.useCallback)(()=>{h(!0)},[]),k=(0,a.useCallback)(()=>{h(!1)},[]),M=(0,a.useCallback)(()=>{E(!0)},[]),x=(0,a.useCallback)(()=>{E(!1)},[]);return{deleteDocument:d,restoreDocument:u,bulkDeleteConfirmOpen:p,bulkRestoreConfirmOpen:v,isMultiDeleting:y,isMultiRestoring:_,setDeleteDocument:m,setRestoreDocument:g,handleBulkDelete:S,handleBulkRestore:C,handleSingleDelete:w,handleSingleRestore:N,openBulkDeleteConfirm:D,closeBulkDeleteConfirm:k,openBulkRestoreConfirm:M,closeBulkRestoreConfirm:x}})({onDelete:E,onTrash:_,onRestore:f,documentStatusFilter:T,onSelectAll:N,onShowNotification:B,onError:I}),{editingMetadata:ee,editedValues:te,errors:ae,isSaving:se,hasMetadataChanged:ne,handleEditMetadata:oe,updateEditedField:le,handleSaveMetadata:re,isSpreadsheetMode:ce,hasMetadataChanges:ie,bulkEditedMetadata:de,isSavingBulk:me,handleMetadataChange:ue,toggleSpreadsheetMode:ge,handleSaveBulkChanges:pe,localDocuments:he}=(({documents:e=[],metadataFields:t=[],apiNamespace:s,onUpdateDocuments:o,onError:l,onShowNotification:r})=>{const[c,i]=(0,a.useReducer)(b,{editingMetadata:null,editedValues:{},errors:{},isSaving:!1,isSpreadsheetMode:!1,bulkEditedMetadata:{},hasMetadataChanges:!1,isSavingBulk:!1}),[d,m]=(0,a.useState)(e);(0,a.useEffect)(()=>{m(e)},[e]);const u=(0,a.useCallback)(()=>{const{editingMetadata:e,editedValues:a}=c;if(!e)return!1;const s=t.some(t=>(e.metadata?.[t.id]||"")!==(a[t.id]||"")),n=e.excerpt||"",o=a.excerpt||"";return s||n!==o},[c,t]),g=(0,a.useCallback)(e=>{var a;if(!e)return void i({type:"CLEAR_EDITING_DOCUMENT"});const s={...e,upload_date:e.date||e.upload_date||e.metadata?.upload_date},n={};t.forEach(t=>{var a;n[t.id]=null!==(a=e.metadata?.[t.id])&&void 0!==a?a:""}),n.excerpt=null!==(a=e.excerpt)&&void 0!==a?a:"",i({type:"SET_EDITING_DOCUMENT",payload:s,initialValues:n})},[t]),p=(0,a.useCallback)((e,a,s)=>{const n=c.bulkEditedMetadata[e]||{};let o;o="excerpt"===a?{...n,excerpt:s}:{...n,[a]:s};const l={...c.bulkEditedMetadata,[e]:o},r=Object.entries(l).some(([e,a])=>{const s=d.find(t=>t.id===parseInt(e));if(!s)return!1;const n=t.some(e=>{const t=s.metadata?.[e.id]||"";return String(t)!==String(a[e.id]||"")}),o=s.excerpt||"",l=String(o)!==String(a.excerpt||"");return n||l});i({type:"UPDATE_BULK_METADATA",documentId:e,fieldId:a,value:s,hasChanges:r})},[d,c.bulkEditedMetadata,i,t]),h=(0,a.useCallback)((e,t)=>{i({type:"UPDATE_EDITED_VALUES",payload:{[e]:t}})},[i]),v=(0,a.useCallback)(async()=>{const{editingMetadata:e,editedValues:a}=c;if(e){i({type:"SET_IS_SAVING",payload:!0});try{const l={},c=String(e.excerpt||"")!==String(a.excerpt||"");t.forEach(t=>{const s=e.metadata?.[t.id]||"",n=a[t.id]||"";String(s)!==String(n)&&(l[t.id]=n)});const u=[];Object.keys(l).length>0&&u.push(y()({path:`/${s}/documents/${e.id}/metadata`,method:"POST",data:l})),c&&u.push(y()({path:`/${s}/documents/${e.id}`,method:"PUT",data:{excerpt:a.excerpt}})),await Promise.all(u),m(t=>t.map(t=>t.id===e.id?{...t,metadata:{...t.metadata,...l},excerpt:c?a.excerpt:t.excerpt}:t)),"function"==typeof o&&o(d.map(t=>t.id===e.id?{...t,metadata:{...t.metadata,...l},excerpt:c?a.excerpt:t.excerpt}:t)),i({type:"CLEAR_EDITING_DOCUMENT"}),r&&r("success",(0,n.__)("Document metadata updated successfully","bcgov-design-system"))}catch(t){t.data?.errors&&i({type:"SET_ERRORS",payload:t.data.errors}),l&&l("metadata",e.id,t,{customMessage:t.data?.message||(0,n.__)("Failed to update metadata","bcgov-design-system")})}finally{i({type:"SET_IS_SAVING",payload:!1})}}},[c,s,d,t,o,r,l,i]),E=(0,a.useCallback)(e=>{if(e){const e={};d.forEach(t=>{e[t.id]={...t.metadata||{},excerpt:t.excerpt||""}}),i({type:"ENTER_SPREADSHEET_MODE",initialBulkValues:e})}else i({type:"EXIT_SPREADSHEET_MODE"})},[d]),_=(0,a.useCallback)(async()=>{const{bulkEditedMetadata:e}=c;i({type:"SET_IS_SAVING_BULK",payload:!0});try{const a=Object.entries(e).filter(([e,a])=>{var s,n;const o=d.find(t=>t.id.toString()===e);if(!o)return!1;const l=t.some(e=>{var t,s;const n=null!==(t=o.metadata?.[e.id])&&void 0!==t?t:"",l=null!==(s=a[e.id])&&void 0!==s?s:"";return String(n)!==String(l)}),r=null!==(s=o.excerpt)&&void 0!==s?s:"",c=null!==(n=a.excerpt)&&void 0!==n?n:"",i=String(r)!==String(c);return l||i}).map(([e,a])=>{var n,o;const l=d.find(t=>t.id.toString()===e),r={};t.forEach(e=>{var t,s;const n=null!==(t=l.metadata?.[e.id])&&void 0!==t?t:"",o=null!==(s=a[e.id])&&void 0!==s?s:"";String(n)!==String(o)&&(r[e.id]=o)});const c=String(null!==(n=l.excerpt)&&void 0!==n?n:"")!==String(null!==(o=a.excerpt)&&void 0!==o?o:""),i=[];return Object.keys(r).length>0&&i.push(y()({path:`/${s}/documents/${e}/metadata`,method:"POST",data:r}).then(t=>({type:"metadata",docId:e,result:t}))),c&&i.push(y()({path:`/${s}/documents/${e}`,method:"PUT",data:{excerpt:a.excerpt}}).then(t=>({type:"excerpt",docId:e,result:t}))),Promise.all(i)}),c=await Promise.allSettled(a.flat()),u=c.filter(e=>"rejected"===e.status).map(e=>({result:e.reason,docId:e.value?.docId||"unknown"})),g=c.filter(e=>"fulfilled"===e.status).flatMap(e=>Array.isArray(e.value)?e.value:[e.value]).filter(e=>e);if(u.length>0&&(u.forEach(({result:e,docId:t})=>{l&&l("metadata",t,e.reason,{showNotice:!1})}),r&&r("warning",(0,n.sprintf)(/* translators: %1$d: number of failed updates, %2$d: total number of updates */ /* translators: %1$d: number of failed updates, %2$d: total number of updates */
(0,n.__)("%1$d of %2$d metadata updates failed. You can retry the failed operations.","bcgov-design-system"),u.length,Object.keys(e).length),0)),g.length>0){const e=d.map(e=>{const t=g.filter(t=>t.docId===e.id.toString());return t.length>0?t[t.length-1].result:e});m(e),"function"==typeof o&&o(e)}0===u.length&&(r&&r("success",(0,n.__)("All metadata changes saved successfully.","bcgov-design-system")),i({type:"CLEAR_BULK_CHANGES"}),i({type:"EXIT_SPREADSHEET_MODE"}))}catch(e){l&&l("bulk-metadata",null,e)}finally{i({type:"SET_IS_SAVING_BULK",payload:!1})}},[c,s,d,t,o,l,r]);return{editingMetadata:c.editingMetadata,editedValues:c.editedValues,errors:c.errors,isSaving:c.isSaving,hasMetadataChanged:u,handleEditMetadata:g,updateEditedField:h,handleSaveMetadata:v,isSpreadsheetMode:c.isSpreadsheetMode,hasMetadataChanges:c.hasMetadataChanges,bulkEditedMetadata:c.bulkEditedMetadata,isSavingBulk:c.isSavingBulk,handleMetadataChange:p,toggleSpreadsheetMode:E,handleSaveBulkChanges:_,localDocuments:d}})({documents:e,metadataFields:M,apiNamespace:R,onUpdateDocuments:k,onError:I,onShowNotification:B}),{uploadingFiles:ve,showUploadFeedback:Ee,handleFiles:ye,closeUploadFeedback:be}=(({onFileDrop:e,onShowNotification:t,onError:s})=>{const[o,l]=(0,a.useState)([]),[r,c]=(0,a.useState)(!1);return{uploadingFiles:o,showUploadFeedback:r,handleFiles:(0,a.useCallback)(a=>{if(c(!0),!a||0===a.length)return t&&t("error",(0,n.__)("No files were selected for upload.","bcgov-design-system")),void c(!1);l([{id:"placeholder",name:(0,n.sprintf)(/* translators: %d: number of files being prepared */ /* translators: %d: number of files being prepared */
(0,n.__)("Preparing %d files…","bcgov-design-system"),a.length),status:"processing",error:null,isPlaceholder:!0}]);const o=a.map(e=>({id:Math.random().toString(36).substr(2,9),name:e.name,originalFile:e,status:"processing",error:null}));l(o);const r=[],i=[];a.forEach(e=>{"application/pdf"===e.type||e.name.toLowerCase().endsWith(".pdf")?r.push(e):i.push(e)}),l(e=>e.map(e=>{const t=a.find(t=>t.name===e.name),s=t&&("application/pdf"===t.type||t.name.toLowerCase().endsWith(".pdf"));return{...e,status:s?"uploading":"error",error:s?null:(0,n.__)("Not a PDF file. Only PDF files are allowed.","bcgov-design-system")}})),i.length>0&&t&&t("warning",(0,n.sprintf)(/* translators: %1$d: number of skipped files, %2$d: total number of files */ /* translators: %1$d: number of skipped files, %2$d: total number of files */
(0,n.__)("%1$d of %2$d files were skipped because they are not PDFs.","bcgov-design-system"),i.length,a.length)),0!==r.length&&r.forEach(t=>{e(t).then(()=>{l(e=>e.map(e=>e.name===t.name?{...e,status:"success"}:e))}).catch(e=>{l(a=>a.map(a=>a.name===t.name?{...a,status:"error",error:e.message||(0,n.__)("Upload failed. Please try again.","bcgov-design-system")}:a)),s&&s("upload",t.name,e,{addToRetryQueue:!1,customMessage:(0,n.sprintf)(/* translators: %1$s: file name, %2$s: error message */ /* translators: %1$s: file name, %2$s: error message */
(0,n.__)('Error uploading "%1$s": %2$s',"bcgov-design-system"),t.name,e.message||(0,n.__)("Upload failed","bcgov-design-system"))})})})},[e,t,s]),closeUploadFeedback:(0,a.useCallback)(()=>{c(!1),l([])},[])}})({onFileDrop:D,onShowNotification:B,onError:I}),_e=(0,a.useCallback)(()=>{O({delete:E,metadata:re})},[E,re,O]),fe=(0,a.useMemo)(()=>({documents:he,selectedDocuments:w,onSelectDocument:C,onSelectAll:N,onDelete:H,onEdit:oe,onRestore:q,isDeleting:S,metadataFields:M,isSpreadsheetMode:ce,bulkEditedMetadata:de,onMetadataChange:ue,formatFileSize:P,documentStatusFilter:T}),[he,w,C,N,S,M,ce,de,oe,ue,P,H,q]),{totalDocumentCount:Se,trashedCount:we}=(0,a.useMemo)(()=>({totalDocumentCount:Object.entries(x).reduce((e,[t,a])=>"trash"!==t?e+Number(a||0):e,0),trashedCount:Number(x.trash||0)}),[x]);return(0,t.createElement)(l,null,(0,t.createElement)("div",{className:"document-list"},(0,t.createElement)(v,{failedOperations:A,onRetryAll:_e}),(0,t.createElement)("div",{className:"document-list__actions"},(0,t.createElement)("div",{className:"document-list__left-actions"}),(0,t.createElement)("div",{className:"document-list__right-actions"},(0,t.createElement)(p,{onFilesSelected:e=>{ye(e)}}))),(0,t.createElement)("ul",{className:"subsubsub document-status-filters"},(0,t.createElement)("li",{className:"all"},(0,t.createElement)("a",{href:"#",className:i(T)?"current":"",onClick:e=>{e.preventDefault(),F&&F("all")}},(0,n.__)("All","bcgov-design-system")," ",(0,t.createElement)("span",{className:"count"},"( ",Se," )"))),(0,t.createElement)("li",{className:"trash"}," | ",(0,t.createElement)("a",{href:"#",className:c(T)?"current":"",onClick:e=>{e.preventDefault(),F&&F("trash")}},(0,n.__)("Trash","bcgov-design-system ")," ",(0,t.createElement)("span",{className:"count"},"( ",we," )")))),(0,t.createElement)("div",{className:"document-list__table-actions"},(0,t.createElement)("div",{className:"action-buttons-container"},(0,t.createElement)(s.Button,{className:"doc-repo-button spreadsheet-toggle"+(ce?" isPressed":""),onClick:()=>ge(!ce),isPressed:ce},ce?(0,n.__)("Exit Spreadsheet Mode","bcgov-design-system"):(0,n.__)("Enter Spreadsheet Mode","bcgov-design-system")),ce&&ie&&(0,t.createElement)(s.Button,{className:"doc-repo-button save-button",onClick:pe,isBusy:me,disabled:me},me?(0,n.__)("Saving…","bcgov-design-system"):(0,n.__)("Save Changes","bcgov-design-system")),c(T)&&w.length>0&&(0,t.createElement)(s.Button,{className:"doc-repo-button save-button bulk-restore-button",onClick:J,disabled:j},(0,n.sprintf)(/* translators: %d: number of selected documents */ /* translators: %d: number of selected documents */
(0,n.__)("Restore Selected (%d)","bcgov-design-system"),w.length)),w.length>0&&(0,t.createElement)(s.Button,{className:"doc-repo-button delete-button bulk-delete-button",onClick:Q,disabled:V},(0,n.sprintf)(/* translators: %d: number of selected documents */ /* translators: %d: number of selected documents */
(0,n.__)(c(T)?"Delete Selected Permanently (%d)":"Trash Selected (%d)","bcgov-design-system"),w.length)))),(0,t.createElement)(m,{...fe}),(0,t.createElement)(h,{currentPage:o,totalPages:r,onPageChange:d}),Ee&&(0,t.createElement)(u,{uploadingFiles:ve,showUploadFeedback:Ee,onClose:be}),U&&(0,t.createElement)(g,{title:c(T)?(0,n.__)("Delete Document Permanently","bcgov-design-system"):(0,n.__)("Trash Document","bcgov-design-system"),isOpen:!!U,onClose:()=>H(null),onSave:()=>W(U.id),isSaving:S,isDisabled:!1,saveButtonText:S?(0,n.__)(c(T)?"Deleting…":"Trashing…","bcgov-design-system"):(0,n.__)(c(T)?"Delete Permanently":"Trash","bcgov-design-system"),saveButtonClassName:"doc-repo-button delete-button"},(0,t.createElement)("div",{className:"delete-confirmation-content"},(0,t.createElement)("div",{className:"delete-warning"},(0,n.__)(c(T)?"Are you sure you want to delete this document? This action cannot be undone.":"Are you sure you want to trash this document?","bcgov-design-system")),(0,t.createElement)("div",{className:"documents-to-delete"},(0,t.createElement)("h4",null,(0,n.__)(c(T)?"Document to be deleted:":"Document to be trashed:","bcgov-design-system")),(0,t.createElement)("ul",null,(0,t.createElement)("li",null,U.title))))),$&&(0,t.createElement)(g,{title:(0,n.__)("Restore Document","bcgov-design-system"),isOpen:!!$,onClose:()=>q(null),onSave:()=>X($.id),isSaving:S,isDisabled:!1,saveButtonText:(0,n.__)("Restore","bcgov-design-system"),saveButtonClassName:"doc-repo-button save-button"},(0,t.createElement)("div",{className:"restore-confirmation-content"},(0,t.createElement)("div",{className:"restore-warning"},(0,n.__)("Are you sure you want to restore this document?","bcgov-design-system")),(0,t.createElement)("div",{className:"documents-to-restore"},(0,t.createElement)("h4",null,(0,n.__)("Document to be restored:","bcgov-design-system")),(0,t.createElement)("ul",null,(0,t.createElement)("li",null,$.title))))),L&&(0,t.createElement)(g,{title:c(T)?(0,n.__)("Delete Selected Documents Permanently","bcgov-design-system"):(0,n.__)("Trash Selected Documents","bcgov-design-system"),isOpen:L,onClose:Z,onSave:()=>G(w),isSaving:V,isDisabled:!1,saveButtonText:V?(0,n.__)(c(T)?"Deleting…":"Trashing…","bcgov-design-system"):(0,n.__)(c(T)?"Delete Selected Permanently":"Trash Selected","bcgov-design-system"),saveButtonClassName:"doc-repo-button delete-button"},(0,t.createElement)("div",{className:"delete-confirmation-content"},(0,t.createElement)("div",{className:"delete-warning"},(0,n.__)(c(T)?"Are you sure you want to delete the selected documents? This action cannot be undone.":"Are you sure you want to trash the selected documents?","bcgov-design-system")),(0,t.createElement)("div",{className:"documents-to-delete"},(0,t.createElement)("h4",null,(0,n.sprintf)(c(T)?(0,n.__)("Documents to be deleted (%d):","bcgov-design-system"):(0,n.__)("Documents to be trashed (%d):","bcgov-design-system"),w.length)),(0,t.createElement)("ul",null,he.filter(e=>w.includes(e.id)).map(e=>(0,t.createElement)("li",{key:e.id},e.title)))))),z&&(0,t.createElement)(g,{title:(0,n.__)("Restore Selected Documents","bcgov-design-system"),isOpen:z,onClose:Y,onSave:()=>K(w),isSaving:j,isDisabled:!1,saveButtonText:j?(0,n.__)("Restoring…","bcgov-design-system"):(0,n.__)("Restore Selected","bcgov-design-system"),saveButtonClassName:"doc-repo-button save-button"},(0,t.createElement)("div",{className:"restore-confirmation-content"},(0,t.createElement)("div",{className:"restore-warning"},(0,n.__)("Are you sure you want to restore the selected documents?","bcgov-design-system")),(0,t.createElement)("div",{className:"documents-to-restore"},(0,t.createElement)("h4",null,(0,n.sprintf)((0,n.__)("Documents to be restored (%d):","bcgov-design-system"),w.length)),(0,t.createElement)("ul",null,he.filter(e=>w.includes(e.id)).map(e=>(0,t.createElement)("li",{key:e.id},e.title)))))),ee&&(0,t.createElement)(g,{title:(0,n.__)("Edit Document Metadata","bcgov-design-system"),isOpen:!!ee,onClose:()=>oe(null),onSave:re,isSaving:se,isDisabled:!ne,saveButtonText:se?(0,n.__)("Saving…","bcgov-design-system"):(0,n.__)("Save Changes","bcgov-design-system"),saveButtonClassName:"doc-repo-button save-button"},(0,t.createElement)("div",{className:"editable-metadata"},(0,t.createElement)("div",{className:"metadata-field"},(0,t.createElement)("label",{htmlFor:"excerpt"},(0,n.__)("Excerpt","bcgov-design-system")),(0,t.createElement)(s.TextareaControl,{id:"excerpt",value:te.excerpt||"",onChange:e=>{le("excerpt",e),setTimeout(()=>{const e=document.getElementById("excerpt");e&&(e.style.height="auto",e.style.height=e.scrollHeight+"px")},0)},placeholder:(0,n.__)("Enter excerpt…","bcgov-design-system"),rows:3,className:"excerpt-textarea"})),M.map(e=>(0,t.createElement)("div",{key:e.id,className:"metadata-field"},(0,t.createElement)("label",{htmlFor:e.id},e.label),"taxonomy"===e.type?(0,t.createElement)(s.SelectControl,{id:e.id,value:te[e.id]||"",options:[{label:(0,n.__)("Select…","bcgov-design-system"),value:""},...(e.options||[]).map(e=>"string"==typeof e?{label:e,value:e}:{label:e.label||e.name,value:e.value||e.id})],onChange:t=>le(e.id,t)}):(0,t.createElement)(s.TextControl,{id:e.id,type:"date"===e.type?"date":"text",value:te[e.id]||"",onChange:t=>le(e.id,t)}),ae[e.id]&&(0,t.createElement)("div",{className:"metadata-error"},ae[e.id])))),(0,t.createElement)("div",{className:"non-editable-metadata"},(0,t.createElement)("h3",null,(0,n.__)("Document Information","bcgov-design-system")),(0,t.createElement)("div",{className:"metadata-field"},(0,t.createElement)("label",{htmlFor:"document-filename"},(0,n.__)("Filename","bcgov-design-system")),(0,t.createElement)("div",{id:"document-filename",className:"field-value"},(ee.metadata?.document_file_name||ee.filename||ee.title||"").replace(/\.pdf$/i,"")||(0,n.__)("Not available","bcgov-design-system"))),(0,t.createElement)("div",{className:"metadata-field"},(0,t.createElement)("label",{htmlFor:"document-file-type"},(0,n.__)("File Type","bcgov-design-system")),(0,t.createElement)("div",{id:"document-file-type",className:"field-value"},ee.metadata?.document_file_type||"PDF")),(0,t.createElement)("div",{className:"metadata-field"},(0,t.createElement)("label",{htmlFor:"document-file-size"},(0,n.__)("File Size","bcgov-design-system")),(0,t.createElement)("div",{id:"document-file-size",className:"field-value"},ee.metadata?.document_file_size?P(parseInt(ee.metadata.document_file_size)):(0,n.__)("Not available","bcgov-design-system")))))))},f=({metadataFields:e,onUploadSuccess:o,selectedFile:l=null,modalMode:r=!1})=>{const[c,i]=(0,a.useState)(l),[d,m]=(0,a.useState)(!1),[u,g]=(0,a.useState)(0),[p,h]=(0,a.useState)(null),[v,E]=(0,a.useState)(!1),[y,b]=(0,a.useState)(!1),_=(0,a.useRef)(null),f=(0,a.useRef)(null),[S,w]=(0,a.useState)(l?l.name.split(".")[0]:""),[C,N]=(0,a.useState)({}),{apiNamespace:D,maxFileSize:k,allowedMimeTypes:M}=window.documentRepositorySettings,x=(0,a.useCallback)(e=>{if(!e)return!1;if(e.size>k){const t=`File "${e.name}" is too large (${(e.size/1048576).toFixed(2)} MB). Maximum allowed size is ${(k/1048576).toFixed(2)} MB.`;return h(t),!1}const t=e.name.split(".").pop().toLowerCase(),a=Object.keys(M);if(!a.includes(t)){const t=`File "${e.name}" has an invalid file type. Allowed types are: ${a.join(", ")}`;return h(t),!1}return h(null),!0},[k,M]),T=(0,a.useCallback)(e=>{if(!e)return!1;if(x(e)){i(e);const t=e.name.includes(".")?e.name.substring(0,e.name.lastIndexOf(".")):e.name;return w(t),!0}return!1},[x]);(0,a.useEffect)(()=>{if(l&&(w(l.name.replace(/\.[^/.]+$/,"")),!x(l)))return{error:"Initial file validation failed, but still setting file for UI"}},[l,x]),(0,a.useEffect)(()=>{r&&!c&&l&&i(l)},[r,l,c]);const F=e=>{const t=e.target.files[0];T(t)},P=()=>{_.current&&_.current.click()},R=(e,t)=>{N(a=>({...a,[e]:t}))},B=async()=>{if(!c)return void h("Please select a file to upload.");if(!x(c))return;m(!0),h(null),g(0);const e=new FormData;e.append("file",c),e.append("title",S),e.append("_wpnonce",window.documentRepositorySettings.nonce);const t={...C,document_repository:!0},a=JSON.stringify(t);e.append("metadata",a);try{const t=await fetch(`${window.documentRepositorySettings.apiRoot}${D}/documents`,{method:"POST",headers:{"X-WP-Nonce":window.documentRepositorySettings.nonce},body:e});if(!t.ok){const e=await t.json();throw new Error(e.message||"Upload failed")}const a=await t.json();E(!0),m(!1),o&&o(a.document),r||(i(null),w(""),N({}))}catch(e){h(e.message||"Failed to upload file. Please try again."),m(!1)}},A=e=>{const{id:a,label:o,type:l,options:r,required:c}=e;switch(l){case"text":return(0,t.createElement)(s.TextControl,{key:a,label:o,value:C[a]||"",onChange:e=>R(a,e),required:c});case"date":return(0,t.createElement)(s.TextControl,{key:a,label:o,type:"date",value:C[a]||"",onChange:e=>R(a,e),required:c});case"taxonomy":return(0,t.createElement)(s.SelectControl,{key:a,label:o,value:C[a]||"",options:[{label:(0,n.__)("Select…","bcgov-design-system"),value:""},...(r||[]).map(e=>"string"==typeof e?{label:e,value:e}:{label:e.label||e.name,value:e.value||e.id})],onChange:e=>R(a,e),required:c});default:return null}},I=()=>d?(0,t.createElement)(t.Fragment,null,(0,t.createElement)(s.Spinner,null),(0,n.__)("Uploading…","bcgov-design-system")):(0,n.__)("Upload Document","bcgov-design-system");return r?(0,t.createElement)("div",{className:"document-uploader-modal"},p&&(0,t.createElement)(s.Notice,{status:"error",isDismissible:!0,onRemove:()=>h(null)},p),v&&(0,t.createElement)(s.Notice,{status:"success",isDismissible:!0,onRemove:()=>E(!1)},(0,n.__)("Document uploaded successfully!","bcgov-design-system")),(0,t.createElement)("div",{className:"selected-file-info"},c?(0,t.createElement)("p",null,(0,t.createElement)("strong",null,"File:")," ",c.name," (",Math.round(c.size/1024)," KB)"):l?(0,t.createElement)("p",null,(0,t.createElement)("strong",null,"File:")," ",l.name," (",Math.round(l.size/1024)," KB)"):(0,t.createElement)("p",null,(0,t.createElement)("strong",null,"Warning:")," No file selected")),(0,t.createElement)(s.TextControl,{label:(0,n.__)("Document Title","bcgov-design-system"),value:S,onChange:w,disabled:d,required:!0}),(0,t.createElement)("h4",null,(0,n.__)("Document Metadata","bcgov-design-system")),(0,t.createElement)("div",{className:"metadata-fields modal-layout"},e.map(A)),d&&(0,t.createElement)("div",{className:"upload-progress"},(0,t.createElement)("progress",{value:u,max:"100"}),(0,t.createElement)("p",null,u,"%"," ",(0,n.__)("Uploaded","bcgov-design-system"))),(0,t.createElement)("div",{className:"modal-actions"},(0,t.createElement)(s.Button,{isPrimary:!0,onClick:B,disabled:!c&&!l||!S||d},I()))):(0,t.createElement)(s.Card,{className:"document-uploader"},(0,t.createElement)(s.CardHeader,null,(0,t.createElement)("h3",null,(0,n.__)("Upload Document","bcgov-design-system"))),(0,t.createElement)(s.CardBody,null,(0,t.createElement)(t.Fragment,null,v&&(0,t.createElement)(s.Notice,{status:"success",isDismissible:!0,onRemove:()=>E(!1)},(0,n.__)("Document uploaded successfully!","bcgov-design-system")),p&&(0,t.createElement)(s.Notice,{status:"error",isDismissible:!0,onRemove:()=>h(null)},p),!r&&!c&&(0,t.createElement)("div",{className:"upload-area__container "+(y?"upload-area__container--drag-active":""),onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),b(!0)},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),b(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation();const t=f.current.getBoundingClientRect();(e.clientX<t.left||e.clientX>=t.right||e.clientY<t.top||e.clientY>=t.bottom)&&b(!1)},onDrop:e=>{e.preventDefault(),e.stopPropagation(),b(!1);const t=Array.from(e.dataTransfer.files);var a;t.length>0&&(a=t[0],T(a))},onClick:P,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||P()},role:"button",tabIndex:"0",ref:f},(0,t.createElement)("input",{type:"file",ref:_,onChange:F,className:"upload-area__file-input",accept:Object.values(M).join(",")}),(0,t.createElement)("div",{className:"upload-area__content"},(0,t.createElement)("div",{className:"upload-area__icon"},(0,t.createElement)("svg",{viewBox:"0 0 64 64",width:"64",height:"64"},(0,t.createElement)("path",{d:"M32 16v24M20 28l12-12 12 12",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.createElement)("path",{d:"M16 48h32M12 20v28c0 2.2 1.8 4 4 4h32c2.2 0 4-1.8 4-4V20",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}))),(0,t.createElement)("div",{className:"upload-area__text"},(0,t.createElement)("p",{className:"upload-area__text-primary"},y?(0,n.__)("Drop file here","bcgov-design-system"):(0,n.__)("Drag & drop your file here or click to browse","bcgov-design-system")),(0,t.createElement)("p",{className:"upload-area__help-text"},(0,n.__)("Accepted file types:","bcgov-design-system")," ",Object.keys(M).join(", ")),(0,t.createElement)("p",{className:"upload-area__help-text"},(0,n.__)("Maximum file size:","bcgov-design-system")," ",Math.round(k/1048576)," ","MB")))),r&&!c&&(0,t.createElement)("div",{className:"document-uploader-file-select"},(0,t.createElement)(s.FormFileUpload,{accept:Object.values(M).join(","),onChange:F},(0,n.__)("Select a different file","bcgov-design-system"))),c&&(0,t.createElement)("div",{className:"selected-file-container"},(0,t.createElement)("div",{className:"selected-file"},(0,t.createElement)("span",{className:"file-name"},c.name),(0,t.createElement)("button",{type:"button",className:"remove-file",onClick:()=>i(null)},"✕")),!r&&(0,t.createElement)(s.FormFileUpload,{accept:Object.values(M).join(","),onChange:F},(0,n.__)("Select a different file","bcgov-design-system"))),d&&(0,t.createElement)("div",{className:"upload-progress"},(0,t.createElement)("progress",{value:u,max:"100"}),(0,t.createElement)("p",null,u,"%"," ",(0,n.__)("Uploaded","bcgov-design-system"))),(0,t.createElement)(s.TextControl,{label:(0,n.__)("Document Title","bcgov-design-system"),value:S,onChange:w,disabled:d,required:!0}),(0,t.createElement)("h4",null,(0,n.__)("Document Metadata","bcgov-design-system")),(0,t.createElement)("div",{className:"metadata-fields "+(r?"modal-layout":"")},e.map(A)))),(0,t.createElement)(s.CardFooter,null,(0,t.createElement)("div",{className:"card-actions"},(0,t.createElement)(s.Button,{isPrimary:!0,onClick:B,disabled:!c||!S||d},I()))))};class S extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({errorInfo:t})}render(){return this.state.hasError?(0,t.createElement)("div",{className:"wordpress-document-repository-error"},(0,t.createElement)(s.Notice,{status:"error",isDismissible:!1},(0,t.createElement)("h2",null,(0,n.__)("Something went wrong in the Document Repository","bcgov-design-system")),(0,t.createElement)("p",null,this.state.error&&this.state.error.toString()),(0,t.createElement)("details",{style:{whiteSpace:"pre-wrap"}},this.state.errorInfo&&this.state.errorInfo.componentStack))):this.props.children}}const w=S,C=()=>{const[e,o]=(0,a.useState)(!0),[l,r]=(0,a.useState)(null),[c,d]=(0,a.useState)("Initializing"),[m,u]=(0,a.useState)([]),[g,p]=(0,a.useState)(!1),[h,v]=(0,a.useState)(!1),[E,b]=(0,a.useState)(null),[S,C]=(0,a.useState)("all"),[N,D]=(0,a.useState)([]),{documents:k,totalDocuments:M,currentPage:x,totalPages:T,statusCounts:F,fetchDocuments:P,deleteDocument:R,trashDocument:B,restoreDocument:A,isDeleting:I,isLoading:O,error:U,setSearchParams:$}=(()=>{const[e,t]=(0,a.useState)([]),[s,n]=(0,a.useState)(0),[o,l]=(0,a.useState)(1),[r,c]=(0,a.useState)(1),[i,d]=(0,a.useState)({}),[m,u]=(0,a.useState)(!1),[g,p]=(0,a.useState)(!1),[h,v]=(0,a.useState)(null),[E,b]=(0,a.useState)({page:1,per_page:window.documentRepositorySettings?.perPage||20,orderby:"date",order:"DESC",status:"all"}),_=(0,a.useCallback)(async()=>{if(window.documentRepositorySettings?.apiNamespace){u(!0),v(null);try{const{apiNamespace:e}=window.documentRepositorySettings,a=new URLSearchParams;Object.entries(E).forEach(([e,t])=>{t&&a.append(e,t)});const s=new Promise((e,t)=>{setTimeout(()=>{t(new Error("Document fetch request timed out. Please try again."))},5e3)}),o=await Promise.race([y()({path:`/${e}/documents?${a.toString()}`}),s]);if(!o||"object"!=typeof o)throw new Error("Invalid response from server");const r=Array.isArray(o.documents)?o.documents.filter(e=>e&&"object"==typeof e&&e.id):[];t(r),n(o.total||0),l(o.current_page||1),c(o.total_pages||1),d(o.status_counts||{}),0===r.length&&E.page>1&&b(e=>({...e,page:1}))}catch(e){v(e.message||"Error loading documents"),1===E.page&&(t([]),n(0),c(1))}finally{u(!1)}}else v("Document Repository settings not found. Make sure the script is properly enqueued in WordPress.")},[E]);(0,a.useEffect)(()=>{const e=parseInt(E.page,10);isNaN(e)||e===o||l(e)},[E.page,o]),(0,a.useEffect)(()=>{_()},[_]);const f=async e=>{p(!0);try{const{apiNamespace:t}=window.documentRepositorySettings;return await y()({path:`/${t}/documents/${e}?force=true`,method:"DELETE"}),await _(),p(!1),!0}catch(e){return v(e.message||"Error deleting document"),p(!1),!1}},S=async(e,t)=>{try{const{apiNamespace:a}=window.documentRepositorySettings,s=await y()({path:`/${a}/documents/${e}`,method:"PUT",data:t});return await _(),s}catch(e){return v(e.message||"Error updating document"),null}};return{documents:e,totalDocuments:s,currentPage:o,totalPages:r,statusCounts:i,isLoading:m,isDeleting:g,error:h,searchParams:E,setSearchParams:b,fetchDocuments:_,deleteDocument:f,trashDocument:async e=>{p(!0);try{const{apiNamespace:t}=window.documentRepositorySettings;return await y()({path:`/${t}/documents/${e}?force=false`,method:"DELETE"}),await _(),p(!1),!0}catch(e){return v(e.message||"Error trashing document"),p(!1),!1}},restoreDocument:async e=>{p(!0);try{const{apiNamespace:t}=window.documentRepositorySettings;return await y()({path:`/${t}/documents/${e}/restore`,method:"POST"}),await _(),p(!1),!0}catch(e){return v(e.message||"Error restoring document"),p(!1),!1}},updateDocument:S,bulkUpdateDocuments:async(e,t)=>{try{for(const a of e)await S(a,t);return await _(),!0}catch(e){return v(e.message||"Error performing bulk update"),!1}},bulkDeleteDocuments:async e=>{try{for(const t of e)await f(t);return!0}catch(e){return v(e.message||"Error performing bulk delete"),!1}}}})();(0,a.useEffect)(()=>{(async()=>{try{o(!0),r(null),d("Initializing");const e=new Promise((e,t)=>{setTimeout(()=>{t(new Error((0,n.__)("Loading document repository timed out. Please refresh the page.","bcgov-design-system")))},1e4)}),t=window.documentRepositorySettings;if(!t?.apiRoot||!t?.apiNamespace||!t?.nonce)throw new Error((0,n.__)("Document Repository settings not found. Make sure the script is properly enqueued in WordPress.","bcgov-design-system"));await Promise.race([(async()=>{d("Fetching metadata fields");const e=await fetch(`${t.apiRoot}${t.apiNamespace}/metadata-fields`,{headers:{"X-WP-Nonce":t.nonce}});if(!e.ok){let t;try{const a=await e.json();t=a.message||a.error}catch(a){t=e.statusText}throw new Error((0,n.__)("Failed to fetch metadata fields: ","bcgov-design-system")+t)}const a=await e.json();u(a),d("Loading documents"),await P()})(),e])}catch(e){r(e.message||(0,n.__)("Failed to initialize document repository","bcgov-design-system"))}finally{o(!1)}})()},[P]),(0,a.useEffect)(()=>{$(e=>({...e,status:i(S)?void 0:S,page:1})),D([])},[S]);const[L,z]=(0,a.useState)([]),[V,j]=(0,a.useState)(0),[H,q]=(0,a.useState)(0),G=(0,a.useMemo)(()=>{let e;return(...t)=>{clearTimeout(e),e=setTimeout(()=>P(...t),1e3)}},[P]),K=()=>{G(),p(!1),b(null),z([]),j(0)},W=async e=>{try{if(!e.type.includes("pdf")&&!e.name.toLowerCase().endsWith(".pdf"))throw new Error("Only PDF files are allowed");const t=new FormData;t.append("file",e),t.append("title",e.name.split(".")[0]);const a=window.documentRepositorySettings?.nonce;if(!a)throw new Error("Security token not found");const s=new window.XMLHttpRequest,n=new Promise((n,o)=>{s.open("POST",`${window.documentRepositorySettings.apiRoot}${window.documentRepositorySettings.apiNamespace}/documents`),s.setRequestHeader("X-WP-Nonce",a),s.upload.onprogress=e=>{if(e.lengthComputable){const t=Math.round(e.loaded/e.total*100);q(t)}},s.onload=()=>{if(s.status>=200&&s.status<300)try{const e=JSON.parse(s.responseText);n(e)}catch(t){o(new Error(`Error uploading "${e.name}": Server returned invalid response`))}else{let t;try{const e=JSON.parse(s.responseText);t=e.message||e.error||s.statusText}catch(e){t=s.statusText||"Server error"}o(new Error(`Error uploading "${e.name}": ${t}`))}},s.onerror=()=>{o(new Error(`Network error while uploading "${e.name}". Please check your connection and try again.`))},s.send(t)});await n,K()}catch(e){throw r(e.message||"Failed to upload file"),e}},X=l||U;return(0,a.useEffect)(()=>{if(X){const e=setTimeout(()=>{r(null)},3e3);return()=>clearTimeout(e)}},[X]),e?(0,t.createElement)("div",{className:"wordpress-document-repository-loading"},(0,t.createElement)(s.Spinner,null),(0,t.createElement)("p",null,c,"..."),(0,t.createElement)("p",{className:"loading-description"},(0,n.__)("Loading document repository…","bcgov-design-system"))):(0,t.createElement)(w,null,(0,t.createElement)("div",{className:"wordpress-document-repository"},X&&(0,t.createElement)(s.Notice,{status:"error",isDismissible:!0,onDismiss:()=>r(null),className:"document-repository-error"},(0,t.createElement)("p",null,X)),(0,t.createElement)(_,{documents:k||[],isLoading:O,totalItems:M,currentPage:x||1,totalPages:T||1,onPageChange:async e=>{try{r(null),$(t=>({...t,page:e}))}catch(e){r(e.message||(0,n.__)("Failed to change page","bcgov-design-system")),$(e=>({...e,page:x}))}},onDelete:R,onTrash:B,onRestore:A,isDeleting:I,selectedDocuments:N||[],onSelectDocument:e=>{try{const t=N.includes(e)?N.filter(t=>t!==e):[...N,e];D(t)}catch(e){r((0,n.__)("Failed to select document","bcgov-design-system"))}},onSelectAll:e=>{try{D(e?k.map(e=>e.id):[])}catch(e){r((0,n.__)("Failed to select documents","bcgov-design-system"))}},metadataFields:m||[],onUploadSuccess:K,onFileDrop:W,statusCounts:F,documentStatusFilter:S,onStatusFilterChange:C}),g&&E&&(0,t.createElement)(s.Modal,{title:L.length>1?(0,n.__)("Upload Documents","bcgov-design-system"):(0,n.__)("Upload Document","bcgov-design-system"),onRequestClose:()=>v(!0),className:"document-upload-modal"},(0,t.createElement)("div",{className:"upload-progress-info"},L.length>1&&(0,t.createElement)("p",{className:"upload-queue-status"},(0,n.__)("Uploading file","bcgov-design-system")," ",V+1," ",(0,n.__)("of","bcgov-design-system")," ",L.length),(0,t.createElement)("div",{className:"progress-bar"},(0,t.createElement)("div",{className:"progress-bar-fill",style:{width:`${H}%`}}))),(0,t.createElement)(f,{metadataFields:m,onUploadSuccess:K,selectedFile:E,modalMode:!0,onFileDrop:W})),h&&(0,t.createElement)(s.Modal,{title:(0,n.__)("Cancel Upload","bcgov-design-system"),onRequestClose:()=>v(!1),className:"cancel-upload-modal"},(0,t.createElement)("p",null,(0,n.__)("Are you sure you want to cancel the remaining uploads?","bcgov-design-system")),(0,t.createElement)("div",{className:"modal-actions"},(0,t.createElement)(s.Button,{className:"doc-repo-button",onClick:()=>v(!1)},(0,n.__)("Continue Upload","bcgov-design-system")),(0,t.createElement)(s.Button,{className:"doc-repo-button",isDestructive:!0,onClick:()=>{p(!1),b(null),z([]),j(0),v(!1)}},(0,n.__)("Cancel Upload","bcgov-design-system"))))))};document.addEventListener("DOMContentLoaded",()=>{try{const e=document.getElementById("wordpress-document-repository-app");if(e)(0,a.createRoot)(e).render((0,t.createElement)(C,null));else{const e=document.createElement("div");e.style.color="red",e.style.padding="20px",e.style.border="1px solid red",e.innerHTML="<strong>Error:</strong> Document Repository container not found. Check console for details.",document.body.prepend(e)}}catch(e){const t=document.createElement("div");t.style.color="red",t.style.padding="20px",t.style.border="1px solid red",t.innerHTML=`<strong>Error:</strong> Failed to initialize Document Repository app: ${e.message}`,document.body.prepend(t)}})})();