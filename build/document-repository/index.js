<<<<<<< HEAD
(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,a=window.wp.element,n=window.wp.components,s=window.wp.i18n;class l extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}renderError(){return(0,t.createElement)("div",{className:"error-boundary"},(0,t.createElement)("h2",null,(0,s.__)("Something went wrong.","bcgov-design-system")),(0,t.createElement)("p",null,(0,s.__)("Please try refreshing the page.","bcgov-design-system")),!1)}renderContent(){return this.props.children}render(){return this.state.hasError?this.renderError():this.renderContent()}}const o=l;class r extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}renderError(){return(0,t.createElement)("div",{className:"document-table-row error",role:"row"},(0,t.createElement)("div",{className:"document-table-cell",role:"cell",style:{textAlign:"center"}},(0,s.__)("Error rendering document row.","bcgov-design-system"),!1))}renderContent(){return this.props.children}render(){return this.state.hasError?this.renderError():this.renderContent()}}function c(e){return"trash"===e}function i(e){return"all"===e}function d({document:e,isSelected:a,onSelect:l,onDelete:o,onEdit:r,onRestore:i,isDeleting:d,metadataFields:m,isSpreadsheetMode:u,bulkEditedMetadata:g,onMetadataChange:p,formatFileSize:h,documentStatusFilter:E}){return(0,t.createElement)("div",{className:"document-table-row",role:"row"},(0,t.createElement)("div",{className:"document-table-cell",role:"cell","aria-label":(0,s.__)("Select document","bcgov-design-system")},(0,t.createElement)(n.CheckboxControl,{checked:a,onChange:()=>l(e.id)})),(0,t.createElement)("div",{className:"document-table-cell",role:"cell"},e.title||e.filename),m.map(a=>(0,t.createElement)("div",{key:a.id,className:"document-table-cell metadata-column",role:"cell","aria-label":(0,s.sprintf)(/* translators: %s: field label */ /* translators: %s: field label */
(0,s.__)("Edit %s","bcgov-design-system"),a.label)},(a=>{if(!u){const t=e.metadata&&e.metadata[a.id]?e.metadata[a.id]:"";if("taxonomy"===a.type&&t){const e=Array.isArray(t)?t:[t];return 1===e.length?e[0]:e.join(", ")}return t||"—"}const l=g[e.id]?.[a.id]||"";if("taxonomy"===a.type){const o=(a.options||[]).map(e=>"string"==typeof e?{label:e,value:e}:{label:e.label||e.name,value:e.label||e.name});return(0,t.createElement)(n.SelectControl,{value:l,options:[{label:(0,s.__)("Select…","bcgov-design-system"),value:""},...o],onChange:t=>p(e.id,a.id,t)})}return(0,t.createElement)(n.TextControl,{type:"date"===a.type?"date":"text",value:l,onChange:t=>p(e.id,a.id,t),className:"metadata-input"})})(a))),(0,t.createElement)("div",{className:"document-table-cell",role:"cell"},e.metadata&&e.metadata.document_file_size?h(e.metadata.document_file_size):"—"),(0,t.createElement)("div",{className:"document-table-cell",role:"cell"},e.metadata&&e.metadata.document_file_type?e.metadata.document_file_type:"—"),(0,t.createElement)("div",{className:"document-table-cell actions",role:"cell","aria-label":(0,s.__)("Document actions","bcgov-design-system")},!u&&(0,t.createElement)("div",{className:"action-buttons"},c(E)?(0,t.createElement)(t.Fragment,null,(0,t.createElement)(n.Button,{onClick:()=>i(e),className:"doc-repo-button icon-button table-action-button",title:(0,s.__)("Restore","bcgov-design-system"),"aria-label":(0,s.__)("Restore","bcgov-design-system"),disabled:d},(0,t.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",width:"16px",height:"16px"},(0,t.createElement)("path",{d:"M440-320h80v-166l64 62 56-56-160-160-160 160 56 56 64-62v166ZM280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Z",fill:"currentColor"}))),(0,t.createElement)(n.Button,{onClick:()=>o(e),className:"doc-repo-button icon-button table-action-button",title:(0,s.__)("Delete Permanently","bcgov-design-system"),"aria-label":(0,s.__)("Delete Permanently","bcgov-design-system"),disabled:d},(0,t.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",width:"16px",height:"16px"},(0,t.createElement)("path",{d:"m376-300 104-104 104 104 56-56-104-104 104-104-56-56-104 104-104-104-56 56 104 104-104 104 56 56Zm-96 180q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Z",fill:"currentColor"})))):(0,t.createElement)(t.Fragment,null,(0,t.createElement)(n.Button,{onClick:()=>window.open(e.metadata.document_file_url,"_blank"),className:"doc-repo-button icon-button table-action-button",title:(0,s.__)("Download","bcgov-design-system"),"aria-label":(0,s.__)("Download","bcgov-design-system")},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z",fill:"currentColor"}))),(0,t.createElement)(n.Button,{onClick:()=>r(e),className:"doc-repo-button icon-button table-action-button",title:(0,s.__)("Edit Metadata","bcgov-design-system"),"aria-label":(0,s.__)("Edit Metadata","bcgov-design-system")},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"currentColor"}))),(0,t.createElement)(n.Button,{onClick:()=>o(e),className:"doc-repo-button icon-button table-action-button",title:(0,s.__)("Trash","bcgov-design-system"),"aria-label":(0,s.__)("Trash","bcgov-design-system"),disabled:d},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z",fill:"currentColor"})))))))}function m({documents:e,selectedDocuments:a,onSelectDocument:l,onSelectAll:o,onDelete:c,onEdit:i,onRestore:m,isDeleting:u,metadataFields:g,isSpreadsheetMode:p,bulkEditedMetadata:h,onMetadataChange:E,formatFileSize:v,documentStatusFilter:b}){const _=e.length>0&&a.length===e.length;return(0,t.createElement)("div",{className:"document-table",role:"table"},(0,t.createElement)("div",{className:"document-table-header",role:"rowgroup"},(0,t.createElement)("div",{className:"document-table-row",role:"row"},(0,t.createElement)("div",{className:"document-table-cell header",role:"columnheader"},(0,t.createElement)(n.CheckboxControl,{checked:_,onChange:o})),(0,t.createElement)("div",{className:"document-table-cell header",role:"columnheader"},(0,s.__)("Title","bcgov-design-system")),g.map(e=>(0,t.createElement)("div",{key:e.id,className:"document-table-cell header metadata-column",role:"columnheader"},e.label)),(0,t.createElement)("div",{className:"document-table-cell header",role:"columnheader"},(0,s.__)("Size","bcgov-design-system")),(0,t.createElement)("div",{className:"document-table-cell header",role:"columnheader"},(0,s.__)("Type","bcgov-design-system")),(0,t.createElement)("div",{className:"document-table-cell header",role:"columnheader"},(0,s.__)("Actions","bcgov-design-system")))),(0,t.createElement)("div",{className:"document-table-body",role:"rowgroup"},e.map(e=>(0,t.createElement)(r,{key:e.id},(0,t.createElement)(d,{document:e,isSelected:a.includes(e.id),onSelect:l,onDelete:c,onEdit:i,onRestore:m,isDeleting:u,metadataFields:g,isSpreadsheetMode:p,bulkEditedMetadata:h,onMetadataChange:E,formatFileSize:v,documentStatusFilter:b})))))}const u=({documents:e=[],selectedDocuments:l=[],onSelectDocument:o,onSelectAll:r,onDelete:c,onEdit:i,isDeleting:d=!1,metadataFields:m=[],isSpreadsheetMode:u=!1,bulkEditedMetadata:g={},onMetadataChange:p,formatFileSize:h})=>{const{containerRef:E,visibleRange:v,totalHeight:b,topOffset:_}=(({itemHeight:e=60,itemCount:t=0,overscan:n=5,initialHeight:s=500})=>{const l=(0,a.useRef)(null),[o,r]=(0,a.useState)({start:0,end:Math.min(20,t)}),[c,i]=(0,a.useState)(s),d=(0,a.useCallback)(()=>{if(!l.current)return;const a=l.current,s=a.scrollTop,o=a.clientHeight;let c=Math.floor(s/e);c=Math.max(0,c-n);let i=Math.ceil((s+o)/e);i=Math.min(t,i+n),r({start:c,end:i})},[t,e,n]),m=(0,a.useCallback)(()=>{d()},[d]);(0,a.useEffect)(()=>{const e=l.current;if(!e)return;i(e.clientHeight),d(),e.addEventListener("scroll",m);const t=()=>{e&&(i(e.clientHeight),d())};return window.addEventListener("resize",t),()=>{e.removeEventListener("scroll",m),window.removeEventListener("resize",t)}},[d,m]),(0,a.useEffect)(()=>{d()},[t,d]);const u=t*e,g=o.start*e;return{containerRef:l,visibleRange:o,containerHeight:c,totalHeight:u,topOffset:g,handleScroll:m,calculateVisibleRange:d}})({itemHeight:60,itemCount:e.length,overscan:5,initialHeight:500}),y=(0,a.useCallback)(e=>{r(e)},[r]),f=e.length>0&&l.length===e.length,S=l.length>0&&l.length<e.length,w=e.slice(v.start,v.end);return(0,t.createElement)("div",{className:"virtualized-table-container",ref:E},(0,t.createElement)("table",{className:"document-table"},(0,t.createElement)("thead",{className:"document-table__header"},(0,t.createElement)("tr",null,(0,t.createElement)("th",{className:"checkbox-column"},(0,t.createElement)(n.CheckboxControl,{checked:f,indeterminate:S,onChange:y})),(0,t.createElement)("th",null,(0,s.__)("Document","bcgov-design-system")),m.map(e=>(0,t.createElement)("th",{key:e.id},e.label)),(0,t.createElement)("th",null,(0,s.__)("File Size","bcgov-design-system")),(0,t.createElement)("th",{className:"actions-column"},(0,s.__)("Actions","bcgov-design-system")))),(0,t.createElement)("tbody",{style:{height:`${b}px`,position:"relative"}},0===e.length?(0,t.createElement)("tr",null,(0,t.createElement)("td",{colSpan:m.length+4,className:"empty-state"},(0,s.__)("No documents found.","bcgov-design-system"))):(0,t.createElement)("div",{className:"virtualized-rows",style:{position:"absolute",top:`${_}px`,width:"100%"}},w.map(e=>{const a=l.includes(e.id),r=a?"document-table__row document-table__row--selected":"document-table__row";return(0,t.createElement)("tr",{key:e.id,className:r},(0,t.createElement)("td",{className:"checkbox-column"},(0,t.createElement)(n.CheckboxControl,{checked:a,onChange:()=>o(e.id)})),(0,t.createElement)("td",null,(0,t.createElement)("div",{className:"document-cell"},(0,t.createElement)("span",{className:"document-cell__title"},e.title||e.filename||(0,s.__)("Untitled","bcgov-design-system")),(0,t.createElement)("span",{className:"document-cell__metadata"},e.filename||e.title||(0,s.__)("No filename","bcgov-design-system")))),m.map(a=>{var n;const s=e.metadata?.[a.id]||"",l=u&&null!==(n=g[e.id]?.[a.id])&&void 0!==n?n:s;return u?(0,t.createElement)("td",{key:a.id,className:"editable-cell"},(0,t.createElement)("input",{type:"text",className:"editable-field",value:l,onChange:t=>p(e.id,a.id,t.target.value)})):(0,t.createElement)("td",{key:a.id},l)}),(0,t.createElement)("td",{className:"file-size"},e.metadata?.document_file_size?h(parseInt(e.metadata.document_file_size)):(0,s.__)("N/A","bcgov-design-system")),(0,t.createElement)("td",{className:"actions-column"},(0,t.createElement)("div",{className:"action-buttons"},(0,t.createElement)("button",{className:"edit-button",onClick:()=>i(e),title:(0,s.__)("Edit Document","bcgov-design-system")},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},(0,t.createElement)("path",{fill:"currentColor",d:"M20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"}))),e.metadata?.document_file_url&&(0,t.createElement)("a",{href:e.metadata.document_file_url,target:"_blank",rel:"noopener noreferrer",className:"view-button",title:(0,s.__)("View Document","bcgov-design-system")},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},(0,t.createElement)("path",{fill:"currentColor",d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"}))),(0,t.createElement)("button",{className:"delete-button",onClick:()=>c(e),disabled:d,title:(0,s.__)("Delete Document","bcgov-design-system")},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},(0,t.createElement)("path",{fill:"currentColor",d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}))))))})))))},g=({uploadingFiles:e,showUploadFeedback:n,onClose:l})=>{const o=e.filter(e=>"success"===e.status).length,r=e.filter(e=>"error"===e.status).length,c=e.filter(e=>"uploading"===e.status).length,i=e.filter(e=>"processing"===e.status).length,d=e.some(e=>e.isPlaceholder);return(0,a.useEffect)(()=>{if(n&&0===c&&0===i&&!d&&e.length>0){const e=setTimeout(()=>{l()},3e3);return()=>clearTimeout(e)}},[n,c,i,d,l,e.length]),n&&0!==e.length?(0,t.createElement)("div",{className:"upload-feedback"},(0,t.createElement)("div",{className:"upload-feedback-header"},(0,t.createElement)("div",{className:"upload-feedback-title"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z",fill:"currentColor"})),(0,s.__)("Document Upload Status","bcgov-design-system")),(0,t.createElement)("button",{className:"upload-feedback-close",onClick:()=>{0===c&&0===i&&l()}},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z",fill:"currentColor"})))),(0,t.createElement)("div",{className:"upload-feedback-items"},e.map(e=>(0,t.createElement)("div",{key:e.id,className:`upload-feedback-item ${e.status} ${e.isPlaceholder?"placeholder":""}`},(0,t.createElement)("span",{className:"upload-feedback-item-name"},e.name),"processing"===e.status&&(0,t.createElement)(t.Fragment,null,(0,s.__)("Processing…","bcgov-design-system")),"uploading"===e.status&&(0,t.createElement)(t.Fragment,null,(0,s.__)("Uploading…","bcgov-design-system")),"success"===e.status&&(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z",fill:"currentColor"})),"error"===e.status&&(0,t.createElement)(t.Fragment,null,(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z",fill:"currentColor"})),e.error&&(0,t.createElement)("span",{className:"upload-feedback-item-error"},e.error))))),(0,t.createElement)("div",{className:"upload-feedback-summary"},d?(0,t.createElement)("div",{className:"processing"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z",fill:"currentColor"})),(0,s.__)("Preparing files…","bcgov-design-system")):(0,t.createElement)(t.Fragment,null,i>0&&(0,t.createElement)("div",{className:"processing"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z",fill:"currentColor"})),(0,s.sprintf)(/* translators: %d: number of files being processed */ /* translators: %d: number of files being processed */
(0,s.__)("Processing %d files…","bcgov-design-system"),i)),c>0&&(0,t.createElement)("div",{className:"uploading"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z",fill:"currentColor"})),(0,s.sprintf)(/* translators: %d: number of files being uploaded */ /* translators: %d: number of files being uploaded */
(0,s.__)("Uploading %d files…","bcgov-design-system"),c)),o>0&&(0,t.createElement)("div",{className:"success"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z",fill:"currentColor"})),(0,s.sprintf)(/* translators: %d: number of files that were successfully uploaded */ /* translators: %d: number of files that were successfully uploaded */
(0,s.__)("%d files uploaded successfully","bcgov-design-system"),o)),r>0&&(0,t.createElement)("div",{className:"error"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z",fill:"currentColor"})),(0,s.sprintf)(/* translators: %d: number of files that failed to upload */ /* translators: %d: number of files that failed to upload */
(0,s.__)("%d files failed to upload","bcgov-design-system"),r))))):null},p=({title:e,isOpen:l,onClose:o,onSave:r,isSaving:c=!1,isDisabled:i=!1,saveButtonText:d,saveButtonClassName:m="doc-repo-button save-button",children:u})=>{const g=(0,a.useCallback)(e=>{e&&(e.preventDefault(),e.stopPropagation()),o()},[o]),p=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),r()},[r]);return l?(0,t.createElement)(n.Modal,{title:e,onRequestClose:g,className:"metadata-edit-modal",shouldCloseOnClickOutside:!0,shouldCloseOnEsc:!0},(0,t.createElement)("form",{onSubmit:p,className:"metadata-edit-form"},u,(0,t.createElement)("div",{className:"modal-actions"},(0,t.createElement)(n.Button,{onClick:g,disabled:c,className:"doc-repo-button cancel-button"},(0,s.__)("Cancel","bcgov-design-system")),(0,t.createElement)(n.Button,{type:"submit",isBusy:c,disabled:c||i,className:m},d||(0,s.__)("Save Changes","bcgov-design-system"))))):null},h=({onFilesSelected:e,acceptMimeTypes:l="application/pdf"})=>{const[o,r]=(0,a.useState)(!1),c=(0,a.useRef)(null),i=(0,a.useRef)(null);(0,a.useEffect)(()=>()=>{i.current&&clearTimeout(i.current)},[]);const d=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),r(!0)},[]),m=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),o||r(!0)},[o]),u=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),!e.currentTarget.contains(e.relatedTarget)&&(i.current=setTimeout(()=>{r(!1)},50))},[]),g=(0,a.useCallback)(t=>{t.preventDefault(),t.stopPropagation(),r(!1);const a=t.dataTransfer.files;a&&a.length>0&&e(Array.from(a))},[e]),p=(0,a.useCallback)(t=>{const a=Array.from(t.target.files);a.length>0&&e(a)},[e]),h=(0,a.useCallback)(e=>{e&&e.stopPropagation(),c.current&&c.current.click()},[c]),E=(0,a.useCallback)(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),h())},[h]);return(0,t.createElement)("div",{className:"upload-area__container "+(o?"upload-area__container--drag-active":""),onDragEnter:d,onDragOver:m,onDragLeave:u,onDrop:g,onClick:h,onKeyDown:E,tabIndex:"0",role:"button","aria-label":(0,s.__)("Click or drag files to upload","bcgov-design-system")},(0,t.createElement)("input",{type:"file",ref:c,className:"upload-area__file-input",onChange:p,multiple:!0,accept:l,"aria-hidden":"true"}),(0,t.createElement)("div",{className:"upload-area__content"},(0,t.createElement)("div",{className:"upload-area__icon"},(0,t.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"48",height:"48"},(0,t.createElement)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z",fill:"currentColor"}))),(0,t.createElement)("h3",{className:"upload-area__text"},(0,s.__)("Drag & Drop or Click to Upload","bcgov-design-system")),(0,t.createElement)("p",{className:"upload-area__help-text"},(0,s.__)("Upload PDF documents to the repository","bcgov-design-system")),(0,t.createElement)(n.Button,{className:"upload-area__button",onClick:e=>{e.stopPropagation(),h()}},(0,s.__)("Choose Files","bcgov-design-system"))))},E=({currentPage:e,totalPages:a,onPageChange:l})=>a<=1?null:(0,t.createElement)("div",{className:"pagination"},(0,t.createElement)(n.Button,{onClick:()=>l(e-1),disabled:1===e},(0,s.__)("Previous","bcgov-design-system")),(0,t.createElement)("span",{className:"page-info"},(0,s.sprintf)(/* translators: %1$d: current page number, %2$d: total number of pages */ /* translators: %1$d: current page number, %2$d: total number of pages */
(0,s.__)("Page %1$d of %2$d","bcgov-design-system"),e,a)),(0,t.createElement)(n.Button,{onClick:()=>l(e+1),disabled:e===a},(0,s.__)("Next","bcgov-design-system"))),v=({failedOperations:e,onRetryAll:a})=>0===e.length?null:(0,t.createElement)(n.Notice,{status:"warning",isDismissible:!1,className:"retry-notice"},(0,t.createElement)("p",null,(0,s.sprintf)(/* translators: %d: number of failed operations */ /* translators: %d: number of failed operations */
(0,s.__)("There are %d failed operations that can be retried.","bcgov-design-system"),e.length)),(0,t.createElement)(n.Button,{variant:"secondary",onClick:a},(0,s.__)("Retry All","bcgov-design-system"))),b=window.wp.apiFetch;var _=e.n(b);const y=(e,t)=>{switch(t.type){case"SET_EDITING_DOCUMENT":return{...e,editingMetadata:t.payload,editedValues:t.initialValues||{},errors:{}};case"CLEAR_EDITING_DOCUMENT":return{...e,editingMetadata:null,editedValues:{},errors:{}};case"UPDATE_EDITED_VALUES":return{...e,editedValues:{...e.editedValues,...t.payload}};case"SET_ERRORS":return{...e,errors:t.payload};case"SET_IS_SAVING":return{...e,isSaving:t.payload};case"ENTER_SPREADSHEET_MODE":return{...e,isSpreadsheetMode:!0,bulkEditedMetadata:t.initialBulkValues||{},hasMetadataChanges:!1};case"EXIT_SPREADSHEET_MODE":return{...e,isSpreadsheetMode:!1,bulkEditedMetadata:{},hasMetadataChanges:!1};case"UPDATE_BULK_METADATA":return{...e,bulkEditedMetadata:{...e.bulkEditedMetadata,[t.documentId]:{...e.bulkEditedMetadata[t.documentId],[t.fieldId]:t.value}},hasMetadataChanges:t.hasChanges};case"SET_IS_SAVING_BULK":return{...e,isSavingBulk:t.payload};case"CLEAR_BULK_CHANGES":return{...e,bulkEditedMetadata:{},hasMetadataChanges:!1};default:return e}},f=({documents:e=[],currentPage:l=1,totalPages:r=1,onPageChange:d,onDelete:b,onTrash:f,onRestore:S,isDeleting:w=!1,selectedDocuments:C=[],onSelectDocument:N,onSelectAll:D,onFileDrop:k,onDocumentsUpdate:M,metadataFields:T=[],statusCounts:R={},documentStatusFilter:F="all",onStatusFilterChange:P})=>{const B=(0,a.useMemo)(()=>e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},[]),x=(0,a.useMemo)(()=>{const e=window.documentRepositorySettings;return e?.apiNamespace||"wp/v2"},[]),{showNotification:A}=(()=>{const[e,t]=(0,a.useState)(null);return{notice:e,showNotification:(0,a.useCallback)((e,a,n=3e3)=>{t({status:e,message:a}),n>0&&setTimeout(()=>t(null),n)},[]),clearNotification:(0,a.useCallback)(()=>{t(null)},[])}})(),{failedOperations:O,handleOperationError:I,retryAllOperations:z}=(({onShowNotification:e})=>{const[t,n]=(0,a.useState)([]),[l,o]=(0,a.useState)({}),r=(0,a.useCallback)((t,a,l,r={})=>{const{addToRetryQueue:c=!0,showNotice:i=!0,customMessage:d=null}=r;if(c&&(n(e=>[...e,{type:t,documentId:a,error:l}]),o(e=>({...e,[a]:(e[a]||0)+1}))),i&&e){const t=d||l.message||l.data?.message||(0,s.__)("An unknown error occurred.","bcgov-design-system");e("error",a?(0,s.sprintf)(/* translators: %1$d: document ID, %2$s: error message */ /* translators: %1$d: document ID, %2$s: error message */
(0,s.__)("Operation failed for document %1$d: %2$s","bcgov-design-system"),a,t):t)}},[e]),c=(0,a.useCallback)(async(t,a)=>{if(l[t.documentId]>=3)e("error",(0,s.sprintf)(/* translators: %1$d: document ID */ /* translators: %1$d: document ID */
(0,s.__)("Maximum retry attempts reached for document %1$d","bcgov-design-system"),t.documentId));else try{const e=a[t.type];if(!e)return{error:`Unknown operation type: ${t.type}`};await e(t.documentId),n(e=>e.filter(e=>!(e.type===t.type&&e.documentId===t.documentId)))}catch(e){r(t.type,t.documentId,e)}},[l,r,e]),i=(0,a.useCallback)(e=>{t.forEach(t=>c(t,e))},[t,c]);return{failedOperations:t,handleOperationError:r,retryOperation:c,retryAllOperations:i}})({onShowNotification:A}),{deleteDocument:U,restoreDocument:L,bulkDeleteConfirmOpen:$,bulkRestoreConfirmOpen:H,isMultiDeleting:V,isMultiRestoring:j,setDeleteDocument:q,setRestoreDocument:G,handleBulkDelete:K,handleBulkRestore:W,handleSingleDelete:X,handleSingleRestore:Q,openBulkDeleteConfirm:Z,closeBulkDeleteConfirm:J,openBulkRestoreConfirm:Y,closeBulkRestoreConfirm:ee}=(({onDelete:e,onTrash:t,onRestore:n,documentStatusFilter:l,onSelectAll:o,onShowNotification:r,onError:i})=>{const[d,m]=(0,a.useState)(null),[u,g]=(0,a.useState)(null),[p,h]=(0,a.useState)(!1),[E,v]=(0,a.useState)(!1),[b,_]=(0,a.useState)(!1),[y,f]=(0,a.useState)(!1),S=(0,a.useCallback)(async a=>{if(a&&0!==a.length){_(!0);try{await Promise.all(a.map(a=>c(l)?e(a):t(a))),h(!1),o(!1),r&&r("success",(0,s.__)(c(l)?"Selected documents were deleted successfully.":"Selected documents were trashed successfully.","bcgov-design-system"))}catch(e){i&&i("bulk-delete",null,e,{addToRetryQueue:!1,customMessage:(0,s.__)(c(l)?"Error deleting one or more documents.":"Error trashing one or more documents.","bcgov-design-system")})}finally{_(!1)}}},[e,t,l,o,r,i]),w=(0,a.useCallback)(async a=>{try{c(l)?await e(a):await t(a),m(null),r&&r("success",(0,s.__)(c(l)?"Document deleted successfully.":"Document trashed successfully.","bcgov-design-system"))}catch(e){i&&i("delete",a,e,{customMessage:(0,s.sprintf)(/* translators: %1$d: document ID, %2$s: error message */ /* translators: %1$d: document ID, %2$s: error message */
(0,s.__)(c(l)?"Error deleting document %1$d: %2$s":"Error trashing document %1$d: %2$s","bcgov-design-system"),a,e.message||(0,s.__)("An unknown error occurred","bcgov-design-system"))})}},[e,t,l,r,i]),C=(0,a.useCallback)(async e=>{if(e&&0!==e.length){f(!0);try{await Promise.all(e.map(n)),v(!1),o(!1),r&&r("success",(0,s.__)("Selected documents were restored successfully.","bcgov-design-system"))}catch(e){i&&i("bulk-restore",null,e,{addToRetryQueue:!1,customMessage:(0,s.__)("Error restoring one or more documents.","bcgov-design-system")})}finally{f(!1)}}},[n,o,r,i]),N=(0,a.useCallback)(async e=>{try{await n(e),g(null),r&&r("success",(0,s.__)("Document restored successfully.","bcgov-design-system"))}catch(t){i&&i("restore",e,t,{customMessage:(0,s.sprintf)(/* translators: %1$d: document ID, %2$s: error message */ /* translators: %1$d: document ID, %2$s: error message */
(0,s.__)("Error restoring document %1$d: %2$s","bcgov-design-system"),e,t.message||(0,s.__)("An unknown error occurred","bcgov-design-system"))})}},[n,r,i]),D=(0,a.useCallback)(()=>{h(!0)},[]),k=(0,a.useCallback)(()=>{h(!1)},[]),M=(0,a.useCallback)(()=>{v(!0)},[]),T=(0,a.useCallback)(()=>{v(!1)},[]);return{deleteDocument:d,restoreDocument:u,bulkDeleteConfirmOpen:p,bulkRestoreConfirmOpen:E,isMultiDeleting:b,isMultiRestoring:y,setDeleteDocument:m,setRestoreDocument:g,handleBulkDelete:S,handleBulkRestore:C,handleSingleDelete:w,handleSingleRestore:N,openBulkDeleteConfirm:D,closeBulkDeleteConfirm:k,openBulkRestoreConfirm:M,closeBulkRestoreConfirm:T}})({onDelete:b,onTrash:f,onRestore:S,documentStatusFilter:F,onSelectAll:D,onShowNotification:A,onError:I}),{editingMetadata:te,editedValues:ae,errors:ne,isSaving:se,hasMetadataChanged:le,handleEditMetadata:oe,updateEditedField:re,handleSaveMetadata:ce,isSpreadsheetMode:ie,hasMetadataChanges:de,bulkEditedMetadata:me,isSavingBulk:ue,handleMetadataChange:ge,toggleSpreadsheetMode:pe,handleSaveBulkChanges:he,localDocuments:Ee}=(({documents:e=[],metadataFields:t=[],apiNamespace:n,onUpdateDocuments:l,onError:o,onShowNotification:r})=>{const[c,i]=(0,a.useReducer)(y,{editingMetadata:null,editedValues:{},errors:{},isSaving:!1,isSpreadsheetMode:!1,bulkEditedMetadata:{},hasMetadataChanges:!1,isSavingBulk:!1}),[d,m]=(0,a.useState)(e);(0,a.useEffect)(()=>{m(e)},[e]);const u=(0,a.useCallback)(()=>{const{editingMetadata:e,editedValues:a}=c;return!!e&&t.some(t=>(e.metadata?.[t.id]||"")!==(a[t.id]||""))},[c,t]),g=(0,a.useCallback)(e=>{if(!e)return void i({type:"CLEAR_EDITING_DOCUMENT"});const a={...e,upload_date:e.date||e.upload_date||e.metadata?.upload_date},n={};t.forEach(t=>{var a;n[t.id]=null!==(a=e.metadata?.[t.id])&&void 0!==a?a:""}),i({type:"SET_EDITING_DOCUMENT",payload:a,initialValues:n})},[t]),p=(0,a.useCallback)((e,t,a)=>{const n={...c.bulkEditedMetadata,[e]:{...c.bulkEditedMetadata[e],[t]:a}},s=Object.entries(n).some(([e,t])=>{const a=d.find(t=>t.id===parseInt(e));return!!a&&Object.entries(t).some(([e,t])=>{const n=a.metadata?.[e]||"";return String(n)!==String(t)})});i({type:"UPDATE_BULK_METADATA",documentId:e,fieldId:t,value:a,hasChanges:s}),m(n=>n.map(n=>n.id===e?{...n,metadata:{...n.metadata,[t]:a}}:n))},[d,c.bulkEditedMetadata,i]),h=(0,a.useCallback)((e,t)=>{i({type:"UPDATE_EDITED_VALUES",payload:{[e]:t}})},[i]),E=(0,a.useCallback)(async()=>{const{editingMetadata:e,editedValues:t}=c;if(e){i({type:"SET_IS_SAVING",payload:!0});try{await _()({path:`/${n}/documents/${e.id}/metadata`,method:"POST",data:t}),m(a=>a.map(a=>a.id===e.id?{...a,metadata:{...a.metadata,...t}}:a)),"function"==typeof l&&l(d.map(a=>a.id===e.id?{...a,metadata:{...a.metadata,...t}}:a)),i({type:"CLEAR_EDITING_DOCUMENT"}),r&&r("success",(0,s.__)("Document metadata updated successfully","bcgov-design-system"))}catch(t){t.data?.errors&&i({type:"SET_ERRORS",payload:t.data.errors}),o&&o("metadata",e.id,t,{customMessage:t.data?.message||(0,s.__)("Failed to update metadata","bcgov-design-system")})}finally{i({type:"SET_IS_SAVING",payload:!1})}}},[c,n,d,l,r,o,i]),v=(0,a.useCallback)(e=>{if(e){const e={};d.forEach(t=>{e[t.id]={...t.metadata||{}}}),i({type:"ENTER_SPREADSHEET_MODE",initialBulkValues:e})}else i({type:"EXIT_SPREADSHEET_MODE"})},[d]),b=(0,a.useCallback)(async()=>{const{bulkEditedMetadata:e}=c;i({type:"SET_IS_SAVING_BULK",payload:!0});try{const t=await Promise.allSettled(Object.entries(e).map(([e,t])=>_()({path:`/${n}/documents/${e}/metadata`,method:"POST",data:t}))),a=Object.keys(e),c=t.map((e,t)=>({result:e,docId:a[t]})).filter(({result:e})=>"rejected"===e.status),m=t.map((e,t)=>({result:e,docId:a[t]})).filter(({result:e})=>"fulfilled"===e.status);if(c.length>0&&(c.forEach(({result:e,docId:t})=>{o&&o("metadata",t,e.reason,{showNotice:!1})}),r&&r("warning",(0,s.sprintf)(/* translators: %1$d: number of failed updates, %2$d: total number of updates */ /* translators: %1$d: number of failed updates, %2$d: total number of updates */
(0,s.__)("%1$d of %2$d metadata updates failed. You can retry the failed operations.","bcgov-design-system"),c.length,Object.keys(e).length),0)),m.length>0){const e=d.map(e=>{const t=m.find(({docId:t})=>t===e.id.toString());return t?t.result.value:e});"function"==typeof l&&l(e)}0===c.length&&(r&&r("success",(0,s.__)("All metadata changes saved successfully.","bcgov-design-system")),i({type:"CLEAR_BULK_CHANGES"}),i({type:"EXIT_SPREADSHEET_MODE"}))}catch(e){o&&o("bulk-metadata",null,e)}finally{i({type:"SET_IS_SAVING_BULK",payload:!1})}},[c,n,o,r]);return{editingMetadata:c.editingMetadata,editedValues:c.editedValues,errors:c.errors,isSaving:c.isSaving,hasMetadataChanged:u,handleEditMetadata:g,updateEditedField:h,handleSaveMetadata:E,isSpreadsheetMode:c.isSpreadsheetMode,hasMetadataChanges:c.hasMetadataChanges,bulkEditedMetadata:c.bulkEditedMetadata,isSavingBulk:c.isSavingBulk,handleMetadataChange:p,toggleSpreadsheetMode:v,handleSaveBulkChanges:b,localDocuments:d}})({documents:e,metadataFields:T,apiNamespace:x,onUpdateDocuments:M,onError:I,onShowNotification:A}),{uploadingFiles:ve,showUploadFeedback:be,handleFiles:_e,closeUploadFeedback:ye}=(({onFileDrop:e,onShowNotification:t,onError:n})=>{const[l,o]=(0,a.useState)([]),[r,c]=(0,a.useState)(!1);return{uploadingFiles:l,showUploadFeedback:r,handleFiles:(0,a.useCallback)(a=>{if(c(!0),!a||0===a.length)return t&&t("error",(0,s.__)("No files were selected for upload.","bcgov-design-system")),void c(!1);o([{id:"placeholder",name:(0,s.sprintf)(/* translators: %d: number of files being prepared */ /* translators: %d: number of files being prepared */
(0,s.__)("Preparing %d files…","bcgov-design-system"),a.length),status:"processing",error:null,isPlaceholder:!0}]);const l=a.map(e=>({id:Math.random().toString(36).substr(2,9),name:e.name,originalFile:e,status:"processing",error:null}));o(l);const r=[],i=[];a.forEach(e=>{"application/pdf"===e.type||e.name.toLowerCase().endsWith(".pdf")?r.push(e):i.push(e)}),o(e=>e.map(e=>{const t=a.find(t=>t.name===e.name),n=t&&("application/pdf"===t.type||t.name.toLowerCase().endsWith(".pdf"));return{...e,status:n?"uploading":"error",error:n?null:(0,s.__)("Not a PDF file. Only PDF files are allowed.","bcgov-design-system")}})),i.length>0&&t&&t("warning",(0,s.sprintf)(/* translators: %1$d: number of skipped files, %2$d: total number of files */ /* translators: %1$d: number of skipped files, %2$d: total number of files */
(0,s.__)("%1$d of %2$d files were skipped because they are not PDFs.","bcgov-design-system"),i.length,a.length)),0!==r.length&&r.forEach(t=>{e(t).then(()=>{o(e=>e.map(e=>e.name===t.name?{...e,status:"success"}:e))}).catch(e=>{o(a=>a.map(a=>a.name===t.name?{...a,status:"error",error:e.message||(0,s.__)("Upload failed. Please try again.","bcgov-design-system")}:a)),n&&n("upload",t.name,e,{addToRetryQueue:!1,customMessage:(0,s.sprintf)(/* translators: %1$s: file name, %2$s: error message */ /* translators: %1$s: file name, %2$s: error message */
(0,s.__)('Error uploading "%1$s": %2$s',"bcgov-design-system"),t.name,e.message||(0,s.__)("Upload failed","bcgov-design-system"))})})})},[e,t,n]),closeUploadFeedback:(0,a.useCallback)(()=>{c(!1),o([])},[])}})({onFileDrop:k,onShowNotification:A,onError:I}),fe=(0,a.useCallback)(()=>{z({delete:b,metadata:ce})},[b,ce,z]),Se=(0,a.useMemo)(()=>({documents:Ee,selectedDocuments:C,onSelectDocument:N,onSelectAll:D,onDelete:q,onEdit:oe,onRestore:G,isDeleting:w,metadataFields:T,isSpreadsheetMode:ie,bulkEditedMetadata:me,onMetadataChange:ge,formatFileSize:B,documentStatusFilter:F}),[Ee,C,N,D,w,T,ie,me,oe,ge,B,q,G]),{totalDocumentCount:we,trashedCount:Ce}=(0,a.useMemo)(()=>({totalDocumentCount:Object.entries(R).reduce((e,[t,a])=>"trash"!==t?e+Number(a||0):e,0),trashedCount:Number(R.trash||0)}),[R]);return(0,t.createElement)(o,null,(0,t.createElement)("div",{className:"document-list"},(0,t.createElement)(v,{failedOperations:O,onRetryAll:fe}),(0,t.createElement)("div",{className:"document-list__actions"},(0,t.createElement)("div",{className:"document-list__left-actions"}),(0,t.createElement)("div",{className:"document-list__right-actions"},(0,t.createElement)(h,{onFilesSelected:e=>{_e(e)}}))),(0,t.createElement)("ul",{className:"subsubsub document-status-filters"},(0,t.createElement)("li",{className:"all"},(0,t.createElement)("a",{href:"#",className:i(F)?"current":"",onClick:e=>{e.preventDefault(),P&&P("all")}},(0,s.__)("All","bcgov-design-system")," ",(0,t.createElement)("span",{className:"count"},"( ",we," )"))),(0,t.createElement)("li",{className:"trash"}," | ",(0,t.createElement)("a",{href:"#",className:c(F)?"current":"",onClick:e=>{e.preventDefault(),P&&P("trash")}},(0,s.__)("Trash","bcgov-design-system ")," ",(0,t.createElement)("span",{className:"count"},"( ",Ce," )")))),(0,t.createElement)("div",{className:"document-list__table-actions"},(0,t.createElement)("div",{className:"action-buttons-container"},(0,t.createElement)(n.Button,{className:"doc-repo-button spreadsheet-toggle"+(ie?" isPressed":""),onClick:()=>pe(!ie),isPressed:ie},ie?(0,s.__)("Exit Spreadsheet Mode","bcgov-design-system"):(0,s.__)("Enter Spreadsheet Mode","bcgov-design-system")),ie&&de&&(0,t.createElement)(n.Button,{className:"doc-repo-button save-button",onClick:he,isBusy:ue,disabled:ue},ue?(0,s.__)("Saving…","bcgov-design-system"):(0,s.__)("Save Changes","bcgov-design-system")),c(F)&&C.length>0&&(0,t.createElement)(n.Button,{className:"doc-repo-button save-button bulk-restore-button",onClick:Y,disabled:j},(0,s.sprintf)(/* translators: %d: number of selected documents */ /* translators: %d: number of selected documents */
(0,s.__)("Restore Selected (%d)","bcgov-design-system"),C.length)),C.length>0&&(0,t.createElement)(n.Button,{className:"doc-repo-button delete-button bulk-delete-button",onClick:Z,disabled:V},(0,s.sprintf)(/* translators: %d: number of selected documents */ /* translators: %d: number of selected documents */
(0,s.__)(c(F)?"Delete Selected Permanently (%d)":"Trash Selected (%d)","bcgov-design-system"),C.length)))),e.length>=50?(0,t.createElement)(u,{...Se}):(0,t.createElement)(m,{...Se}),(0,t.createElement)(E,{currentPage:l,totalPages:r,onPageChange:d}),be&&(0,t.createElement)(g,{uploadingFiles:ve,showUploadFeedback:be,onClose:ye}),U&&(0,t.createElement)(p,{title:c(F)?(0,s.__)("Delete Document Permanently","bcgov-design-system"):(0,s.__)("Trash Document","bcgov-design-system"),isOpen:!!U,onClose:()=>q(null),onSave:()=>X(U.id),isSaving:w,isDisabled:!1,saveButtonText:w?(0,s.__)(c(F)?"Deleting…":"Trashing…","bcgov-design-system"):(0,s.__)(c(F)?"Delete Permanently":"Trash","bcgov-design-system"),saveButtonClassName:"doc-repo-button delete-button"},(0,t.createElement)("div",{className:"delete-confirmation-content"},(0,t.createElement)("div",{className:"delete-warning"},(0,s.__)(c(F)?"Are you sure you want to delete this document? This action cannot be undone.":"Are you sure you want to trash this document?","bcgov-design-system")),(0,t.createElement)("div",{className:"documents-to-delete"},(0,t.createElement)("h4",null,(0,s.__)(c(F)?"Document to be deleted:":"Document to be trashed:","bcgov-design-system")),(0,t.createElement)("ul",null,(0,t.createElement)("li",null,U.title))))),L&&(0,t.createElement)(p,{title:(0,s.__)("Restore Document","bcgov-design-system"),isOpen:!!L,onClose:()=>G(null),onSave:()=>Q(L.id),isSaving:w,isDisabled:!1,saveButtonText:(0,s.__)("Restore","bcgov-design-system"),saveButtonClassName:"doc-repo-button save-button"},(0,t.createElement)("div",{className:"restore-confirmation-content"},(0,t.createElement)("div",{className:"restore-warning"},(0,s.__)("Are you sure you want to restore this document?","bcgov-design-system")),(0,t.createElement)("div",{className:"documents-to-restore"},(0,t.createElement)("h4",null,(0,s.__)("Document to be restored:","bcgov-design-system")),(0,t.createElement)("ul",null,(0,t.createElement)("li",null,L.title))))),$&&(0,t.createElement)(p,{title:c(F)?(0,s.__)("Delete Selected Documents Permanently","bcgov-design-system"):(0,s.__)("Trash Selected Documents","bcgov-design-system"),isOpen:$,onClose:J,onSave:()=>K(C),isSaving:V,isDisabled:!1,saveButtonText:V?(0,s.__)(c(F)?"Deleting…":"Trashing…","bcgov-design-system"):(0,s.__)(c(F)?"Delete Selected Permanently":"Trash Selected","bcgov-design-system"),saveButtonClassName:"doc-repo-button delete-button"},(0,t.createElement)("div",{className:"delete-confirmation-content"},(0,t.createElement)("div",{className:"delete-warning"},(0,s.__)(c(F)?"Are you sure you want to delete the selected documents? This action cannot be undone.":"Are you sure you want to trash the selected documents?","bcgov-design-system")),(0,t.createElement)("div",{className:"documents-to-delete"},(0,t.createElement)("h4",null,(0,s.sprintf)(c(F)?(0,s.__)("Documents to be deleted (%d):","bcgov-design-system"):(0,s.__)("Documents to be trashed (%d):","bcgov-design-system"),C.length)),(0,t.createElement)("ul",null,Ee.filter(e=>C.includes(e.id)).map(e=>(0,t.createElement)("li",{key:e.id},e.title)))))),H&&(0,t.createElement)(p,{title:(0,s.__)("Restore Selected Documents","bcgov-design-system"),isOpen:H,onClose:ee,onSave:()=>W(C),isSaving:j,isDisabled:!1,saveButtonText:j?(0,s.__)("Restoring…","bcgov-design-system"):(0,s.__)("Restore Selected","bcgov-design-system"),saveButtonClassName:"doc-repo-button save-button"},(0,t.createElement)("div",{className:"restore-confirmation-content"},(0,t.createElement)("div",{className:"restore-warning"},(0,s.__)("Are you sure you want to restore the selected documents?","bcgov-design-system")),(0,t.createElement)("div",{className:"documents-to-restore"},(0,t.createElement)("h4",null,(0,s.sprintf)((0,s.__)("Documents to be restored (%d):","bcgov-design-system"),C.length)),(0,t.createElement)("ul",null,Ee.filter(e=>C.includes(e.id)).map(e=>(0,t.createElement)("li",{key:e.id},e.title)))))),te&&(0,t.createElement)(p,{title:(0,s.__)("Edit Document Metadata","bcgov-design-system"),isOpen:!!te,onClose:()=>oe(null),onSave:ce,isSaving:se,isDisabled:!le,saveButtonText:se?(0,s.__)("Saving…","bcgov-design-system"):(0,s.__)("Save Changes","bcgov-design-system"),saveButtonClassName:"doc-repo-button save-button"},(0,t.createElement)("div",{className:"editable-metadata"},T.map(e=>(0,t.createElement)("div",{key:e.id,className:"metadata-field"},(0,t.createElement)("label",{htmlFor:e.id},e.label),"taxonomy"===e.type?(0,t.createElement)(n.SelectControl,{id:e.id,value:ae[e.id]||"",options:[{label:(0,s.__)("Select…","bcgov-design-system"),value:""},...(e.options||[]).map(e=>"string"==typeof e?{label:e,value:e}:{label:e.label||e.name,value:e.value||e.id})],onChange:t=>re(e.id,t)}):(0,t.createElement)(n.TextControl,{id:e.id,type:"date"===e.type?"date":"text",value:ae[e.id]||"",onChange:t=>re(e.id,t)}),ne[e.id]&&(0,t.createElement)("div",{className:"metadata-error"},ne[e.id])))),(0,t.createElement)("div",{className:"non-editable-metadata"},(0,t.createElement)("h3",null,(0,s.__)("Document Information","bcgov-design-system")),(0,t.createElement)("div",{className:"metadata-field"},(0,t.createElement)("label",{htmlFor:"document-filename"},(0,s.__)("Filename","bcgov-design-system")),(0,t.createElement)("div",{id:"document-filename",className:"field-value"},(te.metadata?.document_file_name||te.filename||te.title||"").replace(/\.pdf$/i,"")||(0,s.__)("Not available","bcgov-design-system"))),(0,t.createElement)("div",{className:"metadata-field"},(0,t.createElement)("label",{htmlFor:"document-file-type"},(0,s.__)("File Type","bcgov-design-system")),(0,t.createElement)("div",{id:"document-file-type",className:"field-value"},te.metadata?.document_file_type||"PDF")),(0,t.createElement)("div",{className:"metadata-field"},(0,t.createElement)("label",{htmlFor:"document-file-size"},(0,s.__)("File Size","bcgov-design-system")),(0,t.createElement)("div",{id:"document-file-size",className:"field-value"},te.metadata?.document_file_size?B(parseInt(te.metadata.document_file_size)):(0,s.__)("Not available","bcgov-design-system")))))))},S=({metadataFields:e,onUploadSuccess:l,selectedFile:o=null,modalMode:r=!1})=>{const[c,i]=(0,a.useState)(o),[d,m]=(0,a.useState)(!1),[u,g]=(0,a.useState)(0),[p,h]=(0,a.useState)(null),[E,v]=(0,a.useState)(!1),[b,_]=(0,a.useState)(!1),y=(0,a.useRef)(null),f=(0,a.useRef)(null),[S,w]=(0,a.useState)(o?o.name.split(".")[0]:""),[C,N]=(0,a.useState)({}),{apiNamespace:D,maxFileSize:k,allowedMimeTypes:M}=window.documentRepositorySettings,T=(0,a.useCallback)(e=>{if(!e)return!1;if(e.size>k){const t=`File "${e.name}" is too large (${(e.size/1048576).toFixed(2)} MB). Maximum allowed size is ${(k/1048576).toFixed(2)} MB.`;return h(t),!1}const t=e.name.split(".").pop().toLowerCase(),a=Object.keys(M);if(!a.includes(t)){const t=`File "${e.name}" has an invalid file type. Allowed types are: ${a.join(", ")}`;return h(t),!1}return h(null),!0},[k,M]),R=(0,a.useCallback)(e=>{if(!e)return!1;if(T(e)){i(e);const t=e.name.includes(".")?e.name.substring(0,e.name.lastIndexOf(".")):e.name;return w(t),!0}return!1},[T]);(0,a.useEffect)(()=>{if(o&&(w(o.name.replace(/\.[^/.]+$/,"")),!T(o)))return{error:"Initial file validation failed, but still setting file for UI"}},[o,T]),(0,a.useEffect)(()=>{r&&!c&&o&&i(o)},[r,o,c]);const F=e=>{const t=e.target.files[0];R(t)},P=()=>{y.current&&y.current.click()},B=(e,t)=>{N(a=>({...a,[e]:t}))},x=async()=>{if(!c)return void h("Please select a file to upload.");if(!T(c))return;m(!0),h(null),g(0);const e=new FormData;e.append("file",c),e.append("title",S),e.append("_wpnonce",window.documentRepositorySettings.nonce);const t={...C,document_repository:!0},a=JSON.stringify(t);e.append("metadata",a);try{const t=await fetch(`${window.documentRepositorySettings.apiRoot}${D}/documents`,{method:"POST",headers:{"X-WP-Nonce":window.documentRepositorySettings.nonce},body:e});if(!t.ok){const e=await t.json();throw new Error(e.message||"Upload failed")}const a=await t.json();v(!0),m(!1),l&&l(a.document),r||(i(null),w(""),N({}))}catch(e){h(e.message||"Failed to upload file. Please try again."),m(!1)}},A=e=>{const{id:a,label:l,type:o,options:r,required:c}=e;switch(o){case"text":return(0,t.createElement)(n.TextControl,{key:a,label:l,value:C[a]||"",onChange:e=>B(a,e),required:c});case"date":return(0,t.createElement)(n.TextControl,{key:a,label:l,type:"date",value:C[a]||"",onChange:e=>B(a,e),required:c});case"taxonomy":return(0,t.createElement)(n.SelectControl,{key:a,label:l,value:C[a]||"",options:[{label:(0,s.__)("Select…","bcgov-design-system"),value:""},...(r||[]).map(e=>"string"==typeof e?{label:e,value:e}:{label:e.label||e.name,value:e.value||e.id})],onChange:e=>B(a,e),required:c});default:return null}},O=()=>d?(0,t.createElement)(t.Fragment,null,(0,t.createElement)(n.Spinner,null),(0,s.__)("Uploading…","bcgov-design-system")):(0,s.__)("Upload Document","bcgov-design-system");return r?(0,t.createElement)("div",{className:"document-uploader-modal"},p&&(0,t.createElement)(n.Notice,{status:"error",isDismissible:!0,onRemove:()=>h(null)},p),E&&(0,t.createElement)(n.Notice,{status:"success",isDismissible:!0,onRemove:()=>v(!1)},(0,s.__)("Document uploaded successfully!","bcgov-design-system")),(0,t.createElement)("div",{className:"selected-file-info"},c?(0,t.createElement)("p",null,(0,t.createElement)("strong",null,"File:")," ",c.name," (",Math.round(c.size/1024)," KB)"):o?(0,t.createElement)("p",null,(0,t.createElement)("strong",null,"File:")," ",o.name," (",Math.round(o.size/1024)," KB)"):(0,t.createElement)("p",null,(0,t.createElement)("strong",null,"Warning:")," No file selected")),(0,t.createElement)(n.TextControl,{label:(0,s.__)("Document Title","bcgov-design-system"),value:S,onChange:w,disabled:d,required:!0}),(0,t.createElement)("h4",null,(0,s.__)("Document Metadata","bcgov-design-system")),(0,t.createElement)("div",{className:"metadata-fields modal-layout"},e.map(A)),d&&(0,t.createElement)("div",{className:"upload-progress"},(0,t.createElement)("progress",{value:u,max:"100"}),(0,t.createElement)("p",null,u,"%"," ",(0,s.__)("Uploaded","bcgov-design-system"))),(0,t.createElement)("div",{className:"modal-actions"},(0,t.createElement)(n.Button,{isPrimary:!0,onClick:x,disabled:!c&&!o||!S||d},O()))):(0,t.createElement)(n.Card,{className:"document-uploader"},(0,t.createElement)(n.CardHeader,null,(0,t.createElement)("h3",null,(0,s.__)("Upload Document","bcgov-design-system"))),(0,t.createElement)(n.CardBody,null,(0,t.createElement)(t.Fragment,null,E&&(0,t.createElement)(n.Notice,{status:"success",isDismissible:!0,onRemove:()=>v(!1)},(0,s.__)("Document uploaded successfully!","bcgov-design-system")),p&&(0,t.createElement)(n.Notice,{status:"error",isDismissible:!0,onRemove:()=>h(null)},p),!r&&!c&&(0,t.createElement)("div",{className:"upload-area__container "+(b?"upload-area__container--drag-active":""),onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),_(!0)},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),_(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation();const t=f.current.getBoundingClientRect();(e.clientX<t.left||e.clientX>=t.right||e.clientY<t.top||e.clientY>=t.bottom)&&_(!1)},onDrop:e=>{e.preventDefault(),e.stopPropagation(),_(!1);const t=Array.from(e.dataTransfer.files);var a;t.length>0&&(a=t[0],R(a))},onClick:P,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||P()},role:"button",tabIndex:"0",ref:f},(0,t.createElement)("input",{type:"file",ref:y,onChange:F,className:"upload-area__file-input",accept:Object.values(M).join(",")}),(0,t.createElement)("div",{className:"upload-area__content"},(0,t.createElement)("div",{className:"upload-area__icon"},(0,t.createElement)("svg",{viewBox:"0 0 64 64",width:"64",height:"64"},(0,t.createElement)("path",{d:"M32 16v24M20 28l12-12 12 12",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.createElement)("path",{d:"M16 48h32M12 20v28c0 2.2 1.8 4 4 4h32c2.2 0 4-1.8 4-4V20",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}))),(0,t.createElement)("div",{className:"upload-area__text"},(0,t.createElement)("p",{className:"upload-area__text-primary"},b?(0,s.__)("Drop file here","bcgov-design-system"):(0,s.__)("Drag & drop your file here or click to browse","bcgov-design-system")),(0,t.createElement)("p",{className:"upload-area__help-text"},(0,s.__)("Accepted file types:","bcgov-design-system")," ",Object.keys(M).join(", ")),(0,t.createElement)("p",{className:"upload-area__help-text"},(0,s.__)("Maximum file size:","bcgov-design-system")," ",Math.round(k/1048576)," ","MB")))),r&&!c&&(0,t.createElement)("div",{className:"document-uploader-file-select"},(0,t.createElement)(n.FormFileUpload,{accept:Object.values(M).join(","),onChange:F},(0,s.__)("Select a different file","bcgov-design-system"))),c&&(0,t.createElement)("div",{className:"selected-file-container"},(0,t.createElement)("div",{className:"selected-file"},(0,t.createElement)("span",{className:"file-name"},c.name),(0,t.createElement)("button",{type:"button",className:"remove-file",onClick:()=>i(null)},"✕")),!r&&(0,t.createElement)(n.FormFileUpload,{accept:Object.values(M).join(","),onChange:F},(0,s.__)("Select a different file","bcgov-design-system"))),d&&(0,t.createElement)("div",{className:"upload-progress"},(0,t.createElement)("progress",{value:u,max:"100"}),(0,t.createElement)("p",null,u,"%"," ",(0,s.__)("Uploaded","bcgov-design-system"))),(0,t.createElement)(n.TextControl,{label:(0,s.__)("Document Title","bcgov-design-system"),value:S,onChange:w,disabled:d,required:!0}),(0,t.createElement)("h4",null,(0,s.__)("Document Metadata","bcgov-design-system")),(0,t.createElement)("div",{className:"metadata-fields "+(r?"modal-layout":"")},e.map(A)))),(0,t.createElement)(n.CardFooter,null,(0,t.createElement)("div",{className:"card-actions"},(0,t.createElement)(n.Button,{isPrimary:!0,onClick:x,disabled:!c||!S||d},O()))))};class w extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({errorInfo:t})}render(){return this.state.hasError?(0,t.createElement)("div",{className:"wordpress-document-repository-error"},(0,t.createElement)(n.Notice,{status:"error",isDismissible:!1},(0,t.createElement)("h2",null,(0,s.__)("Something went wrong in the Document Repository","bcgov-design-system")),(0,t.createElement)("p",null,this.state.error&&this.state.error.toString()),(0,t.createElement)("details",{style:{whiteSpace:"pre-wrap"}},this.state.errorInfo&&this.state.errorInfo.componentStack))):this.props.children}}const C=w,N=()=>{const[e,l]=(0,a.useState)(!0),[o,r]=(0,a.useState)(null),[c,d]=(0,a.useState)("Initializing"),[m,u]=(0,a.useState)([]),[g,p]=(0,a.useState)(!1),[h,E]=(0,a.useState)(!1),[v,b]=(0,a.useState)(null),[y,w]=(0,a.useState)("all"),[N,D]=(0,a.useState)([]),{documents:k,totalDocuments:M,currentPage:T,totalPages:R,statusCounts:F,fetchDocuments:P,deleteDocument:B,trashDocument:x,restoreDocument:A,isDeleting:O,isLoading:I,error:z,setSearchParams:U}=(()=>{const[e,t]=(0,a.useState)([]),[n,s]=(0,a.useState)(0),[l,o]=(0,a.useState)(1),[r,c]=(0,a.useState)(1),[i,d]=(0,a.useState)({}),[m,u]=(0,a.useState)(!1),[g,p]=(0,a.useState)(!1),[h,E]=(0,a.useState)(null),[v,b]=(0,a.useState)({page:1,per_page:window.documentRepositorySettings?.perPage||20,orderby:"date",order:"DESC",status:"all"}),y=(0,a.useCallback)(async()=>{if(window.documentRepositorySettings?.apiNamespace){u(!0),E(null);try{const{apiNamespace:e}=window.documentRepositorySettings,a=new URLSearchParams;Object.entries(v).forEach(([e,t])=>{t&&a.append(e,t)});const n=new Promise((e,t)=>{setTimeout(()=>{t(new Error("Document fetch request timed out. Please try again."))},5e3)}),l=await Promise.race([_()({path:`/${e}/documents?${a.toString()}`}),n]);if(!l||"object"!=typeof l)throw new Error("Invalid response from server");const r=Array.isArray(l.documents)?l.documents.filter(e=>e&&"object"==typeof e&&e.id):[];t(r),s(l.total||0),o(l.current_page||1),c(l.total_pages||1),d(l.status_counts||{}),0===r.length&&v.page>1&&b(e=>({...e,page:1}))}catch(e){E(e.message||"Error loading documents"),1===v.page&&(t([]),s(0),c(1))}finally{u(!1)}}else E("Document Repository settings not found. Make sure the script is properly enqueued in WordPress.")},[v]);(0,a.useEffect)(()=>{const e=parseInt(v.page,10);isNaN(e)||e===l||o(e)},[v.page,l]),(0,a.useEffect)(()=>{y()},[y]);const f=async e=>{p(!0);try{const{apiNamespace:t}=window.documentRepositorySettings;return await _()({path:`/${t}/documents/${e}?force=true`,method:"DELETE"}),await y(),p(!1),!0}catch(e){return E(e.message||"Error deleting document"),p(!1),!1}},S=async(e,t)=>{try{const{apiNamespace:a}=window.documentRepositorySettings,n=await _()({path:`/${a}/documents/${e}`,method:"PUT",data:t});return await y(),n}catch(e){return E(e.message||"Error updating document"),null}};return{documents:e,totalDocuments:n,currentPage:l,totalPages:r,statusCounts:i,isLoading:m,isDeleting:g,error:h,searchParams:v,setSearchParams:b,fetchDocuments:y,deleteDocument:f,trashDocument:async e=>{p(!0);try{const{apiNamespace:t}=window.documentRepositorySettings;return await _()({path:`/${t}/documents/${e}?force=false`,method:"DELETE"}),await y(),p(!1),!0}catch(e){return E(e.message||"Error trashing document"),p(!1),!1}},restoreDocument:async e=>{p(!0);try{const{apiNamespace:t}=window.documentRepositorySettings;return await _()({path:`/${t}/documents/${e}/restore`,method:"POST"}),await y(),p(!1),!0}catch(e){return E(e.message||"Error restoring document"),p(!1),!1}},updateDocument:S,bulkUpdateDocuments:async(e,t)=>{try{for(const a of e)await S(a,t);return await y(),!0}catch(e){return E(e.message||"Error performing bulk update"),!1}},bulkDeleteDocuments:async e=>{try{for(const t of e)await f(t);return!0}catch(e){return E(e.message||"Error performing bulk delete"),!1}}}})();(0,a.useEffect)(()=>{(async()=>{try{l(!0),r(null),d("Initializing");const e=new Promise((e,t)=>{setTimeout(()=>{t(new Error((0,s.__)("Loading document repository timed out. Please refresh the page.","bcgov-design-system")))},1e4)}),t=window.documentRepositorySettings;if(!t?.apiRoot||!t?.apiNamespace||!t?.nonce)throw new Error((0,s.__)("Document Repository settings not found. Make sure the script is properly enqueued in WordPress.","bcgov-design-system"));await Promise.race([(async()=>{d("Fetching metadata fields");const e=await fetch(`${t.apiRoot}${t.apiNamespace}/metadata-fields`,{headers:{"X-WP-Nonce":t.nonce}});if(!e.ok){let t;try{const a=await e.json();t=a.message||a.error}catch(a){t=e.statusText}throw new Error((0,s.__)("Failed to fetch metadata fields: ","bcgov-design-system")+t)}const a=await e.json();u(a),d("Loading documents"),await P()})(),e])}catch(e){r(e.message||(0,s.__)("Failed to initialize document repository","bcgov-design-system"))}finally{l(!1)}})()},[P]),(0,a.useEffect)(()=>{U(e=>({...e,status:i(y)?void 0:y,page:1})),D([])},[y]);const[L,$]=(0,a.useState)([]),[H,V]=(0,a.useState)(0),[j,q]=(0,a.useState)(0),G=(0,a.useMemo)(()=>{let e;return(...t)=>{clearTimeout(e),e=setTimeout(()=>P(...t),1e3)}},[P]),K=()=>{G(),p(!1),b(null),$([]),V(0)},W=async e=>{try{if(!e.type.includes("pdf")&&!e.name.toLowerCase().endsWith(".pdf"))throw new Error("Only PDF files are allowed");const t=new FormData;t.append("file",e),t.append("title",e.name.split(".")[0]);const a=window.documentRepositorySettings?.nonce;if(!a)throw new Error("Security token not found");const n=new window.XMLHttpRequest,s=new Promise((s,l)=>{n.open("POST",`${window.documentRepositorySettings.apiRoot}${window.documentRepositorySettings.apiNamespace}/documents`),n.setRequestHeader("X-WP-Nonce",a),n.upload.onprogress=e=>{if(e.lengthComputable){const t=Math.round(e.loaded/e.total*100);q(t)}},n.onload=()=>{if(n.status>=200&&n.status<300)try{const e=JSON.parse(n.responseText);s(e)}catch(t){l(new Error(`Error uploading "${e.name}": Server returned invalid response`))}else{let t;try{const e=JSON.parse(n.responseText);t=e.message||e.error||n.statusText}catch(e){t=n.statusText||"Server error"}l(new Error(`Error uploading "${e.name}": ${t}`))}},n.onerror=()=>{l(new Error(`Network error while uploading "${e.name}". Please check your connection and try again.`))},n.send(t)});await s,K()}catch(e){throw r(e.message||"Failed to upload file"),e}},X=o||z;return(0,a.useEffect)(()=>{if(X){const e=setTimeout(()=>{r(null)},3e3);return()=>clearTimeout(e)}},[X]),e?(0,t.createElement)("div",{className:"wordpress-document-repository-loading"},(0,t.createElement)(n.Spinner,null),(0,t.createElement)("p",null,c,"..."),(0,t.createElement)("p",{className:"loading-description"},(0,s.__)("Loading document repository…","bcgov-design-system"))):(0,t.createElement)(C,null,(0,t.createElement)("div",{className:"wordpress-document-repository"},X&&(0,t.createElement)(n.Notice,{status:"error",isDismissible:!0,onDismiss:()=>r(null),className:"document-repository-error"},(0,t.createElement)("p",null,X)),(0,t.createElement)(f,{documents:k||[],isLoading:I,totalItems:M,currentPage:T||1,totalPages:R||1,onPageChange:async e=>{try{r(null),U(t=>({...t,page:e}))}catch(e){r(e.message||(0,s.__)("Failed to change page","bcgov-design-system")),U(e=>({...e,page:T}))}},onDelete:B,onTrash:x,onRestore:A,isDeleting:O,selectedDocuments:N||[],onSelectDocument:e=>{try{const t=N.includes(e)?N.filter(t=>t!==e):[...N,e];D(t)}catch(e){r((0,s.__)("Failed to select document","bcgov-design-system"))}},onSelectAll:e=>{try{D(e?k.map(e=>e.id):[])}catch(e){r((0,s.__)("Failed to select documents","bcgov-design-system"))}},metadataFields:m||[],onUploadSuccess:K,onFileDrop:W,statusCounts:F,documentStatusFilter:y,onStatusFilterChange:w}),g&&v&&(0,t.createElement)(n.Modal,{title:L.length>1?(0,s.__)("Upload Documents","bcgov-design-system"):(0,s.__)("Upload Document","bcgov-design-system"),onRequestClose:()=>E(!0),className:"document-upload-modal"},(0,t.createElement)("div",{className:"upload-progress-info"},L.length>1&&(0,t.createElement)("p",{className:"upload-queue-status"},(0,s.__)("Uploading file","bcgov-design-system")," ",H+1," ",(0,s.__)("of","bcgov-design-system")," ",L.length),(0,t.createElement)("div",{className:"progress-bar"},(0,t.createElement)("div",{className:"progress-bar-fill",style:{width:`${j}%`}}))),(0,t.createElement)(S,{metadataFields:m,onUploadSuccess:K,selectedFile:v,modalMode:!0,onFileDrop:W})),h&&(0,t.createElement)(n.Modal,{title:(0,s.__)("Cancel Upload","bcgov-design-system"),onRequestClose:()=>E(!1),className:"cancel-upload-modal"},(0,t.createElement)("p",null,(0,s.__)("Are you sure you want to cancel the remaining uploads?","bcgov-design-system")),(0,t.createElement)("div",{className:"modal-actions"},(0,t.createElement)(n.Button,{className:"doc-repo-button",onClick:()=>E(!1)},(0,s.__)("Continue Upload","bcgov-design-system")),(0,t.createElement)(n.Button,{className:"doc-repo-button",isDestructive:!0,onClick:()=>{p(!1),b(null),$([]),V(0),E(!1)}},(0,s.__)("Cancel Upload","bcgov-design-system"))))))};document.addEventListener("DOMContentLoaded",()=>{try{const e=document.getElementById("wordpress-document-repository-app");if(e)(0,a.createRoot)(e).render((0,t.createElement)(N,null));else{const e=document.createElement("div");e.style.color="red",e.style.padding="20px",e.style.border="1px solid red",e.innerHTML="<strong>Error:</strong> Document Repository container not found. Check console for details.",document.body.prepend(e)}}catch(e){const t=document.createElement("div");t.style.color="red",t.style.padding="20px",t.style.border="1px solid red",t.innerHTML=`<strong>Error:</strong> Failed to initialize Document Repository app: ${e.message}`,document.body.prepend(t)}})})();
=======
(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var s in a)e.o(a,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:a[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,a=window.wp.element,s=window.wp.components,n=window.wp.i18n;class o extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}renderError(){return(0,t.createElement)("div",{className:"error-boundary"},(0,t.createElement)("h2",null,(0,n.__)("Something went wrong.","bcgov-design-system")),(0,t.createElement)("p",null,(0,n.__)("Please try refreshing the page.","bcgov-design-system")),!1)}renderContent(){return this.props.children}render(){return this.state.hasError?this.renderError():this.renderContent()}}const l=o;class r extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}renderError(){return(0,t.createElement)("div",{className:"document-table-row error",role:"row"},(0,t.createElement)("div",{className:"document-table-cell",role:"cell",style:{textAlign:"center"}},(0,n.__)("Error rendering document row.","bcgov-design-system"),!1))}renderContent(){return this.props.children}render(){return this.state.hasError?this.renderError():this.renderContent()}}function c(e){return"trash"===e}function i(e){return"all"===e}function d({document:e,isSelected:a,onSelect:o,onDelete:l,onEdit:r,onRestore:i,isDeleting:d,metadataFields:m,isSpreadsheetMode:u,bulkEditedMetadata:g,onMetadataChange:p,formatFileSize:h,documentStatusFilter:E}){return(0,t.createElement)("div",{className:"document-table-row",role:"row"},(0,t.createElement)("div",{className:"document-table-cell",role:"cell","aria-label":(0,n.__)("Select document","bcgov-design-system")},(0,t.createElement)(s.CheckboxControl,{checked:a,onChange:()=>o(e.id)})),(0,t.createElement)("div",{className:"document-table-cell",role:"cell"},e.title||e.filename),m.map(a=>(0,t.createElement)("div",{key:a.id,className:"document-table-cell metadata-column",role:"cell","aria-label":(0,n.sprintf)(/* translators: %s: field label */ /* translators: %s: field label */
(0,n.__)("Edit %s","bcgov-design-system"),a.label)},(a=>{if(!u){const t=e.metadata&&e.metadata[a.id]?e.metadata[a.id]:"";if("taxonomy"===a.type&&t){const e=Array.isArray(t)?t:[t];return 1===e.length?e[0]:e.join(", ")}return t||"—"}const o=g[e.id]?.[a.id]||"";if("taxonomy"===a.type){const l=(a.options||[]).map(e=>"string"==typeof e?{label:e,value:e}:{label:e.label||e.name,value:e.label||e.name});return(0,t.createElement)(s.SelectControl,{value:o,options:[{label:(0,n.__)("Select…","bcgov-design-system"),value:""},...l],onChange:t=>p(e.id,a.id,t)})}return(0,t.createElement)(s.TextControl,{type:"date"===a.type?"date":"text",value:o,onChange:t=>p(e.id,a.id,t),className:"metadata-input"})})(a))),(0,t.createElement)("div",{className:"document-table-cell",role:"cell"},e.metadata&&e.metadata.document_file_size?h(e.metadata.document_file_size):"—"),(0,t.createElement)("div",{className:"document-table-cell",role:"cell"},e.metadata&&e.metadata.document_file_type?e.metadata.document_file_type:"—"),(0,t.createElement)("div",{className:"document-table-cell actions",role:"cell","aria-label":(0,n.__)("Document actions","bcgov-design-system")},!u&&(0,t.createElement)("div",{className:"action-buttons"},c(E)?(0,t.createElement)(t.Fragment,null,(0,t.createElement)(s.Button,{onClick:()=>i(e),className:"doc-repo-button icon-button table-action-button",title:(0,n.__)("Restore","bcgov-design-system"),"aria-label":(0,n.__)("Restore","bcgov-design-system"),disabled:d},(0,t.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",width:"16px",height:"16px"},(0,t.createElement)("path",{d:"M440-320h80v-166l64 62 56-56-160-160-160 160 56 56 64-62v166ZM280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Z",fill:"currentColor"}))),(0,t.createElement)(s.Button,{onClick:()=>l(e),className:"doc-repo-button icon-button table-action-button",title:(0,n.__)("Delete Permanently","bcgov-design-system"),"aria-label":(0,n.__)("Delete Permanently","bcgov-design-system"),disabled:d},(0,t.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",width:"16px",height:"16px"},(0,t.createElement)("path",{d:"m376-300 104-104 104 104 56-56-104-104 104-104-56-56-104 104-104-104-56 56 104 104-104 104 56 56Zm-96 180q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Z",fill:"currentColor"})))):(0,t.createElement)(t.Fragment,null,(0,t.createElement)(s.Button,{onClick:()=>window.open(e.metadata.document_file_url,"_blank"),className:"doc-repo-button icon-button table-action-button",title:(0,n.__)("Download","bcgov-design-system"),"aria-label":(0,n.__)("Download","bcgov-design-system")},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z",fill:"currentColor"}))),(0,t.createElement)(s.Button,{onClick:()=>r(e),className:"doc-repo-button icon-button table-action-button",title:(0,n.__)("Edit Metadata","bcgov-design-system"),"aria-label":(0,n.__)("Edit Metadata","bcgov-design-system")},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"currentColor"}))),(0,t.createElement)(s.Button,{onClick:()=>l(e),className:"doc-repo-button icon-button table-action-button",title:(0,n.__)("Trash","bcgov-design-system"),"aria-label":(0,n.__)("Trash","bcgov-design-system"),disabled:d},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z",fill:"currentColor"})))))))}function m({documents:e,selectedDocuments:a,onSelectDocument:o,onSelectAll:l,onDelete:c,onEdit:i,onRestore:m,isDeleting:u,metadataFields:g,isSpreadsheetMode:p,bulkEditedMetadata:h,onMetadataChange:E,formatFileSize:v,documentStatusFilter:b}){const y=e.length>0&&a.length===e.length;return(0,t.createElement)("div",{className:"document-table",role:"table"},(0,t.createElement)("div",{className:"document-table-header",role:"rowgroup"},(0,t.createElement)("div",{className:"document-table-row",role:"row"},(0,t.createElement)("div",{className:"document-table-cell header",role:"columnheader"},(0,t.createElement)(s.CheckboxControl,{checked:y,onChange:l})),(0,t.createElement)("div",{className:"document-table-cell header",role:"columnheader"},(0,n.__)("Title","bcgov-design-system")),g.map(e=>(0,t.createElement)("div",{key:e.id,className:"document-table-cell header metadata-column",role:"columnheader"},e.label)),(0,t.createElement)("div",{className:"document-table-cell header",role:"columnheader"},(0,n.__)("Size","bcgov-design-system")),(0,t.createElement)("div",{className:"document-table-cell header",role:"columnheader"},(0,n.__)("Type","bcgov-design-system")),(0,t.createElement)("div",{className:"document-table-cell header",role:"columnheader"},(0,n.__)("Actions","bcgov-design-system")))),(0,t.createElement)("div",{className:"document-table-body",role:"rowgroup"},e.map(e=>(0,t.createElement)(r,{key:e.id},(0,t.createElement)(d,{document:e,isSelected:a.includes(e.id),onSelect:o,onDelete:c,onEdit:i,onRestore:m,isDeleting:u,metadataFields:g,isSpreadsheetMode:p,bulkEditedMetadata:h,onMetadataChange:E,formatFileSize:v,documentStatusFilter:b})))))}const u=({uploadingFiles:e,showUploadFeedback:s,onClose:o})=>{const l=e.filter(e=>"success"===e.status).length,r=e.filter(e=>"error"===e.status).length,c=e.filter(e=>"uploading"===e.status).length,i=e.filter(e=>"processing"===e.status).length,d=e.some(e=>e.isPlaceholder);return(0,a.useEffect)(()=>{if(s&&0===c&&0===i&&!d&&e.length>0){const e=setTimeout(()=>{o()},3e3);return()=>clearTimeout(e)}},[s,c,i,d,o,e.length]),s&&0!==e.length?(0,t.createElement)("div",{className:"upload-feedback"},(0,t.createElement)("div",{className:"upload-feedback-header"},(0,t.createElement)("div",{className:"upload-feedback-title"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z",fill:"currentColor"})),(0,n.__)("Document Upload Status","bcgov-design-system")),(0,t.createElement)("button",{className:"upload-feedback-close",onClick:()=>{0===c&&0===i&&o()}},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z",fill:"currentColor"})))),(0,t.createElement)("div",{className:"upload-feedback-items"},e.map(e=>(0,t.createElement)("div",{key:e.id,className:`upload-feedback-item ${e.status} ${e.isPlaceholder?"placeholder":""}`},(0,t.createElement)("span",{className:"upload-feedback-item-name"},e.name),"processing"===e.status&&(0,t.createElement)(t.Fragment,null,(0,n.__)("Processing…","bcgov-design-system")),"uploading"===e.status&&(0,t.createElement)(t.Fragment,null,(0,n.__)("Uploading…","bcgov-design-system")),"success"===e.status&&(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z",fill:"currentColor"})),"error"===e.status&&(0,t.createElement)(t.Fragment,null,(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z",fill:"currentColor"})),e.error&&(0,t.createElement)("span",{className:"upload-feedback-item-error"},e.error))))),(0,t.createElement)("div",{className:"upload-feedback-summary"},d?(0,t.createElement)("div",{className:"processing"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z",fill:"currentColor"})),(0,n.__)("Preparing files…","bcgov-design-system")):(0,t.createElement)(t.Fragment,null,i>0&&(0,t.createElement)("div",{className:"processing"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z",fill:"currentColor"})),(0,n.sprintf)(/* translators: %d: number of files being processed */ /* translators: %d: number of files being processed */
(0,n.__)("Processing %d files…","bcgov-design-system"),i)),c>0&&(0,t.createElement)("div",{className:"uploading"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z",fill:"currentColor"})),(0,n.sprintf)(/* translators: %d: number of files being uploaded */ /* translators: %d: number of files being uploaded */
(0,n.__)("Uploading %d files…","bcgov-design-system"),c)),l>0&&(0,t.createElement)("div",{className:"success"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z",fill:"currentColor"})),(0,n.sprintf)(/* translators: %d: number of files that were successfully uploaded */ /* translators: %d: number of files that were successfully uploaded */
(0,n.__)("%d files uploaded successfully","bcgov-design-system"),l)),r>0&&(0,t.createElement)("div",{className:"error"},(0,t.createElement)("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},(0,t.createElement)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z",fill:"currentColor"})),(0,n.sprintf)(/* translators: %d: number of files that failed to upload */ /* translators: %d: number of files that failed to upload */
(0,n.__)("%d files failed to upload","bcgov-design-system"),r))))):null},g=({title:e,isOpen:o,onClose:l,onSave:r,isSaving:c=!1,isDisabled:i=!1,saveButtonText:d,saveButtonClassName:m="doc-repo-button save-button",children:u})=>{const g=(0,a.useCallback)(e=>{e&&(e.preventDefault(),e.stopPropagation()),l()},[l]),p=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),r()},[r]);return o?(0,t.createElement)(s.Modal,{title:e,onRequestClose:g,className:"metadata-edit-modal",shouldCloseOnClickOutside:!0,shouldCloseOnEsc:!0},(0,t.createElement)("form",{onSubmit:p,className:"metadata-edit-form"},u,(0,t.createElement)("div",{className:"modal-actions"},(0,t.createElement)(s.Button,{onClick:g,disabled:c,className:"doc-repo-button cancel-button"},(0,n.__)("Cancel","bcgov-design-system")),(0,t.createElement)(s.Button,{type:"submit",isBusy:c,disabled:c||i,className:m},d||(0,n.__)("Save Changes","bcgov-design-system"))))):null},p=({onFilesSelected:e,acceptMimeTypes:o="application/pdf"})=>{const[l,r]=(0,a.useState)(!1),c=(0,a.useRef)(null),i=(0,a.useRef)(null);(0,a.useEffect)(()=>()=>{i.current&&clearTimeout(i.current)},[]);const d=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),r(!0)},[]),m=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),l||r(!0)},[l]),u=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),!e.currentTarget.contains(e.relatedTarget)&&(i.current=setTimeout(()=>{r(!1)},50))},[]),g=(0,a.useCallback)(t=>{t.preventDefault(),t.stopPropagation(),r(!1);const a=t.dataTransfer.files;a&&a.length>0&&e(Array.from(a))},[e]),p=(0,a.useCallback)(t=>{const a=Array.from(t.target.files);a.length>0&&e(a)},[e]),h=(0,a.useCallback)(e=>{e&&e.stopPropagation(),c.current&&c.current.click()},[c]),E=(0,a.useCallback)(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),h())},[h]);return(0,t.createElement)("div",{className:"upload-area__container "+(l?"upload-area__container--drag-active":""),onDragEnter:d,onDragOver:m,onDragLeave:u,onDrop:g,onClick:h,onKeyDown:E,tabIndex:"0",role:"button","aria-label":(0,n.__)("Click or drag files to upload","bcgov-design-system")},(0,t.createElement)("input",{type:"file",ref:c,className:"upload-area__file-input",onChange:p,multiple:!0,accept:o,"aria-hidden":"true"}),(0,t.createElement)("div",{className:"upload-area__content"},(0,t.createElement)("div",{className:"upload-area__icon"},(0,t.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"48",height:"48"},(0,t.createElement)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z",fill:"currentColor"}))),(0,t.createElement)("h3",{className:"upload-area__text"},(0,n.__)("Drag & Drop or Click to Upload","bcgov-design-system")),(0,t.createElement)("p",{className:"upload-area__help-text"},(0,n.__)("Upload PDF documents to the repository","bcgov-design-system")),(0,t.createElement)(s.Button,{className:"upload-area__button",onClick:e=>{e.stopPropagation(),h()}},(0,n.__)("Choose Files","bcgov-design-system"))))},h=({currentPage:e,totalPages:a,onPageChange:o})=>a<=1?null:(0,t.createElement)("div",{className:"pagination"},(0,t.createElement)(s.Button,{onClick:()=>o(e-1),disabled:1===e},(0,n.__)("Previous","bcgov-design-system")),(0,t.createElement)("span",{className:"page-info"},(0,n.sprintf)(/* translators: %1$d: current page number, %2$d: total number of pages */ /* translators: %1$d: current page number, %2$d: total number of pages */
(0,n.__)("Page %1$d of %2$d","bcgov-design-system"),e,a)),(0,t.createElement)(s.Button,{onClick:()=>o(e+1),disabled:e===a},(0,n.__)("Next","bcgov-design-system"))),E=({failedOperations:e,onRetryAll:a})=>0===e.length?null:(0,t.createElement)(s.Notice,{status:"warning",isDismissible:!1,className:"retry-notice"},(0,t.createElement)("p",null,(0,n.sprintf)(/* translators: %d: number of failed operations */ /* translators: %d: number of failed operations */
(0,n.__)("There are %d failed operations that can be retried.","bcgov-design-system"),e.length)),(0,t.createElement)(s.Button,{variant:"secondary",onClick:a},(0,n.__)("Retry All","bcgov-design-system"))),v=window.wp.apiFetch;var b=e.n(v);const y=(e,t)=>{switch(t.type){case"SET_EDITING_DOCUMENT":return{...e,editingMetadata:t.payload,editedValues:t.initialValues||{},errors:{}};case"CLEAR_EDITING_DOCUMENT":return{...e,editingMetadata:null,editedValues:{},errors:{}};case"UPDATE_EDITED_VALUES":return{...e,editedValues:{...e.editedValues,...t.payload}};case"SET_ERRORS":return{...e,errors:t.payload};case"SET_IS_SAVING":return{...e,isSaving:t.payload};case"ENTER_SPREADSHEET_MODE":return{...e,isSpreadsheetMode:!0,bulkEditedMetadata:t.initialBulkValues||{},hasMetadataChanges:!1};case"EXIT_SPREADSHEET_MODE":return{...e,isSpreadsheetMode:!1,bulkEditedMetadata:{},hasMetadataChanges:!1};case"UPDATE_BULK_METADATA":return{...e,bulkEditedMetadata:{...e.bulkEditedMetadata,[t.documentId]:{...e.bulkEditedMetadata[t.documentId],[t.fieldId]:t.value}},hasMetadataChanges:t.hasChanges};case"SET_IS_SAVING_BULK":return{...e,isSavingBulk:t.payload};case"CLEAR_BULK_CHANGES":return{...e,bulkEditedMetadata:{},hasMetadataChanges:!1};default:return e}},_=({documents:e=[],currentPage:o=1,totalPages:r=1,onPageChange:d,onDelete:v,onTrash:_,onRestore:f,isDeleting:S=!1,selectedDocuments:w=[],onSelectDocument:C,onSelectAll:D,onFileDrop:N,onDocumentsUpdate:k,metadataFields:M=[],statusCounts:T={},documentStatusFilter:F="all",onStatusFilterChange:R})=>{const P=(0,a.useMemo)(()=>e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},[]),B=(0,a.useMemo)(()=>{const e=window.documentRepositorySettings;return e?.apiNamespace||"wp/v2"},[]),{showNotification:x}=(()=>{const[e,t]=(0,a.useState)(null);return{notice:e,showNotification:(0,a.useCallback)((e,a,s=3e3)=>{t({status:e,message:a}),s>0&&setTimeout(()=>t(null),s)},[]),clearNotification:(0,a.useCallback)(()=>{t(null)},[])}})(),{failedOperations:A,handleOperationError:O,retryAllOperations:I}=(({onShowNotification:e})=>{const[t,s]=(0,a.useState)([]),[o,l]=(0,a.useState)({}),r=(0,a.useCallback)((t,a,o,r={})=>{const{addToRetryQueue:c=!0,showNotice:i=!0,customMessage:d=null}=r;if(c&&(s(e=>[...e,{type:t,documentId:a,error:o}]),l(e=>({...e,[a]:(e[a]||0)+1}))),i&&e){const t=d||o.message||o.data?.message||(0,n.__)("An unknown error occurred.","bcgov-design-system");e("error",a?(0,n.sprintf)(/* translators: %1$d: document ID, %2$s: error message */ /* translators: %1$d: document ID, %2$s: error message */
(0,n.__)("Operation failed for document %1$d: %2$s","bcgov-design-system"),a,t):t)}},[e]),c=(0,a.useCallback)(async(t,a)=>{if(o[t.documentId]>=3)e("error",(0,n.sprintf)(/* translators: %1$d: document ID */ /* translators: %1$d: document ID */
(0,n.__)("Maximum retry attempts reached for document %1$d","bcgov-design-system"),t.documentId));else try{const e=a[t.type];if(!e)return{error:`Unknown operation type: ${t.type}`};await e(t.documentId),s(e=>e.filter(e=>!(e.type===t.type&&e.documentId===t.documentId)))}catch(e){r(t.type,t.documentId,e)}},[o,r,e]),i=(0,a.useCallback)(e=>{t.forEach(t=>c(t,e))},[t,c]);return{failedOperations:t,handleOperationError:r,retryOperation:c,retryAllOperations:i}})({onShowNotification:x}),{deleteDocument:U,restoreDocument:$,bulkDeleteConfirmOpen:L,bulkRestoreConfirmOpen:z,isMultiDeleting:V,isMultiRestoring:j,setDeleteDocument:H,setRestoreDocument:q,handleBulkDelete:G,handleBulkRestore:K,handleSingleDelete:W,handleSingleRestore:X,openBulkDeleteConfirm:Q,closeBulkDeleteConfirm:Z,openBulkRestoreConfirm:J,closeBulkRestoreConfirm:Y}=(({onDelete:e,onTrash:t,onRestore:s,documentStatusFilter:o,onSelectAll:l,onShowNotification:r,onError:i})=>{const[d,m]=(0,a.useState)(null),[u,g]=(0,a.useState)(null),[p,h]=(0,a.useState)(!1),[E,v]=(0,a.useState)(!1),[b,y]=(0,a.useState)(!1),[_,f]=(0,a.useState)(!1),S=(0,a.useCallback)(async a=>{if(a&&0!==a.length){y(!0);try{await Promise.all(a.map(a=>c(o)?e(a):t(a))),h(!1),l(!1),r&&r("success",(0,n.__)(c(o)?"Selected documents were deleted successfully.":"Selected documents were trashed successfully.","bcgov-design-system"))}catch(e){i&&i("bulk-delete",null,e,{addToRetryQueue:!1,customMessage:(0,n.__)(c(o)?"Error deleting one or more documents.":"Error trashing one or more documents.","bcgov-design-system")})}finally{y(!1)}}},[e,t,o,l,r,i]),w=(0,a.useCallback)(async a=>{try{c(o)?await e(a):await t(a),m(null),r&&r("success",(0,n.__)(c(o)?"Document deleted successfully.":"Document trashed successfully.","bcgov-design-system"))}catch(e){i&&i("delete",a,e,{customMessage:(0,n.sprintf)(/* translators: %1$d: document ID, %2$s: error message */ /* translators: %1$d: document ID, %2$s: error message */
(0,n.__)(c(o)?"Error deleting document %1$d: %2$s":"Error trashing document %1$d: %2$s","bcgov-design-system"),a,e.message||(0,n.__)("An unknown error occurred","bcgov-design-system"))})}},[e,t,o,r,i]),C=(0,a.useCallback)(async e=>{if(e&&0!==e.length){f(!0);try{await Promise.all(e.map(s)),v(!1),l(!1),r&&r("success",(0,n.__)("Selected documents were restored successfully.","bcgov-design-system"))}catch(e){i&&i("bulk-restore",null,e,{addToRetryQueue:!1,customMessage:(0,n.__)("Error restoring one or more documents.","bcgov-design-system")})}finally{f(!1)}}},[s,l,r,i]),D=(0,a.useCallback)(async e=>{try{await s(e),g(null),r&&r("success",(0,n.__)("Document restored successfully.","bcgov-design-system"))}catch(t){i&&i("restore",e,t,{customMessage:(0,n.sprintf)(/* translators: %1$d: document ID, %2$s: error message */ /* translators: %1$d: document ID, %2$s: error message */
(0,n.__)("Error restoring document %1$d: %2$s","bcgov-design-system"),e,t.message||(0,n.__)("An unknown error occurred","bcgov-design-system"))})}},[s,r,i]),N=(0,a.useCallback)(()=>{h(!0)},[]),k=(0,a.useCallback)(()=>{h(!1)},[]),M=(0,a.useCallback)(()=>{v(!0)},[]),T=(0,a.useCallback)(()=>{v(!1)},[]);return{deleteDocument:d,restoreDocument:u,bulkDeleteConfirmOpen:p,bulkRestoreConfirmOpen:E,isMultiDeleting:b,isMultiRestoring:_,setDeleteDocument:m,setRestoreDocument:g,handleBulkDelete:S,handleBulkRestore:C,handleSingleDelete:w,handleSingleRestore:D,openBulkDeleteConfirm:N,closeBulkDeleteConfirm:k,openBulkRestoreConfirm:M,closeBulkRestoreConfirm:T}})({onDelete:v,onTrash:_,onRestore:f,documentStatusFilter:F,onSelectAll:D,onShowNotification:x,onError:O}),{editingMetadata:ee,editedValues:te,errors:ae,isSaving:se,hasMetadataChanged:ne,handleEditMetadata:oe,updateEditedField:le,handleSaveMetadata:re,isSpreadsheetMode:ce,hasMetadataChanges:ie,bulkEditedMetadata:de,isSavingBulk:me,handleMetadataChange:ue,toggleSpreadsheetMode:ge,handleSaveBulkChanges:pe,localDocuments:he}=(({documents:e=[],metadataFields:t=[],apiNamespace:s,onUpdateDocuments:o,onError:l,onShowNotification:r})=>{const[c,i]=(0,a.useReducer)(y,{editingMetadata:null,editedValues:{},errors:{},isSaving:!1,isSpreadsheetMode:!1,bulkEditedMetadata:{},hasMetadataChanges:!1,isSavingBulk:!1}),[d,m]=(0,a.useState)(e);(0,a.useEffect)(()=>{m(e)},[e]);const u=(0,a.useCallback)(()=>{const{editingMetadata:e,editedValues:a}=c;return!!e&&t.some(t=>(e.metadata?.[t.id]||"")!==(a[t.id]||""))},[c,t]),g=(0,a.useCallback)(e=>{if(!e)return void i({type:"CLEAR_EDITING_DOCUMENT"});const a={...e,upload_date:e.date||e.upload_date||e.metadata?.upload_date},s={};t.forEach(t=>{var a;s[t.id]=null!==(a=e.metadata?.[t.id])&&void 0!==a?a:""}),i({type:"SET_EDITING_DOCUMENT",payload:a,initialValues:s})},[t]),p=(0,a.useCallback)((e,t,a)=>{const s={...c.bulkEditedMetadata,[e]:{...c.bulkEditedMetadata[e],[t]:a}},n=Object.entries(s).some(([e,t])=>{const a=d.find(t=>t.id===parseInt(e));return!!a&&Object.entries(t).some(([e,t])=>{const s=a.metadata?.[e]||"";return String(s)!==String(t)})});i({type:"UPDATE_BULK_METADATA",documentId:e,fieldId:t,value:a,hasChanges:n}),m(s=>s.map(s=>s.id===e?{...s,metadata:{...s.metadata,[t]:a}}:s))},[d,c.bulkEditedMetadata,i]),h=(0,a.useCallback)((e,t)=>{i({type:"UPDATE_EDITED_VALUES",payload:{[e]:t}})},[i]),E=(0,a.useCallback)(async()=>{const{editingMetadata:e,editedValues:t}=c;if(e){i({type:"SET_IS_SAVING",payload:!0});try{await b()({path:`/${s}/documents/${e.id}/metadata`,method:"POST",data:t}),m(a=>a.map(a=>a.id===e.id?{...a,metadata:{...a.metadata,...t}}:a)),"function"==typeof o&&o(d.map(a=>a.id===e.id?{...a,metadata:{...a.metadata,...t}}:a)),i({type:"CLEAR_EDITING_DOCUMENT"}),r&&r("success",(0,n.__)("Document metadata updated successfully","bcgov-design-system"))}catch(t){t.data?.errors&&i({type:"SET_ERRORS",payload:t.data.errors}),l&&l("metadata",e.id,t,{customMessage:t.data?.message||(0,n.__)("Failed to update metadata","bcgov-design-system")})}finally{i({type:"SET_IS_SAVING",payload:!1})}}},[c,s,d,o,r,l,i]),v=(0,a.useCallback)(e=>{if(e){const e={};d.forEach(t=>{e[t.id]={...t.metadata||{}}}),i({type:"ENTER_SPREADSHEET_MODE",initialBulkValues:e})}else i({type:"EXIT_SPREADSHEET_MODE"})},[d]),_=(0,a.useCallback)(async()=>{const{bulkEditedMetadata:e}=c;i({type:"SET_IS_SAVING_BULK",payload:!0});try{const t=await Promise.allSettled(Object.entries(e).map(([e,t])=>b()({path:`/${s}/documents/${e}/metadata`,method:"POST",data:t}))),a=Object.keys(e),c=t.map((e,t)=>({result:e,docId:a[t]})).filter(({result:e})=>"rejected"===e.status),m=t.map((e,t)=>({result:e,docId:a[t]})).filter(({result:e})=>"fulfilled"===e.status);if(c.length>0&&(c.forEach(({result:e,docId:t})=>{l&&l("metadata",t,e.reason,{showNotice:!1})}),r&&r("warning",(0,n.sprintf)(/* translators: %1$d: number of failed updates, %2$d: total number of updates */ /* translators: %1$d: number of failed updates, %2$d: total number of updates */
(0,n.__)("%1$d of %2$d metadata updates failed. You can retry the failed operations.","bcgov-design-system"),c.length,Object.keys(e).length),0)),m.length>0){const e=d.map(e=>{const t=m.find(({docId:t})=>t===e.id.toString());return t?t.result.value:e});"function"==typeof o&&o(e)}0===c.length&&(r&&r("success",(0,n.__)("All metadata changes saved successfully.","bcgov-design-system")),i({type:"CLEAR_BULK_CHANGES"}),i({type:"EXIT_SPREADSHEET_MODE"}))}catch(e){l&&l("bulk-metadata",null,e)}finally{i({type:"SET_IS_SAVING_BULK",payload:!1})}},[c,s,l,r]);return{editingMetadata:c.editingMetadata,editedValues:c.editedValues,errors:c.errors,isSaving:c.isSaving,hasMetadataChanged:u,handleEditMetadata:g,updateEditedField:h,handleSaveMetadata:E,isSpreadsheetMode:c.isSpreadsheetMode,hasMetadataChanges:c.hasMetadataChanges,bulkEditedMetadata:c.bulkEditedMetadata,isSavingBulk:c.isSavingBulk,handleMetadataChange:p,toggleSpreadsheetMode:v,handleSaveBulkChanges:_,localDocuments:d}})({documents:e,metadataFields:M,apiNamespace:B,onUpdateDocuments:k,onError:O,onShowNotification:x}),{uploadingFiles:Ee,showUploadFeedback:ve,handleFiles:be,closeUploadFeedback:ye}=(({onFileDrop:e,onShowNotification:t,onError:s})=>{const[o,l]=(0,a.useState)([]),[r,c]=(0,a.useState)(!1);return{uploadingFiles:o,showUploadFeedback:r,handleFiles:(0,a.useCallback)(a=>{if(c(!0),!a||0===a.length)return t&&t("error",(0,n.__)("No files were selected for upload.","bcgov-design-system")),void c(!1);l([{id:"placeholder",name:(0,n.sprintf)(/* translators: %d: number of files being prepared */ /* translators: %d: number of files being prepared */
(0,n.__)("Preparing %d files…","bcgov-design-system"),a.length),status:"processing",error:null,isPlaceholder:!0}]);const o=a.map(e=>({id:Math.random().toString(36).substr(2,9),name:e.name,originalFile:e,status:"processing",error:null}));l(o);const r=[],i=[];a.forEach(e=>{"application/pdf"===e.type||e.name.toLowerCase().endsWith(".pdf")?r.push(e):i.push(e)}),l(e=>e.map(e=>{const t=a.find(t=>t.name===e.name),s=t&&("application/pdf"===t.type||t.name.toLowerCase().endsWith(".pdf"));return{...e,status:s?"uploading":"error",error:s?null:(0,n.__)("Not a PDF file. Only PDF files are allowed.","bcgov-design-system")}})),i.length>0&&t&&t("warning",(0,n.sprintf)(/* translators: %1$d: number of skipped files, %2$d: total number of files */ /* translators: %1$d: number of skipped files, %2$d: total number of files */
(0,n.__)("%1$d of %2$d files were skipped because they are not PDFs.","bcgov-design-system"),i.length,a.length)),0!==r.length&&r.forEach(t=>{e(t).then(()=>{l(e=>e.map(e=>e.name===t.name?{...e,status:"success"}:e))}).catch(e=>{l(a=>a.map(a=>a.name===t.name?{...a,status:"error",error:e.message||(0,n.__)("Upload failed. Please try again.","bcgov-design-system")}:a)),s&&s("upload",t.name,e,{addToRetryQueue:!1,customMessage:(0,n.sprintf)(/* translators: %1$s: file name, %2$s: error message */ /* translators: %1$s: file name, %2$s: error message */
(0,n.__)('Error uploading "%1$s": %2$s',"bcgov-design-system"),t.name,e.message||(0,n.__)("Upload failed","bcgov-design-system"))})})})},[e,t,s]),closeUploadFeedback:(0,a.useCallback)(()=>{c(!1),l([])},[])}})({onFileDrop:N,onShowNotification:x,onError:O}),_e=(0,a.useCallback)(()=>{I({delete:v,metadata:re})},[v,re,I]),fe=(0,a.useMemo)(()=>({documents:he,selectedDocuments:w,onSelectDocument:C,onSelectAll:D,onDelete:H,onEdit:oe,onRestore:q,isDeleting:S,metadataFields:M,isSpreadsheetMode:ce,bulkEditedMetadata:de,onMetadataChange:ue,formatFileSize:P,documentStatusFilter:F}),[he,w,C,D,S,M,ce,de,oe,ue,P,H,q]),{totalDocumentCount:Se,trashedCount:we}=(0,a.useMemo)(()=>({totalDocumentCount:Object.entries(T).reduce((e,[t,a])=>"trash"!==t?e+Number(a||0):e,0),trashedCount:Number(T.trash||0)}),[T]);return(0,t.createElement)(l,null,(0,t.createElement)("div",{className:"document-list"},(0,t.createElement)(E,{failedOperations:A,onRetryAll:_e}),(0,t.createElement)("div",{className:"document-list__actions"},(0,t.createElement)("div",{className:"document-list__left-actions"}),(0,t.createElement)("div",{className:"document-list__right-actions"},(0,t.createElement)(p,{onFilesSelected:e=>{be(e)}}))),(0,t.createElement)("ul",{className:"subsubsub document-status-filters"},(0,t.createElement)("li",{className:"all"},(0,t.createElement)("a",{href:"#",className:i(F)?"current":"",onClick:e=>{e.preventDefault(),R&&R("all")}},(0,n.__)("All","bcgov-design-system")," ",(0,t.createElement)("span",{className:"count"},"( ",Se," )"))),(0,t.createElement)("li",{className:"trash"}," | ",(0,t.createElement)("a",{href:"#",className:c(F)?"current":"",onClick:e=>{e.preventDefault(),R&&R("trash")}},(0,n.__)("Trash","bcgov-design-system ")," ",(0,t.createElement)("span",{className:"count"},"( ",we," )")))),(0,t.createElement)("div",{className:"document-list__table-actions"},(0,t.createElement)("div",{className:"action-buttons-container"},(0,t.createElement)(s.Button,{className:"doc-repo-button spreadsheet-toggle"+(ce?" isPressed":""),onClick:()=>ge(!ce),isPressed:ce},ce?(0,n.__)("Exit Spreadsheet Mode","bcgov-design-system"):(0,n.__)("Enter Spreadsheet Mode","bcgov-design-system")),ce&&ie&&(0,t.createElement)(s.Button,{className:"doc-repo-button save-button",onClick:pe,isBusy:me,disabled:me},me?(0,n.__)("Saving…","bcgov-design-system"):(0,n.__)("Save Changes","bcgov-design-system")),c(F)&&w.length>0&&(0,t.createElement)(s.Button,{className:"doc-repo-button save-button bulk-restore-button",onClick:J,disabled:j},(0,n.sprintf)(/* translators: %d: number of selected documents */ /* translators: %d: number of selected documents */
(0,n.__)("Restore Selected (%d)","bcgov-design-system"),w.length)),w.length>0&&(0,t.createElement)(s.Button,{className:"doc-repo-button delete-button bulk-delete-button",onClick:Q,disabled:V},(0,n.sprintf)(/* translators: %d: number of selected documents */ /* translators: %d: number of selected documents */
(0,n.__)(c(F)?"Delete Selected Permanently (%d)":"Trash Selected (%d)","bcgov-design-system"),w.length)))),(0,t.createElement)(m,{...fe}),(0,t.createElement)(h,{currentPage:o,totalPages:r,onPageChange:d}),ve&&(0,t.createElement)(u,{uploadingFiles:Ee,showUploadFeedback:ve,onClose:ye}),U&&(0,t.createElement)(g,{title:c(F)?(0,n.__)("Delete Document Permanently","bcgov-design-system"):(0,n.__)("Trash Document","bcgov-design-system"),isOpen:!!U,onClose:()=>H(null),onSave:()=>W(U.id),isSaving:S,isDisabled:!1,saveButtonText:S?(0,n.__)(c(F)?"Deleting…":"Trashing…","bcgov-design-system"):(0,n.__)(c(F)?"Delete Permanently":"Trash","bcgov-design-system"),saveButtonClassName:"doc-repo-button delete-button"},(0,t.createElement)("div",{className:"delete-confirmation-content"},(0,t.createElement)("div",{className:"delete-warning"},(0,n.__)(c(F)?"Are you sure you want to delete this document? This action cannot be undone.":"Are you sure you want to trash this document?","bcgov-design-system")),(0,t.createElement)("div",{className:"documents-to-delete"},(0,t.createElement)("h4",null,(0,n.__)(c(F)?"Document to be deleted:":"Document to be trashed:","bcgov-design-system")),(0,t.createElement)("ul",null,(0,t.createElement)("li",null,U.title))))),$&&(0,t.createElement)(g,{title:(0,n.__)("Restore Document","bcgov-design-system"),isOpen:!!$,onClose:()=>q(null),onSave:()=>X($.id),isSaving:S,isDisabled:!1,saveButtonText:(0,n.__)("Restore","bcgov-design-system"),saveButtonClassName:"doc-repo-button save-button"},(0,t.createElement)("div",{className:"restore-confirmation-content"},(0,t.createElement)("div",{className:"restore-warning"},(0,n.__)("Are you sure you want to restore this document?","bcgov-design-system")),(0,t.createElement)("div",{className:"documents-to-restore"},(0,t.createElement)("h4",null,(0,n.__)("Document to be restored:","bcgov-design-system")),(0,t.createElement)("ul",null,(0,t.createElement)("li",null,$.title))))),L&&(0,t.createElement)(g,{title:c(F)?(0,n.__)("Delete Selected Documents Permanently","bcgov-design-system"):(0,n.__)("Trash Selected Documents","bcgov-design-system"),isOpen:L,onClose:Z,onSave:()=>G(w),isSaving:V,isDisabled:!1,saveButtonText:V?(0,n.__)(c(F)?"Deleting…":"Trashing…","bcgov-design-system"):(0,n.__)(c(F)?"Delete Selected Permanently":"Trash Selected","bcgov-design-system"),saveButtonClassName:"doc-repo-button delete-button"},(0,t.createElement)("div",{className:"delete-confirmation-content"},(0,t.createElement)("div",{className:"delete-warning"},(0,n.__)(c(F)?"Are you sure you want to delete the selected documents? This action cannot be undone.":"Are you sure you want to trash the selected documents?","bcgov-design-system")),(0,t.createElement)("div",{className:"documents-to-delete"},(0,t.createElement)("h4",null,(0,n.sprintf)(c(F)?(0,n.__)("Documents to be deleted (%d):","bcgov-design-system"):(0,n.__)("Documents to be trashed (%d):","bcgov-design-system"),w.length)),(0,t.createElement)("ul",null,he.filter(e=>w.includes(e.id)).map(e=>(0,t.createElement)("li",{key:e.id},e.title)))))),z&&(0,t.createElement)(g,{title:(0,n.__)("Restore Selected Documents","bcgov-design-system"),isOpen:z,onClose:Y,onSave:()=>K(w),isSaving:j,isDisabled:!1,saveButtonText:j?(0,n.__)("Restoring…","bcgov-design-system"):(0,n.__)("Restore Selected","bcgov-design-system"),saveButtonClassName:"doc-repo-button save-button"},(0,t.createElement)("div",{className:"restore-confirmation-content"},(0,t.createElement)("div",{className:"restore-warning"},(0,n.__)("Are you sure you want to restore the selected documents?","bcgov-design-system")),(0,t.createElement)("div",{className:"documents-to-restore"},(0,t.createElement)("h4",null,(0,n.sprintf)((0,n.__)("Documents to be restored (%d):","bcgov-design-system"),w.length)),(0,t.createElement)("ul",null,he.filter(e=>w.includes(e.id)).map(e=>(0,t.createElement)("li",{key:e.id},e.title)))))),ee&&(0,t.createElement)(g,{title:(0,n.__)("Edit Document Metadata","bcgov-design-system"),isOpen:!!ee,onClose:()=>oe(null),onSave:re,isSaving:se,isDisabled:!ne,saveButtonText:se?(0,n.__)("Saving…","bcgov-design-system"):(0,n.__)("Save Changes","bcgov-design-system"),saveButtonClassName:"doc-repo-button save-button"},(0,t.createElement)("div",{className:"editable-metadata"},M.map(e=>(0,t.createElement)("div",{key:e.id,className:"metadata-field"},(0,t.createElement)("label",{htmlFor:e.id},e.label),"taxonomy"===e.type?(0,t.createElement)(s.SelectControl,{id:e.id,value:te[e.id]||"",options:[{label:(0,n.__)("Select…","bcgov-design-system"),value:""},...(e.options||[]).map(e=>"string"==typeof e?{label:e,value:e}:{label:e.label||e.name,value:e.value||e.id})],onChange:t=>le(e.id,t)}):(0,t.createElement)(s.TextControl,{id:e.id,type:"date"===e.type?"date":"text",value:te[e.id]||"",onChange:t=>le(e.id,t)}),ae[e.id]&&(0,t.createElement)("div",{className:"metadata-error"},ae[e.id])))),(0,t.createElement)("div",{className:"non-editable-metadata"},(0,t.createElement)("h3",null,(0,n.__)("Document Information","bcgov-design-system")),(0,t.createElement)("div",{className:"metadata-field"},(0,t.createElement)("label",{htmlFor:"document-filename"},(0,n.__)("Filename","bcgov-design-system")),(0,t.createElement)("div",{id:"document-filename",className:"field-value"},(ee.metadata?.document_file_name||ee.filename||ee.title||"").replace(/\.pdf$/i,"")||(0,n.__)("Not available","bcgov-design-system"))),(0,t.createElement)("div",{className:"metadata-field"},(0,t.createElement)("label",{htmlFor:"document-file-type"},(0,n.__)("File Type","bcgov-design-system")),(0,t.createElement)("div",{id:"document-file-type",className:"field-value"},ee.metadata?.document_file_type||"PDF")),(0,t.createElement)("div",{className:"metadata-field"},(0,t.createElement)("label",{htmlFor:"document-file-size"},(0,n.__)("File Size","bcgov-design-system")),(0,t.createElement)("div",{id:"document-file-size",className:"field-value"},ee.metadata?.document_file_size?P(parseInt(ee.metadata.document_file_size)):(0,n.__)("Not available","bcgov-design-system")))))))},f=({metadataFields:e,onUploadSuccess:o,selectedFile:l=null,modalMode:r=!1})=>{const[c,i]=(0,a.useState)(l),[d,m]=(0,a.useState)(!1),[u,g]=(0,a.useState)(0),[p,h]=(0,a.useState)(null),[E,v]=(0,a.useState)(!1),[b,y]=(0,a.useState)(!1),_=(0,a.useRef)(null),f=(0,a.useRef)(null),[S,w]=(0,a.useState)(l?l.name.split(".")[0]:""),[C,D]=(0,a.useState)({}),{apiNamespace:N,maxFileSize:k,allowedMimeTypes:M}=window.documentRepositorySettings,T=(0,a.useCallback)(e=>{if(!e)return!1;if(e.size>k){const t=`File "${e.name}" is too large (${(e.size/1048576).toFixed(2)} MB). Maximum allowed size is ${(k/1048576).toFixed(2)} MB.`;return h(t),!1}const t=e.name.split(".").pop().toLowerCase(),a=Object.keys(M);if(!a.includes(t)){const t=`File "${e.name}" has an invalid file type. Allowed types are: ${a.join(", ")}`;return h(t),!1}return h(null),!0},[k,M]),F=(0,a.useCallback)(e=>{if(!e)return!1;if(T(e)){i(e);const t=e.name.includes(".")?e.name.substring(0,e.name.lastIndexOf(".")):e.name;return w(t),!0}return!1},[T]);(0,a.useEffect)(()=>{if(l&&(w(l.name.replace(/\.[^/.]+$/,"")),!T(l)))return{error:"Initial file validation failed, but still setting file for UI"}},[l,T]),(0,a.useEffect)(()=>{r&&!c&&l&&i(l)},[r,l,c]);const R=e=>{const t=e.target.files[0];F(t)},P=()=>{_.current&&_.current.click()},B=(e,t)=>{D(a=>({...a,[e]:t}))},x=async()=>{if(!c)return void h("Please select a file to upload.");if(!T(c))return;m(!0),h(null),g(0);const e=new FormData;e.append("file",c),e.append("title",S),e.append("_wpnonce",window.documentRepositorySettings.nonce);const t={...C,document_repository:!0},a=JSON.stringify(t);e.append("metadata",a);try{const t=await fetch(`${window.documentRepositorySettings.apiRoot}${N}/documents`,{method:"POST",headers:{"X-WP-Nonce":window.documentRepositorySettings.nonce},body:e});if(!t.ok){const e=await t.json();throw new Error(e.message||"Upload failed")}const a=await t.json();v(!0),m(!1),o&&o(a.document),r||(i(null),w(""),D({}))}catch(e){h(e.message||"Failed to upload file. Please try again."),m(!1)}},A=e=>{const{id:a,label:o,type:l,options:r,required:c}=e;switch(l){case"text":return(0,t.createElement)(s.TextControl,{key:a,label:o,value:C[a]||"",onChange:e=>B(a,e),required:c});case"date":return(0,t.createElement)(s.TextControl,{key:a,label:o,type:"date",value:C[a]||"",onChange:e=>B(a,e),required:c});case"taxonomy":return(0,t.createElement)(s.SelectControl,{key:a,label:o,value:C[a]||"",options:[{label:(0,n.__)("Select…","bcgov-design-system"),value:""},...(r||[]).map(e=>"string"==typeof e?{label:e,value:e}:{label:e.label||e.name,value:e.value||e.id})],onChange:e=>B(a,e),required:c});default:return null}},O=()=>d?(0,t.createElement)(t.Fragment,null,(0,t.createElement)(s.Spinner,null),(0,n.__)("Uploading…","bcgov-design-system")):(0,n.__)("Upload Document","bcgov-design-system");return r?(0,t.createElement)("div",{className:"document-uploader-modal"},p&&(0,t.createElement)(s.Notice,{status:"error",isDismissible:!0,onRemove:()=>h(null)},p),E&&(0,t.createElement)(s.Notice,{status:"success",isDismissible:!0,onRemove:()=>v(!1)},(0,n.__)("Document uploaded successfully!","bcgov-design-system")),(0,t.createElement)("div",{className:"selected-file-info"},c?(0,t.createElement)("p",null,(0,t.createElement)("strong",null,"File:")," ",c.name," (",Math.round(c.size/1024)," KB)"):l?(0,t.createElement)("p",null,(0,t.createElement)("strong",null,"File:")," ",l.name," (",Math.round(l.size/1024)," KB)"):(0,t.createElement)("p",null,(0,t.createElement)("strong",null,"Warning:")," No file selected")),(0,t.createElement)(s.TextControl,{label:(0,n.__)("Document Title","bcgov-design-system"),value:S,onChange:w,disabled:d,required:!0}),(0,t.createElement)("h4",null,(0,n.__)("Document Metadata","bcgov-design-system")),(0,t.createElement)("div",{className:"metadata-fields modal-layout"},e.map(A)),d&&(0,t.createElement)("div",{className:"upload-progress"},(0,t.createElement)("progress",{value:u,max:"100"}),(0,t.createElement)("p",null,u,"%"," ",(0,n.__)("Uploaded","bcgov-design-system"))),(0,t.createElement)("div",{className:"modal-actions"},(0,t.createElement)(s.Button,{isPrimary:!0,onClick:x,disabled:!c&&!l||!S||d},O()))):(0,t.createElement)(s.Card,{className:"document-uploader"},(0,t.createElement)(s.CardHeader,null,(0,t.createElement)("h3",null,(0,n.__)("Upload Document","bcgov-design-system"))),(0,t.createElement)(s.CardBody,null,(0,t.createElement)(t.Fragment,null,E&&(0,t.createElement)(s.Notice,{status:"success",isDismissible:!0,onRemove:()=>v(!1)},(0,n.__)("Document uploaded successfully!","bcgov-design-system")),p&&(0,t.createElement)(s.Notice,{status:"error",isDismissible:!0,onRemove:()=>h(null)},p),!r&&!c&&(0,t.createElement)("div",{className:"upload-area__container "+(b?"upload-area__container--drag-active":""),onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),y(!0)},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),y(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation();const t=f.current.getBoundingClientRect();(e.clientX<t.left||e.clientX>=t.right||e.clientY<t.top||e.clientY>=t.bottom)&&y(!1)},onDrop:e=>{e.preventDefault(),e.stopPropagation(),y(!1);const t=Array.from(e.dataTransfer.files);var a;t.length>0&&(a=t[0],F(a))},onClick:P,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||P()},role:"button",tabIndex:"0",ref:f},(0,t.createElement)("input",{type:"file",ref:_,onChange:R,className:"upload-area__file-input",accept:Object.values(M).join(",")}),(0,t.createElement)("div",{className:"upload-area__content"},(0,t.createElement)("div",{className:"upload-area__icon"},(0,t.createElement)("svg",{viewBox:"0 0 64 64",width:"64",height:"64"},(0,t.createElement)("path",{d:"M32 16v24M20 28l12-12 12 12",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.createElement)("path",{d:"M16 48h32M12 20v28c0 2.2 1.8 4 4 4h32c2.2 0 4-1.8 4-4V20",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}))),(0,t.createElement)("div",{className:"upload-area__text"},(0,t.createElement)("p",{className:"upload-area__text-primary"},b?(0,n.__)("Drop file here","bcgov-design-system"):(0,n.__)("Drag & drop your file here or click to browse","bcgov-design-system")),(0,t.createElement)("p",{className:"upload-area__help-text"},(0,n.__)("Accepted file types:","bcgov-design-system")," ",Object.keys(M).join(", ")),(0,t.createElement)("p",{className:"upload-area__help-text"},(0,n.__)("Maximum file size:","bcgov-design-system")," ",Math.round(k/1048576)," ","MB")))),r&&!c&&(0,t.createElement)("div",{className:"document-uploader-file-select"},(0,t.createElement)(s.FormFileUpload,{accept:Object.values(M).join(","),onChange:R},(0,n.__)("Select a different file","bcgov-design-system"))),c&&(0,t.createElement)("div",{className:"selected-file-container"},(0,t.createElement)("div",{className:"selected-file"},(0,t.createElement)("span",{className:"file-name"},c.name),(0,t.createElement)("button",{type:"button",className:"remove-file",onClick:()=>i(null)},"✕")),!r&&(0,t.createElement)(s.FormFileUpload,{accept:Object.values(M).join(","),onChange:R},(0,n.__)("Select a different file","bcgov-design-system"))),d&&(0,t.createElement)("div",{className:"upload-progress"},(0,t.createElement)("progress",{value:u,max:"100"}),(0,t.createElement)("p",null,u,"%"," ",(0,n.__)("Uploaded","bcgov-design-system"))),(0,t.createElement)(s.TextControl,{label:(0,n.__)("Document Title","bcgov-design-system"),value:S,onChange:w,disabled:d,required:!0}),(0,t.createElement)("h4",null,(0,n.__)("Document Metadata","bcgov-design-system")),(0,t.createElement)("div",{className:"metadata-fields "+(r?"modal-layout":"")},e.map(A)))),(0,t.createElement)(s.CardFooter,null,(0,t.createElement)("div",{className:"card-actions"},(0,t.createElement)(s.Button,{isPrimary:!0,onClick:x,disabled:!c||!S||d},O()))))};class S extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({errorInfo:t})}render(){return this.state.hasError?(0,t.createElement)("div",{className:"wordpress-document-repository-error"},(0,t.createElement)(s.Notice,{status:"error",isDismissible:!1},(0,t.createElement)("h2",null,(0,n.__)("Something went wrong in the Document Repository","bcgov-design-system")),(0,t.createElement)("p",null,this.state.error&&this.state.error.toString()),(0,t.createElement)("details",{style:{whiteSpace:"pre-wrap"}},this.state.errorInfo&&this.state.errorInfo.componentStack))):this.props.children}}const w=S,C=()=>{const[e,o]=(0,a.useState)(!0),[l,r]=(0,a.useState)(null),[c,d]=(0,a.useState)("Initializing"),[m,u]=(0,a.useState)([]),[g,p]=(0,a.useState)(!1),[h,E]=(0,a.useState)(!1),[v,y]=(0,a.useState)(null),[S,C]=(0,a.useState)("all"),[D,N]=(0,a.useState)([]),{documents:k,totalDocuments:M,currentPage:T,totalPages:F,statusCounts:R,fetchDocuments:P,deleteDocument:B,trashDocument:x,restoreDocument:A,isDeleting:O,isLoading:I,error:U,setSearchParams:$}=(()=>{const[e,t]=(0,a.useState)([]),[s,n]=(0,a.useState)(0),[o,l]=(0,a.useState)(1),[r,c]=(0,a.useState)(1),[i,d]=(0,a.useState)({}),[m,u]=(0,a.useState)(!1),[g,p]=(0,a.useState)(!1),[h,E]=(0,a.useState)(null),[v,y]=(0,a.useState)({page:1,per_page:window.documentRepositorySettings?.perPage||20,orderby:"date",order:"DESC",status:"all"}),_=(0,a.useCallback)(async()=>{if(window.documentRepositorySettings?.apiNamespace){u(!0),E(null);try{const{apiNamespace:e}=window.documentRepositorySettings,a=new URLSearchParams;Object.entries(v).forEach(([e,t])=>{t&&a.append(e,t)});const s=new Promise((e,t)=>{setTimeout(()=>{t(new Error("Document fetch request timed out. Please try again."))},5e3)}),o=await Promise.race([b()({path:`/${e}/documents?${a.toString()}`}),s]);if(!o||"object"!=typeof o)throw new Error("Invalid response from server");const r=Array.isArray(o.documents)?o.documents.filter(e=>e&&"object"==typeof e&&e.id):[];t(r),n(o.total||0),l(o.current_page||1),c(o.total_pages||1),d(o.status_counts||{}),0===r.length&&v.page>1&&y(e=>({...e,page:1}))}catch(e){E(e.message||"Error loading documents"),1===v.page&&(t([]),n(0),c(1))}finally{u(!1)}}else E("Document Repository settings not found. Make sure the script is properly enqueued in WordPress.")},[v]);(0,a.useEffect)(()=>{const e=parseInt(v.page,10);isNaN(e)||e===o||l(e)},[v.page,o]),(0,a.useEffect)(()=>{_()},[_]);const f=async e=>{p(!0);try{const{apiNamespace:t}=window.documentRepositorySettings;return await b()({path:`/${t}/documents/${e}?force=true`,method:"DELETE"}),await _(),p(!1),!0}catch(e){return E(e.message||"Error deleting document"),p(!1),!1}},S=async(e,t)=>{try{const{apiNamespace:a}=window.documentRepositorySettings,s=await b()({path:`/${a}/documents/${e}`,method:"PUT",data:t});return await _(),s}catch(e){return E(e.message||"Error updating document"),null}};return{documents:e,totalDocuments:s,currentPage:o,totalPages:r,statusCounts:i,isLoading:m,isDeleting:g,error:h,searchParams:v,setSearchParams:y,fetchDocuments:_,deleteDocument:f,trashDocument:async e=>{p(!0);try{const{apiNamespace:t}=window.documentRepositorySettings;return await b()({path:`/${t}/documents/${e}?force=false`,method:"DELETE"}),await _(),p(!1),!0}catch(e){return E(e.message||"Error trashing document"),p(!1),!1}},restoreDocument:async e=>{p(!0);try{const{apiNamespace:t}=window.documentRepositorySettings;return await b()({path:`/${t}/documents/${e}/restore`,method:"POST"}),await _(),p(!1),!0}catch(e){return E(e.message||"Error restoring document"),p(!1),!1}},updateDocument:S,bulkUpdateDocuments:async(e,t)=>{try{for(const a of e)await S(a,t);return await _(),!0}catch(e){return E(e.message||"Error performing bulk update"),!1}},bulkDeleteDocuments:async e=>{try{for(const t of e)await f(t);return!0}catch(e){return E(e.message||"Error performing bulk delete"),!1}}}})();(0,a.useEffect)(()=>{(async()=>{try{o(!0),r(null),d("Initializing");const e=new Promise((e,t)=>{setTimeout(()=>{t(new Error((0,n.__)("Loading document repository timed out. Please refresh the page.","bcgov-design-system")))},1e4)}),t=window.documentRepositorySettings;if(!t?.apiRoot||!t?.apiNamespace||!t?.nonce)throw new Error((0,n.__)("Document Repository settings not found. Make sure the script is properly enqueued in WordPress.","bcgov-design-system"));await Promise.race([(async()=>{d("Fetching metadata fields");const e=await fetch(`${t.apiRoot}${t.apiNamespace}/metadata-fields`,{headers:{"X-WP-Nonce":t.nonce}});if(!e.ok){let t;try{const a=await e.json();t=a.message||a.error}catch(a){t=e.statusText}throw new Error((0,n.__)("Failed to fetch metadata fields: ","bcgov-design-system")+t)}const a=await e.json();u(a),d("Loading documents"),await P()})(),e])}catch(e){r(e.message||(0,n.__)("Failed to initialize document repository","bcgov-design-system"))}finally{o(!1)}})()},[P]),(0,a.useEffect)(()=>{$(e=>({...e,status:i(S)?void 0:S,page:1})),N([])},[S]);const[L,z]=(0,a.useState)([]),[V,j]=(0,a.useState)(0),[H,q]=(0,a.useState)(0),G=(0,a.useMemo)(()=>{let e;return(...t)=>{clearTimeout(e),e=setTimeout(()=>P(...t),1e3)}},[P]),K=()=>{G(),p(!1),y(null),z([]),j(0)},W=async e=>{try{if(!e.type.includes("pdf")&&!e.name.toLowerCase().endsWith(".pdf"))throw new Error("Only PDF files are allowed");const t=new FormData;t.append("file",e),t.append("title",e.name.split(".")[0]);const a=window.documentRepositorySettings?.nonce;if(!a)throw new Error("Security token not found");const s=new window.XMLHttpRequest,n=new Promise((n,o)=>{s.open("POST",`${window.documentRepositorySettings.apiRoot}${window.documentRepositorySettings.apiNamespace}/documents`),s.setRequestHeader("X-WP-Nonce",a),s.upload.onprogress=e=>{if(e.lengthComputable){const t=Math.round(e.loaded/e.total*100);q(t)}},s.onload=()=>{if(s.status>=200&&s.status<300)try{const e=JSON.parse(s.responseText);n(e)}catch(t){o(new Error(`Error uploading "${e.name}": Server returned invalid response`))}else{let t;try{const e=JSON.parse(s.responseText);t=e.message||e.error||s.statusText}catch(e){t=s.statusText||"Server error"}o(new Error(`Error uploading "${e.name}": ${t}`))}},s.onerror=()=>{o(new Error(`Network error while uploading "${e.name}". Please check your connection and try again.`))},s.send(t)});await n,K()}catch(e){throw r(e.message||"Failed to upload file"),e}},X=l||U;return(0,a.useEffect)(()=>{if(X){const e=setTimeout(()=>{r(null)},3e3);return()=>clearTimeout(e)}},[X]),e?(0,t.createElement)("div",{className:"wordpress-document-repository-loading"},(0,t.createElement)(s.Spinner,null),(0,t.createElement)("p",null,c,"..."),(0,t.createElement)("p",{className:"loading-description"},(0,n.__)("Loading document repository…","bcgov-design-system"))):(0,t.createElement)(w,null,(0,t.createElement)("div",{className:"wordpress-document-repository"},X&&(0,t.createElement)(s.Notice,{status:"error",isDismissible:!0,onDismiss:()=>r(null),className:"document-repository-error"},(0,t.createElement)("p",null,X)),(0,t.createElement)(_,{documents:k||[],isLoading:I,totalItems:M,currentPage:T||1,totalPages:F||1,onPageChange:async e=>{try{r(null),$(t=>({...t,page:e}))}catch(e){r(e.message||(0,n.__)("Failed to change page","bcgov-design-system")),$(e=>({...e,page:T}))}},onDelete:B,onTrash:x,onRestore:A,isDeleting:O,selectedDocuments:D||[],onSelectDocument:e=>{try{const t=D.includes(e)?D.filter(t=>t!==e):[...D,e];N(t)}catch(e){r((0,n.__)("Failed to select document","bcgov-design-system"))}},onSelectAll:e=>{try{N(e?k.map(e=>e.id):[])}catch(e){r((0,n.__)("Failed to select documents","bcgov-design-system"))}},metadataFields:m||[],onUploadSuccess:K,onFileDrop:W,statusCounts:R,documentStatusFilter:S,onStatusFilterChange:C}),g&&v&&(0,t.createElement)(s.Modal,{title:L.length>1?(0,n.__)("Upload Documents","bcgov-design-system"):(0,n.__)("Upload Document","bcgov-design-system"),onRequestClose:()=>E(!0),className:"document-upload-modal"},(0,t.createElement)("div",{className:"upload-progress-info"},L.length>1&&(0,t.createElement)("p",{className:"upload-queue-status"},(0,n.__)("Uploading file","bcgov-design-system")," ",V+1," ",(0,n.__)("of","bcgov-design-system")," ",L.length),(0,t.createElement)("div",{className:"progress-bar"},(0,t.createElement)("div",{className:"progress-bar-fill",style:{width:`${H}%`}}))),(0,t.createElement)(f,{metadataFields:m,onUploadSuccess:K,selectedFile:v,modalMode:!0,onFileDrop:W})),h&&(0,t.createElement)(s.Modal,{title:(0,n.__)("Cancel Upload","bcgov-design-system"),onRequestClose:()=>E(!1),className:"cancel-upload-modal"},(0,t.createElement)("p",null,(0,n.__)("Are you sure you want to cancel the remaining uploads?","bcgov-design-system")),(0,t.createElement)("div",{className:"modal-actions"},(0,t.createElement)(s.Button,{className:"doc-repo-button",onClick:()=>E(!1)},(0,n.__)("Continue Upload","bcgov-design-system")),(0,t.createElement)(s.Button,{className:"doc-repo-button",isDestructive:!0,onClick:()=>{p(!1),y(null),z([]),j(0),E(!1)}},(0,n.__)("Cancel Upload","bcgov-design-system"))))))};document.addEventListener("DOMContentLoaded",()=>{try{const e=document.getElementById("wordpress-document-repository-app");if(e)(0,a.createRoot)(e).render((0,t.createElement)(C,null));else{const e=document.createElement("div");e.style.color="red",e.style.padding="20px",e.style.border="1px solid red",e.innerHTML="<strong>Error:</strong> Document Repository container not found. Check console for details.",document.body.prepend(e)}}catch(e){const t=document.createElement("div");t.style.color="red",t.style.padding="20px",t.style.border="1px solid red",t.innerHTML=`<strong>Error:</strong> Failed to initialize Document Repository app: ${e.message}`,document.body.prepend(t)}})})();
>>>>>>> bf30341 (removed virtualized component as it is no longer needed)
